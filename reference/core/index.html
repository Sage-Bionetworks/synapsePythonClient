
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python client for Sage Bionetworks' Synapse, a collaborative, open-source research platform that allows teams to share data, track analyses, and collaborate. The Python client can be used as a library for development of software that communicates with Synapse or as a command-line utility.">
      
      
        <meta name="author" content="Bryan Fauble">
      
      
      
        <link rel="prev" href="../permissions/">
      
      
        <link rel="next" href="../rest_apis/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Core - Synapse Python/Command Line Client Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
      <link rel="stylesheet" href="../../termynal.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Synapse Python/Command Line Client Documentation" class="md-header__button md-logo" aria-label="Synapse Python/Command Line Client Documentation" data-md-component="logo">
      
  <img src="../../assets/synapse_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Synapse Python/Command Line Client Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Core
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Sage-Bionetworks/synapsePythonClient" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    synapsePythonClient
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/home/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/home/" class="md-tabs__link">
          
  
  How-To Guides

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../client/" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../explanations/home/" class="md-tabs__link">
          
  
  Further Reading

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../news/" class="md-tabs__link">
          
  
  News

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Synapse Python/Command Line Client Documentation" class="md-nav__button md-logo" aria-label="Synapse Python/Command Line Client Documentation" data-md-component="logo">
      
  <img src="../../assets/synapse_logo.png" alt="logo">

    </a>
    Synapse Python/Command Line Client Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Sage-Bionetworks/synapsePythonClient" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    synapsePythonClient
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Home
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Working with the Python client
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Working with the Python client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/folder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/annotation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/upload_data_in_bulk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upload data in bulk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/python/download_data_in_bulk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download data in bulk
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/command_line_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with the Command Line Client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/file_versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with file versioning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/reticulate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synapseclient with R through reticulate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How-To Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/views/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Entity Views
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/data_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/accessing_the_rest_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access the REST API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Expermental Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Expermental Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/validate_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validating Annotations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../synapse_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synapse Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../folder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../table_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Table Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../view_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entity View Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity/Provenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wiki/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wiki
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../link/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Link
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker_repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DockerRepository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../permissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permissions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Core
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Core
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#upload" class="md-nav__link">
    <span class="md-ellipsis">
      Upload
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions.upload_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions.upload_synapse_sts_boto_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_sts_boto_s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Multipart Upload
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multipart_upload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.UploadAttempt" class="md-nav__link">
    <span class="md-ellipsis">
      UploadAttempt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_upload_string" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_copy" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_copy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload._multipart_upload" class="md-nav__link">
    <span class="md-ellipsis">
      _multipart_upload
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-async" class="md-nav__link">
    <span class="md-ellipsis">
      Upload Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async" class="md-nav__link">
    <span class="md-ellipsis">
      upload_functions_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_functions_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.create_external_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      create_external_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_external_file_handle_sftp" class="md-nav__link">
    <span class="md-ellipsis">
      upload_external_file_handle_sftp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_sts_boto_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_sts_boto_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_client_auth_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_client_auth_s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-upload-async" class="md-nav__link">
    <span class="md-ellipsis">
      Multipart Upload Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multipart_upload_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.HandlePartResult" class="md-nav__link">
    <span class="md-ellipsis">
      HandlePartResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.UploadAttemptAsync" class="md-nav__link">
    <span class="md-ellipsis">
      UploadAttemptAsync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.shared_progress_bar" class="md-nav__link">
    <span class="md-ellipsis">
      shared_progress_bar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_file_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_file_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_string_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_string_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_copy_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_copy_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multithreaded-downloading" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreaded Downloading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download" class="md-nav__link">
    <span class="md-ellipsis">
      multithread_download
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multithread_download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.DownloadRequest" class="md-nav__link">
    <span class="md-ellipsis">
      DownloadRequest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.shared_executor" class="md-nav__link">
    <span class="md-ellipsis">
      shared_executor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Download Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions" class="md-nav__link">
    <span class="md-ellipsis">
      download_functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="download_functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_file_entity" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_file_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_by_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      download_by_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_from_url_multi_threaded" class="md-nav__link">
    <span class="md-ellipsis">
      download_from_url_multi_threaded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_from_url" class="md-nav__link">
    <span class="md-ellipsis">
      download_from_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.is_retryable_download_error" class="md-nav__link">
    <span class="md-ellipsis">
      is_retryable_download_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.resolve_download_path_collisions" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_download_path_collisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.ensure_download_location_is_directory" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_download_location_is_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.is_synapse_uri" class="md-nav__link">
    <span class="md-ellipsis">
      is_synapse_uri
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-managed-multithreaded-downloads" class="md-nav__link">
    <span class="md-ellipsis">
      Async managed Multithreaded Downloads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async" class="md-nav__link">
    <span class="md-ellipsis">
      download_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="download_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.DownloadRequest" class="md-nav__link">
    <span class="md-ellipsis">
      DownloadRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlInfo" class="md-nav__link">
    <span class="md-ellipsis">
      PresignedUrlInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider" class="md-nav__link">
    <span class="md-ellipsis">
      PresignedUrlProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PresignedUrlProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info_async" class="md-nav__link">
    <span class="md-ellipsis">
      get_info_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_info
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.cache" class="md-nav__link">
    <span class="md-ellipsis">
      cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache" class="md-nav__link">
    <span class="md-ellipsis">
      Cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.remove" class="md-nav__link">
    <span class="md-ellipsis">
      remove
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.purge" class="md-nav__link">
    <span class="md-ellipsis">
      purge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.epoch_time_to_iso" class="md-nav__link">
    <span class="md-ellipsis">
      epoch_time_to_iso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.iso_time_to_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      iso_time_to_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.compare_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      compare_timestamps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.username" class="md-nav__link">
    <span class="md-ellipsis">
      username
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.secret" class="md-nav__link">
    <span class="md-ellipsis">
      secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseAuthTokenCredentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseAuthTokenCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.username" class="md-nav__link">
    <span class="md-ellipsis">
      username
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.secret" class="md-nav__link">
    <span class="md-ellipsis">
      secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider" class="md-nav__link">
    <span class="md-ellipsis">
      credential_provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="credential_provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentialsProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentialsProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider.get_synapse_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_synapse_credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      UserArgsCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigFileCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      AWSParameterStoreCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      EnvironmentVariableCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentialsProviderChain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentialsProviderChain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain.get_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.get_default_credential_chain" class="md-nav__link">
    <span class="md-ellipsis">
      get_default_credential_chain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-file-storage-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      Remote File Storage Wrappers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      remote_file_storage_wrappers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remote_file_storage_wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      S3ClientWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S3ClientWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      SFTPWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SFTPWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retry" class="md-nav__link">
    <span class="md-ellipsis">
      Retry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.retry" class="md-nav__link">
    <span class="md-ellipsis">
      retry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="retry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.calculate_exponential_backoff" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_exponential_backoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry_time_based_async" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry_time_based_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry_time_based" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry_time_based
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    <span class="md-ellipsis">
      Utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.threadsafe_iter" class="md-nav__link">
    <span class="md-ellipsis">
      threadsafe_iter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.deprecated_keyword_param" class="md-nav__link">
    <span class="md-ellipsis">
      deprecated_keyword_param
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file_hex" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file_hex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file_multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file_multiprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_fn" class="md-nav__link">
    <span class="md-ellipsis">
      md5_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_filename" class="md-nav__link">
    <span class="md-ellipsis">
      extract_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_user_name" class="md-nav__link">
    <span class="md-ellipsis">
      extract_user_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.id_of" class="md-nav__link">
    <span class="md-ellipsis">
      id_of
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.concrete_type_of" class="md-nav__link">
    <span class="md-ellipsis">
      concrete_type_of
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      is_in_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.get_properties" class="md-nav__link">
    <span class="md-ellipsis">
      get_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_url" class="md-nav__link">
    <span class="md-ellipsis">
      is_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.as_url" class="md-nav__link">
    <span class="md-ellipsis">
      as_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.guess_file_name" class="md-nav__link">
    <span class="md-ellipsis">
      guess_file_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.equal_paths" class="md-nav__link">
    <span class="md-ellipsis">
      equal_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.file_url_to_path" class="md-nav__link">
    <span class="md-ellipsis">
      file_url_to_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_same_base_url" class="md-nav__link">
    <span class="md-ellipsis">
      is_same_base_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_synapse_id_str" class="md-nav__link">
    <span class="md-ellipsis">
      is_synapse_id_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.get_synid_and_version" class="md-nav__link">
    <span class="md-ellipsis">
      get_synid_and_version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.bool_or_none" class="md-nav__link">
    <span class="md-ellipsis">
      bool_or_none
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.datetime_or_none" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_or_none
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_date" class="md-nav__link">
    <span class="md-ellipsis">
      is_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_uuid_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_uuid_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_data_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_data_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_binary_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_binary_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_unix_epoch_time" class="md-nav__link">
    <span class="md-ellipsis">
      to_unix_epoch_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_unix_epoch_time_secs" class="md-nav__link">
    <span class="md-ellipsis">
      to_unix_epoch_time_secs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.from_unix_epoch_time_secs" class="md-nav__link">
    <span class="md-ellipsis">
      from_unix_epoch_time_secs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.from_unix_epoch_time" class="md-nav__link">
    <span class="md-ellipsis">
      from_unix_epoch_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.datetime_to_iso" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_to_iso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.format_time_interval" class="md-nav__link">
    <span class="md-ellipsis">
      format_time_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.itersubclasses" class="md-nav__link">
    <span class="md-ellipsis">
      itersubclasses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.normalize_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.query_limit_and_offset" class="md-nav__link">
    <span class="md-ellipsis">
      query_limit_and_offset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_synapse_id_from_query" class="md-nav__link">
    <span class="md-ellipsis">
      extract_synapse_id_from_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.printTransferProgress" class="md-nav__link">
    <span class="md-ellipsis">
      printTransferProgress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.touch" class="md-nav__link">
    <span class="md-ellipsis">
      touch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_json" class="md-nav__link">
    <span class="md-ellipsis">
      is_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.find_data_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      find_data_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.unique_filename" class="md-nav__link">
    <span class="md-ellipsis">
      unique_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.threadsafe_generator" class="md-nav__link">
    <span class="md-ellipsis">
      threadsafe_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      extract_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_zip_file_to_directory" class="md-nav__link">
    <span class="md-ellipsis">
      extract_zip_file_to_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.topolgical_sort" class="md-nav__link">
    <span class="md-ellipsis">
      topolgical_sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.caller_module_name" class="md-nav__link">
    <span class="md-ellipsis">
      caller_module_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.attempt_import" class="md-nav__link">
    <span class="md-ellipsis">
      attempt_import
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.snake_case" class="md-nav__link">
    <span class="md-ellipsis">
      snake_case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_base64_encoded" class="md-nav__link">
    <span class="md-ellipsis">
      is_base64_encoded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.run_and_attach_otel_context" class="md-nav__link">
    <span class="md-ellipsis">
      run_and_attach_otel_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.delete_none_keys" class="md-nav__link">
    <span class="md-ellipsis">
      delete_none_keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.merge_dataclass_entities" class="md-nav__link">
    <span class="md-ellipsis">
      merge_dataclass_entities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Async Utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils" class="md-nav__link">
    <span class="md-ellipsis">
      async_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="async_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.ClassOrInstance" class="md-nav__link">
    <span class="md-ellipsis">
      ClassOrInstance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.otel_trace_method" class="md-nav__link">
    <span class="md-ellipsis">
      otel_trace_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.wrap_async_to_sync" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_async_to_sync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.async_to_sync" class="md-nav__link">
    <span class="md-ellipsis">
      async_to_sync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#versions" class="md-nav__link">
    <span class="md-ellipsis">
      Versions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
    <nav class="md-nav" aria-label="version_check">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check--version-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Version Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.check_for_updates" class="md-nav__link">
    <span class="md-ellipsis">
      check_for_updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.release_notes" class="md-nav__link">
    <span class="md-ellipsis">
      release_notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sts-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      STS Transfer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer" class="md-nav__link">
    <span class="md-ellipsis">
      sts_transfer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sts_transfer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.StsTokenStore" class="md-nav__link">
    <span class="md-ellipsis">
      StsTokenStore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.get_sts_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_sts_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.with_boto_sts_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      with_boto_sts_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_boto_sts_transfer_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      is_boto_sts_transfer_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      is_storage_location_sts_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled_async" class="md-nav__link">
    <span class="md-ellipsis">
      is_storage_location_sts_enabled_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rest_apis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Apis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_22" >
        
          
          <label class="md-nav__link" for="__nav_4_22" id="__nav_4_22_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Experimental
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_22">
            <span class="md-nav__icon md-icon"></span>
            Experimental
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oop/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object-Orientated Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oop/models_async/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Async Object-Orientated Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Further Reading
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Further Reading
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/domain_models_of_synapse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain Models of Synapse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/access_control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/properties_vs_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Properties vs Annotations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/manifest_tsv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manifest TSV
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/benchmarking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benchmarking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/structuring_your_project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structuring Your Project
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    News
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            News
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../news/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#upload" class="md-nav__link">
    <span class="md-ellipsis">
      Upload
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions" class="md-nav__link">
    <span class="md-ellipsis">
      upload_functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions.upload_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions.upload_synapse_sts_boto_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_sts_boto_s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Multipart Upload
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multipart_upload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.UploadAttempt" class="md-nav__link">
    <span class="md-ellipsis">
      UploadAttempt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_upload_string" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload.multipart_copy" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_copy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload._multipart_upload" class="md-nav__link">
    <span class="md-ellipsis">
      _multipart_upload
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-async" class="md-nav__link">
    <span class="md-ellipsis">
      Upload Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async" class="md-nav__link">
    <span class="md-ellipsis">
      upload_functions_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_functions_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.create_external_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      create_external_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_external_file_handle_sftp" class="md-nav__link">
    <span class="md-ellipsis">
      upload_external_file_handle_sftp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_sts_boto_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_synapse_sts_boto_s3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.upload_functions_async.upload_client_auth_s3" class="md-nav__link">
    <span class="md-ellipsis">
      upload_client_auth_s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multipart-upload-async" class="md-nav__link">
    <span class="md-ellipsis">
      Multipart Upload Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multipart_upload_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.HandlePartResult" class="md-nav__link">
    <span class="md-ellipsis">
      HandlePartResult
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.UploadAttemptAsync" class="md-nav__link">
    <span class="md-ellipsis">
      UploadAttemptAsync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.shared_progress_bar" class="md-nav__link">
    <span class="md-ellipsis">
      shared_progress_bar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_file_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_file_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_string_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_upload_string_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.upload.multipart_upload_async.multipart_copy_async" class="md-nav__link">
    <span class="md-ellipsis">
      multipart_copy_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multithreaded-downloading" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreaded Downloading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download" class="md-nav__link">
    <span class="md-ellipsis">
      multithread_download
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multithread_download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.DownloadRequest" class="md-nav__link">
    <span class="md-ellipsis">
      DownloadRequest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.multithread_download.shared_executor" class="md-nav__link">
    <span class="md-ellipsis">
      shared_executor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Download Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions" class="md-nav__link">
    <span class="md-ellipsis">
      download_functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="download_functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_file_entity" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_file_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      download_file_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_by_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      download_by_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_from_url_multi_threaded" class="md-nav__link">
    <span class="md-ellipsis">
      download_from_url_multi_threaded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.download_from_url" class="md-nav__link">
    <span class="md-ellipsis">
      download_from_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.is_retryable_download_error" class="md-nav__link">
    <span class="md-ellipsis">
      is_retryable_download_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.resolve_download_path_collisions" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_download_path_collisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.ensure_download_location_is_directory" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_download_location_is_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_functions.is_synapse_uri" class="md-nav__link">
    <span class="md-ellipsis">
      is_synapse_uri
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-managed-multithreaded-downloads" class="md-nav__link">
    <span class="md-ellipsis">
      Async managed Multithreaded Downloads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async" class="md-nav__link">
    <span class="md-ellipsis">
      download_async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="download_async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.DownloadRequest" class="md-nav__link">
    <span class="md-ellipsis">
      DownloadRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlInfo" class="md-nav__link">
    <span class="md-ellipsis">
      PresignedUrlInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider" class="md-nav__link">
    <span class="md-ellipsis">
      PresignedUrlProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PresignedUrlProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info_async" class="md-nav__link">
    <span class="md-ellipsis">
      get_info_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_info
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.download.download_async.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.cache" class="md-nav__link">
    <span class="md-ellipsis">
      cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache" class="md-nav__link">
    <span class="md-ellipsis">
      Cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.remove" class="md-nav__link">
    <span class="md-ellipsis">
      remove
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.Cache.purge" class="md-nav__link">
    <span class="md-ellipsis">
      purge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.epoch_time_to_iso" class="md-nav__link">
    <span class="md-ellipsis">
      epoch_time_to_iso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.iso_time_to_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      iso_time_to_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.cache.compare_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      compare_timestamps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.username" class="md-nav__link">
    <span class="md-ellipsis">
      username
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.secret" class="md-nav__link">
    <span class="md-ellipsis">
      secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseAuthTokenCredentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseAuthTokenCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.username" class="md-nav__link">
    <span class="md-ellipsis">
      username
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.secret" class="md-nav__link">
    <span class="md-ellipsis">
      secret
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider" class="md-nav__link">
    <span class="md-ellipsis">
      credential_provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="credential_provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentialsProvider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentialsProvider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider.get_synapse_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_synapse_credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      UserArgsCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigFileCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      AWSParameterStoreCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider" class="md-nav__link">
    <span class="md-ellipsis">
      EnvironmentVariableCredentialsProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain" class="md-nav__link">
    <span class="md-ellipsis">
      SynapseCredentialsProviderChain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SynapseCredentialsProviderChain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain.get_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.credentials.credential_provider.get_default_credential_chain" class="md-nav__link">
    <span class="md-ellipsis">
      get_default_credential_chain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-file-storage-wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      Remote File Storage Wrappers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers" class="md-nav__link">
    <span class="md-ellipsis">
      remote_file_storage_wrappers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remote_file_storage_wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      S3ClientWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="S3ClientWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      SFTPWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SFTPWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.upload_file" class="md-nav__link">
    <span class="md-ellipsis">
      upload_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.remote_file_storage_wrappers-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retry" class="md-nav__link">
    <span class="md-ellipsis">
      Retry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.retry" class="md-nav__link">
    <span class="md-ellipsis">
      retry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="retry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.calculate_exponential_backoff" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_exponential_backoff
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry_time_based_async" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry_time_based_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.retry.with_retry_time_based" class="md-nav__link">
    <span class="md-ellipsis">
      with_retry_time_based
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    <span class="md-ellipsis">
      Utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.threadsafe_iter" class="md-nav__link">
    <span class="md-ellipsis">
      threadsafe_iter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.deprecated_keyword_param" class="md-nav__link">
    <span class="md-ellipsis">
      deprecated_keyword_param
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file_hex" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file_hex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_for_file_multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      md5_for_file_multiprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.md5_fn" class="md-nav__link">
    <span class="md-ellipsis">
      md5_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_filename" class="md-nav__link">
    <span class="md-ellipsis">
      extract_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_user_name" class="md-nav__link">
    <span class="md-ellipsis">
      extract_user_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.id_of" class="md-nav__link">
    <span class="md-ellipsis">
      id_of
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.concrete_type_of" class="md-nav__link">
    <span class="md-ellipsis">
      concrete_type_of
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      is_in_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.get_properties" class="md-nav__link">
    <span class="md-ellipsis">
      get_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_url" class="md-nav__link">
    <span class="md-ellipsis">
      is_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.as_url" class="md-nav__link">
    <span class="md-ellipsis">
      as_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.guess_file_name" class="md-nav__link">
    <span class="md-ellipsis">
      guess_file_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.equal_paths" class="md-nav__link">
    <span class="md-ellipsis">
      equal_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.file_url_to_path" class="md-nav__link">
    <span class="md-ellipsis">
      file_url_to_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_same_base_url" class="md-nav__link">
    <span class="md-ellipsis">
      is_same_base_url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_synapse_id_str" class="md-nav__link">
    <span class="md-ellipsis">
      is_synapse_id_str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.get_synid_and_version" class="md-nav__link">
    <span class="md-ellipsis">
      get_synid_and_version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.bool_or_none" class="md-nav__link">
    <span class="md-ellipsis">
      bool_or_none
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.datetime_or_none" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_or_none
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_date" class="md-nav__link">
    <span class="md-ellipsis">
      is_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_uuid_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_uuid_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_data_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_data_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.make_bogus_binary_file" class="md-nav__link">
    <span class="md-ellipsis">
      make_bogus_binary_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_unix_epoch_time" class="md-nav__link">
    <span class="md-ellipsis">
      to_unix_epoch_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.to_unix_epoch_time_secs" class="md-nav__link">
    <span class="md-ellipsis">
      to_unix_epoch_time_secs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.from_unix_epoch_time_secs" class="md-nav__link">
    <span class="md-ellipsis">
      from_unix_epoch_time_secs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.from_unix_epoch_time" class="md-nav__link">
    <span class="md-ellipsis">
      from_unix_epoch_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.datetime_to_iso" class="md-nav__link">
    <span class="md-ellipsis">
      datetime_to_iso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.format_time_interval" class="md-nav__link">
    <span class="md-ellipsis">
      format_time_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.itersubclasses" class="md-nav__link">
    <span class="md-ellipsis">
      itersubclasses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.normalize_whitespace" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_whitespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.query_limit_and_offset" class="md-nav__link">
    <span class="md-ellipsis">
      query_limit_and_offset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_synapse_id_from_query" class="md-nav__link">
    <span class="md-ellipsis">
      extract_synapse_id_from_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.printTransferProgress" class="md-nav__link">
    <span class="md-ellipsis">
      printTransferProgress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.touch" class="md-nav__link">
    <span class="md-ellipsis">
      touch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_json" class="md-nav__link">
    <span class="md-ellipsis">
      is_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.find_data_file_handle" class="md-nav__link">
    <span class="md-ellipsis">
      find_data_file_handle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.unique_filename" class="md-nav__link">
    <span class="md-ellipsis">
      unique_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.threadsafe_generator" class="md-nav__link">
    <span class="md-ellipsis">
      threadsafe_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      extract_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.extract_zip_file_to_directory" class="md-nav__link">
    <span class="md-ellipsis">
      extract_zip_file_to_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.topolgical_sort" class="md-nav__link">
    <span class="md-ellipsis">
      topolgical_sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.caller_module_name" class="md-nav__link">
    <span class="md-ellipsis">
      caller_module_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.attempt_import" class="md-nav__link">
    <span class="md-ellipsis">
      attempt_import
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.snake_case" class="md-nav__link">
    <span class="md-ellipsis">
      snake_case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.is_base64_encoded" class="md-nav__link">
    <span class="md-ellipsis">
      is_base64_encoded
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.run_and_attach_otel_context" class="md-nav__link">
    <span class="md-ellipsis">
      run_and_attach_otel_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.delete_none_keys" class="md-nav__link">
    <span class="md-ellipsis">
      delete_none_keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.utils.merge_dataclass_entities" class="md-nav__link">
    <span class="md-ellipsis">
      merge_dataclass_entities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Async Utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils" class="md-nav__link">
    <span class="md-ellipsis">
      async_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="async_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.ClassOrInstance" class="md-nav__link">
    <span class="md-ellipsis">
      ClassOrInstance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.otel_trace_method" class="md-nav__link">
    <span class="md-ellipsis">
      otel_trace_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.wrap_async_to_sync" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_async_to_sync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.async_utils.async_to_sync" class="md-nav__link">
    <span class="md-ellipsis">
      async_to_sync
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#versions" class="md-nav__link">
    <span class="md-ellipsis">
      Versions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
    <nav class="md-nav" aria-label="version_check">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check--version-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Version Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.version_check" class="md-nav__link">
    <span class="md-ellipsis">
      version_check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.check_for_updates" class="md-nav__link">
    <span class="md-ellipsis">
      check_for_updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.version_check.release_notes" class="md-nav__link">
    <span class="md-ellipsis">
      release_notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sts-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      STS Transfer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer" class="md-nav__link">
    <span class="md-ellipsis">
      sts_transfer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sts_transfer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.StsTokenStore" class="md-nav__link">
    <span class="md-ellipsis">
      StsTokenStore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.get_sts_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      get_sts_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.with_boto_sts_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      with_boto_sts_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_boto_sts_transfer_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      is_boto_sts_transfer_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      is_storage_location_sts_enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled_async" class="md-nav__link">
    <span class="md-ellipsis">
      is_storage_location_sts_enabled_async
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="core">Core<a class="headerlink" href="#core" title="Permanent link">&para;</a></h1>
<p>This section is for super users / developers only.
These functions are subject to change as they are internal development
functions.  Use at your own risk.</p>
<h2 id="upload">Upload<a class="headerlink" href="#upload" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.upload.upload_functions" class="doc doc-heading">
            <code>synapseclient.core.upload.upload_functions</code>


<a href="#synapseclient.core.upload.upload_functions" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This module handles the various ways that a user can upload a file to Synapse.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.upload.upload_functions-classes">Classes<a href="#synapseclient.core.upload.upload_functions-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="synapseclient.core.upload.upload_functions-functions">Functions<a href="#synapseclient.core.upload.upload_functions-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions.upload_file_handle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file_handle</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">parent_entity</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">synapseStore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.upload_functions.upload_file_handle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Uploads the file in the provided path (if necessary) to a storage location based on project settings.
Returns a new FileHandle as a dict to represent the stored file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>parent_entity</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Entity object or id of the parent entity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[str, <span title="collections.abc.Mapping">Mapping</span>, <span title="numbers.Number">Number</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file path to the file being uploaded</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapseStore</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If False, will not upload the file, but instead create an ExternalFileHandle that references
           the file on the local machine.
           If True, will upload the file based on StorageLocation determined by the entity_parent_id</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MD5 checksum for the file, if known. Otherwise if the file is a local file, it will be
           calculated automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The size the file, if known. Otherwise if the file is a local file, it will be calculated
           automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MIME type the file, if known. Otherwise if the file is a local file, it will be
           calculated automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A dictionary of a new FileHandle as a dict that represents the uploaded file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_file_handle</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">parent_entity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">synapseStore</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uploads the file in the provided path (if necessary) to a storage location based on project settings.</span>
<span class="sd">    Returns a new FileHandle as a dict to represent the stored file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        parent_entity: Entity object or id of the parent entity.</span>
<span class="sd">        path:          The file path to the file being uploaded</span>
<span class="sd">        synapseStore:  If False, will not upload the file, but instead create an ExternalFileHandle that references</span>
<span class="sd">                       the file on the local machine.</span>
<span class="sd">                       If True, will upload the file based on StorageLocation determined by the entity_parent_id</span>
<span class="sd">        md5:           The MD5 checksum for the file, if known. Otherwise if the file is a local file, it will be</span>
<span class="sd">                       calculated automatically.</span>
<span class="sd">        file_size:     The size the file, if known. Otherwise if the file is a local file, it will be calculated</span>
<span class="sd">                       automatically.</span>
<span class="sd">        file_size:     The MIME type the file, if known. Otherwise if the file is a local file, it will be</span>
<span class="sd">                       calculated automatically.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of a new FileHandle as a dict that represents the uploaded file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;path can not be None&quot;</span><span class="p">)</span>

    <span class="c1"># if doing a external file handle with no actual upload</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">synapseStore</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">create_external_file_handle</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span>
        <span class="p">)</span>

    <span class="c1"># expand the path because past this point an upload is required and some upload functions require an absolute path</span>
    <span class="n">expanded_upload_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">md5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">expanded_upload_path</span><span class="p">):</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file</span><span class="p">(</span><span class="n">expanded_upload_path</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">entity_parent_id</span> <span class="o">=</span> <span class="n">id_of</span><span class="p">(</span><span class="n">parent_entity</span><span class="p">)</span>

    <span class="c1"># determine the upload function based on the UploadDestination</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">_getDefaultUploadDestination</span><span class="p">(</span><span class="n">entity_parent_id</span><span class="p">)</span>
    <span class="n">upload_destination_type</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s2">&quot;concreteType&quot;</span><span class="p">]</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;synapse.parent_id&quot;</span><span class="p">:</span> <span class="n">entity_parent_id</span><span class="p">,</span>
            <span class="s2">&quot;synapse.upload_destination_type&quot;</span><span class="p">:</span> <span class="n">upload_destination_type</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_boto_sts_transfer_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_storage_location_sts_enabled</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="n">entity_parent_id</span><span class="p">,</span> <span class="n">location</span>
        <span class="p">)</span>
        <span class="ow">and</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span>
    <span class="p">):</span>
        <span class="n">log_upload_message</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Uploading file to external S3 storage using boto3 </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">upload_synapse_sts_boto_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="n">entity_parent_id</span><span class="p">,</span>
            <span class="n">upload_destination</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">SYNAPSE_S3_UPLOAD_DESTINATION</span><span class="p">,</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span><span class="p">,</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_GCP_UPLOAD_DESTINATION</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">SYNAPSE_S3_UPLOAD_DESTINATION</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;Synapse&quot;</span>
        <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;your external S3&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;your external Google Bucket&quot;</span>

        <span class="n">log_upload_message</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Uploading file to &quot;</span>
            <span class="o">+</span> <span class="n">storage_str</span>
            <span class="o">+</span> <span class="s2">&quot; storage </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">upload_synapse_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">storageLocationId</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">],</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># external file handle (sftp)</span>
    <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_UPLOAD_DESTINATION</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">location</span><span class="p">[</span><span class="s2">&quot;uploadType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SFTP&quot;</span><span class="p">:</span>
            <span class="n">log_upload_message</span><span class="p">(</span>
                <span class="n">syn</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">Uploading to: </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;banner&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span>
                    <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">upload_external_file_handle_sftp</span><span class="p">(</span>
                <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
                <span class="n">sftp_url</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
                <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only handle SFTP upload locations.&quot;</span><span class="p">)</span>
    <span class="c1"># client authenticated S3</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">upload_destination_type</span>
        <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_OBJECT_STORE_UPLOAD_DESTINATION</span>
    <span class="p">):</span>
        <span class="n">log_upload_message</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">Uploading to endpoint: [</span><span class="si">%s</span><span class="s2">] bucket: [</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span>
                <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;banner&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endpointUrl&quot;</span><span class="p">),</span>
                <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bucket&quot;</span><span class="p">),</span>
                <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">upload_client_auth_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">],</span>
            <span class="n">endpoint_url</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;endpointUrl&quot;</span><span class="p">],</span>
            <span class="n">key_prefix</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;keyPrefixUUID&quot;</span><span class="p">],</span>
            <span class="n">storage_location_id</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">],</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># unknown storage location</span>
        <span class="n">log_upload_message</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">UNKNOWN STORAGE LOCATION. Defaulting upload to Synapse.</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;banner&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;!&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">upload_synapse_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">storageLocationId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions.upload_synapse_sts_boto_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_synapse_sts_boto_s3</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">upload_destination</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.upload_functions.upload_synapse_sts_boto_s3" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>When uploading to Synapse storage normally the back end will generate a random prefix
for our uploaded object. Since in this case the client is responsible for the remote
key, the client will instead generate a random prefix. this both ensures we don't have a collision
with an existing S3 object and also mitigates potential performance issues, although
key locality performance issues are likely resolved as of:
<a href="https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/">https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/</a></p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The synapse client</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>parent_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The synapse ID of the parent.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upload_destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The upload destination</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>local_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The local path to the file to upload.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mimetype</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The mimetype is known. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>MD5 checksum for the file, if known.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_synapse_sts_boto_s3</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">upload_destination</span><span class="p">,</span>
    <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When uploading to Synapse storage normally the back end will generate a random prefix</span>
<span class="sd">    for our uploaded object. Since in this case the client is responsible for the remote</span>
<span class="sd">    key, the client will instead generate a random prefix. this both ensures we don&#39;t have a collision</span>
<span class="sd">    with an existing S3 object and also mitigates potential performance issues, although</span>
<span class="sd">    key locality performance issues are likely resolved as of:</span>
<span class="sd">    &lt;https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/&gt;</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: The synapse client</span>
<span class="sd">        parent_id: The synapse ID of the parent.</span>
<span class="sd">        upload_destination: The upload destination</span>
<span class="sd">        local_path: The local path to the file to upload.</span>
<span class="sd">        mimetype: The mimetype is known. Defaults to None.</span>
<span class="sd">        md5: MD5 checksum for the file, if known.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_prefix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">upload_destination</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">]</span>
    <span class="n">storage_location_id</span> <span class="o">=</span> <span class="n">upload_destination</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">]</span>
    <span class="n">remote_file_key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">upload_destination</span><span class="p">[</span><span class="s2">&quot;baseKey&quot;</span><span class="p">],</span> <span class="n">key_prefix</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_fn</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
            <span class="n">endpoint_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">remote_file_key</span><span class="o">=</span><span class="n">remote_file_key</span><span class="p">,</span>
            <span class="n">upload_file_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">transfer_config_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">:</span> <span class="n">syn</span><span class="o">.</span><span class="n">max_threads</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="n">sts_transfer</span><span class="o">.</span><span class="n">with_boto_sts_credentials</span><span class="p">(</span><span class="n">upload_fn</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="s2">&quot;read_write&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">syn</span><span class="o">.</span><span class="n">create_external_s3_file_handle</span><span class="p">(</span>
        <span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
        <span class="n">s3_file_key</span><span class="o">=</span><span class="n">remote_file_key</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
        <span class="n">storage_location_id</span><span class="o">=</span><span class="n">storage_location_id</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="multipart-upload">Multipart Upload<a class="headerlink" href="#multipart-upload" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.upload.multipart_upload" class="doc doc-heading">
            <code>synapseclient.core.upload.multipart_upload</code>


<a href="#synapseclient.core.upload.multipart_upload" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>Implements the client side of
Synapse's <a href="https://rest-docs.synapse.org/rest/index.html#org.sagebionetworks.file.controller.UploadController">Multipart File Upload API</a>, which provides a
robust means of uploading large files (into the 10s of GiB). End users should not need to call any of the methods under
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.UploadAttempt">UploadAttempt</a> directly.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.upload.multipart_upload-classes">Classes<a href="#synapseclient.core.upload.multipart_upload-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.upload.multipart_upload.UploadAttempt" class="doc doc-heading">
            <code>UploadAttempt</code>


<a href="#synapseclient.core.upload.multipart_upload.UploadAttempt" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Used to handle multi-threaded operations for uploading one or parts of a file.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/upload/multipart_upload.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UploadAttempt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to handle multi-threaded operations for uploading one or parts of a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request_payload</span><span class="p">,</span>
        <span class="n">part_request_body_provider_fn</span><span class="p">,</span>
        <span class="n">md5_fn</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span> <span class="o">=</span> <span class="n">syn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span> <span class="o">=</span> <span class="n">dest_file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_part_size</span> <span class="o">=</span> <span class="n">upload_request_payload</span><span class="p">[</span><span class="s2">&quot;partSizeBytes&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span> <span class="o">=</span> <span class="n">upload_request_payload</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span> <span class="o">=</span> <span class="n">part_request_body_provider_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_md5_fn</span> <span class="o">=</span> <span class="n">md5_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_threads</span> <span class="o">=</span> <span class="n">max_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_restart</span> <span class="o">=</span> <span class="n">force_restart</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># populated later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_remaining_part_numbers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">upload_status</span><span class="p">):</span>
        <span class="n">part_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parts_state</span> <span class="o">=</span> <span class="n">upload_status</span><span class="p">[</span><span class="s2">&quot;partsState&quot;</span><span class="p">]</span>

        <span class="c1"># parts are 1-based</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part_status</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts_state</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">part_status</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
                <span class="n">part_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts_state</span><span class="p">),</span> <span class="n">part_numbers</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_thread_session</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># get a lazily initialized requests.Session from the thread.</span>
        <span class="c1"># we want to share a requests.Session over the course of a thread</span>
        <span class="c1"># to take advantage of persistent http connection. we put it on a</span>
        <span class="c1"># thread local rather that in the task closure since a connection can</span>
        <span class="c1"># be reused across separate part uploads so no reason to restrict it</span>
        <span class="c1"># per worker task.</span>
        <span class="n">session</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_thread_local</span><span class="p">,</span> <span class="s2">&quot;session&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">_thread_local</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">session</span>

    <span class="k">def</span> <span class="nf">_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># is this a copy or upload request</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concreteType&quot;</span><span class="p">)</span>
            <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_COPY_REQUEST</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_synapse_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">restPOST</span><span class="p">(</span>
            <span class="s2">&quot;/file/multipart?forceRestart=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_force_restart</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="p">),</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fetch_pre_signed_part_urls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">upload_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">part_numbers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">requests_session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/file/multipart/</span><span class="si">{upload_id}</span><span class="s2">/presigned/url/batch&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">upload_id</span><span class="o">=</span><span class="n">upload_id</span>
        <span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;uploadId&quot;</span><span class="p">:</span> <span class="n">upload_id</span><span class="p">,</span>
            <span class="s2">&quot;partNumbers&quot;</span><span class="p">:</span> <span class="n">part_numbers</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">restPOST</span><span class="p">(</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">),</span>
            <span class="n">requests_session</span><span class="o">=</span><span class="n">requests_session</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">part_urls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;partPresignedUrls&quot;</span><span class="p">]:</span>
            <span class="n">part_urls</span><span class="p">[</span><span class="n">part</span><span class="p">[</span><span class="s2">&quot;partNumber&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">part</span><span class="p">[</span><span class="s2">&quot;uploadPresignedUrl&quot;</span><span class="p">],</span>
                <span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;signedHeaders&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">part_urls</span>

    <span class="k">def</span> <span class="nf">_refresh_pre_signed_part_urls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">expired_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh all unfetched presigned urls, and return the refreshed</span>
<span class="sd">        url for the given part number. If an existing expired_url is passed</span>
<span class="sd">        and the url for the given part has already changed that new url</span>
<span class="sd">        will be returned without a refresh (i.e. it is assumed that another</span>
<span class="sd">        thread has already refreshed the url since the passed url expired).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            part_number: the part number whose refreshed url should</span>
<span class="sd">                         be returned</span>
<span class="sd">            expired_url: the url that was detected as expired triggering</span>
<span class="sd">                         this refresh</span>
<span class="sd">        Returns:</span>
<span class="sd">            refreshed URL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">current_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">current_url</span> <span class="o">!=</span> <span class="n">expired_url</span><span class="p">:</span>
                <span class="c1"># if the url has already changed since the given url</span>
                <span class="c1"># was detected as expired we can assume that another</span>
                <span class="c1"># thread already refreshed the url and can avoid the extra</span>
                <span class="c1"># fetch.</span>
                <span class="n">refreshed_url</span> <span class="o">=</span> <span class="n">current_url</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_pre_signed_part_urls</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">)</span>

                <span class="n">refreshed_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">refreshed_url</span>

    <span class="k">def</span> <span class="nf">_handle_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">otel_context</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Context</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">otel_context</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">otel_context</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;UploadAttempt::_handle_part&quot;</span><span class="p">):</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;thread.id&quot;</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()}</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
                    <span class="c1"># this upload attempt has already been aborted</span>
                    <span class="c1"># so we short circuit the attempt to upload this part</span>
                    <span class="k">raise</span> <span class="n">SynapseUploadAbortedException</span><span class="p">(</span>
                        <span class="s2">&quot;Upload aborted, skipping part </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">part_url</span><span class="p">,</span> <span class="n">signed_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>

            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thread_session</span><span class="p">()</span>

            <span class="c1"># obtain the body (i.e. the upload bytes) for the given part number.</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">part_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">retry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

                <span class="k">def</span> <span class="nf">put_fn</span><span class="p">():</span>
                    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;UploadAttempt::put_part&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">part_url</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">signed_headers</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># use our backoff mechanism here, we have encountered 500s on puts to AWS signed urls</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">with_retry</span><span class="p">(</span>
                        <span class="n">put_fn</span><span class="p">,</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">_raise_for_status</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

                    <span class="c1"># completed upload part to s3 successfully</span>
                    <span class="k">break</span>

                <span class="k">except</span> <span class="n">SynapseHTTPError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span> <span class="ow">and</span> <span class="n">retry</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># we interpret this to mean our pre_signed url expired.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;The pre-signed upload URL for part </span><span class="si">{}</span><span class="s2"> has expired.&quot;</span>
                            <span class="s2">&quot;Refreshing urls and retrying.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="c1"># we refresh all the urls and obtain this part&#39;s</span>
                        <span class="c1"># specific url for the retry</span>
                        <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span>
                            <span class="s2">&quot;UploadAttempt::refresh_pre_signed_part_urls&quot;</span>
                        <span class="p">):</span>
                            <span class="p">(</span>
                                <span class="n">part_url</span><span class="p">,</span>
                                <span class="n">signed_headers</span><span class="p">,</span>
                            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_pre_signed_part_urls</span><span class="p">(</span>
                                <span class="n">part_number</span><span class="p">,</span>
                                <span class="n">part_url</span><span class="p">,</span>
                            <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span>

            <span class="n">md5_hex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_md5_fn</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

            <span class="c1"># now tell synapse that we uploaded that part successfully</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">restPUT</span><span class="p">(</span>
                <span class="s2">&quot;/file/multipart/</span><span class="si">{upload_id}</span><span class="s2">/add/</span><span class="si">{part_number}</span><span class="s2">?partMD5Hex=</span><span class="si">{md5}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
                    <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
                    <span class="n">md5</span><span class="o">=</span><span class="n">md5_hex</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">requests_session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># remove so future batch pre_signed url fetches will exclude this part</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span>

    <span class="k">def</span> <span class="nf">_upload_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_count</span><span class="p">,</span> <span class="n">remaining_part_numbers</span><span class="p">):</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;thread.id&quot;</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()})</span>
        <span class="n">time_upload_started</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">completed_part_count</span> <span class="o">=</span> <span class="n">part_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_part_numbers</span><span class="p">)</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_copy</span><span class="p">():</span>
            <span class="c1"># we won&#39;t have bytes to measure during a copy so the byte oriented progress bar is not useful</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">previously_transferred</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">completed_part_count</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_size</span><span class="p">,</span>
                <span class="n">file_size</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">_print_transfer_progress</span><span class="p">(</span>
                <span class="n">progress</span><span class="p">,</span>
                <span class="n">file_size</span><span class="p">,</span>
                <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Uploading&quot;</span><span class="p">,</span>
                <span class="n">postfix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span><span class="p">,</span>
                <span class="n">previouslyTransferred</span><span class="o">=</span><span class="n">previously_transferred</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_pre_signed_part_urls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
            <span class="n">remaining_part_numbers</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">_executor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_threads</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># we don&#39;t wait on the shutdown since we do so ourselves below</span>

            <span class="k">for</span> <span class="n">part_number</span> <span class="ow">in</span> <span class="n">remaining_part_numbers</span><span class="p">:</span>
                <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_part</span><span class="p">,</span>
                        <span class="n">part_number</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">get_current</span><span class="p">(),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">part_size</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">part_size</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_copy</span><span class="p">():</span>
                    <span class="n">progress</span> <span class="o">+=</span> <span class="n">part_size</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">_print_transfer_progress</span><span class="p">(</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">file_size</span><span class="p">),</span>
                        <span class="n">file_size</span><span class="p">,</span>
                        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Uploading&quot;</span><span class="p">,</span>
                        <span class="n">postfix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span><span class="p">,</span>
                        <span class="n">dt</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_upload_started</span><span class="p">,</span>
                        <span class="n">previouslyTransferred</span><span class="o">=</span><span class="n">previously_transferred</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">cause</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># wait for all threads to complete before</span>
                <span class="c1"># raising the exception, we don&#39;t want to return</span>
                <span class="c1"># control while there are still threads from this</span>
                <span class="c1"># upload attempt running</span>
                <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cause</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">SynapseUploadAbortedException</span><span class="p">(</span><span class="s2">&quot;User interrupted upload&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SynapseUploadFailedException</span><span class="p">(</span><span class="s2">&quot;Part upload failed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">cause</span>

    <span class="k">def</span> <span class="nf">_complete_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">upload_status_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">restPUT</span><span class="p">(</span>
            <span class="s2">&quot;/file/multipart/</span><span class="si">{upload_id}</span><span class="s2">/complete&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">requests_session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_thread_session</span><span class="p">(),</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">upload_state</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upload_state</span> <span class="o">!=</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">:</span>
            <span class="c1"># at this point we think successfully uploaded all the parts</span>
            <span class="c1"># but the upload status isn&#39;t complete, we&#39;ll throw an error</span>
            <span class="c1"># and let a subsequent attempt try to reconcile</span>
            <span class="k">raise</span> <span class="n">SynapseUploadFailedException</span><span class="p">(</span>
                <span class="s2">&quot;Upload status has an unexpected state </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">upload_state</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">upload_status_response</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">upload_status_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_synapse_upload</span><span class="p">()</span>
        <span class="n">upload_state</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_state</span> <span class="o">!=</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="p">[</span><span class="s2">&quot;uploadId&quot;</span><span class="p">]</span>
            <span class="n">part_count</span><span class="p">,</span> <span class="n">remaining_part_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_remaining_part_numbers</span><span class="p">(</span>
                <span class="n">upload_status_response</span>
            <span class="p">)</span>

            <span class="c1"># if no remaining part numbers then all the parts have been</span>
            <span class="c1"># uploaded but the upload has not been marked complete.</span>
            <span class="k">if</span> <span class="n">remaining_part_numbers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_upload_parts</span><span class="p">(</span><span class="n">part_count</span><span class="p">,</span> <span class="n">remaining_part_numbers</span><span class="p">)</span>
            <span class="n">upload_status_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complete_upload</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">upload_status_response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.upload.multipart_upload-functions">Functions<a href="#synapseclient.core.upload.multipart_upload-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload.multipart_upload_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_upload_file</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.multipart_upload.multipart_upload_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to a Synapse upload destination in chunks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a Synapse object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the file to upload</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>upload as a different filename</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>content_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Refers to the Content-Type of the API request.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of bytes per part. Minimum is 5MiB (5 * 1024 * 1024 bytes).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an id indicating where the file should be
                 stored. Retrieved from Synapse's UploadDestination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload
           from scratch, False to try to resume</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_threads</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>number of concurrent threads to devote
         to upload</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MD5 of the file. If not provided, it will be calculated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multipart_upload_file</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to a Synapse upload destination in chunks.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: a Synapse object</span>
<span class="sd">        file_path: the file to upload</span>
<span class="sd">        dest_file_name: upload as a different filename</span>
<span class="sd">        content_type: Refers to the Content-Type of the API request.</span>
<span class="sd">        part_size: Number of bytes per part. Minimum is 5MiB (5 * 1024 * 1024 bytes).</span>
<span class="sd">        storage_location_id: an id indicating where the file should be</span>
<span class="sd">                             stored. Retrieved from Synapse&#39;s UploadDestination</span>
<span class="sd">        preview: True to generate a preview</span>
<span class="sd">        force_restart: True to restart a previously initiated upload</span>
<span class="sd">                       from scratch, False to try to resume</span>
<span class="sd">        max_threads: number of concurrent threads to devote</span>
<span class="sd">                     to upload</span>
<span class="sd">        md5: The MD5 of the file. If not provided, it will be calculated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;synapse.storage_location_id&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">storage_location_id</span> <span class="k">if</span> <span class="n">storage_location_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File &quot;</span><span class="si">{}</span><span class="s1">&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File &quot;</span><span class="si">{}</span><span class="s1">&quot; is a directory.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>

    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dest_file_name</span><span class="p">:</span>
        <span class="n">dest_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">mime_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>

    <span class="n">callback_func</span> <span class="o">=</span> <span class="n">Spinner</span><span class="p">()</span><span class="o">.</span><span class="n">print_tick</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">syn</span><span class="o">.</span><span class="n">silent</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">md5_hex</span> <span class="o">=</span> <span class="n">md5</span> <span class="ow">or</span> <span class="n">md5_for_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback_func</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">MIN_PART_SIZE</span><span class="p">,</span>
        <span class="n">MAX_NUMBER_OF_PARTS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="n">content_type</span><span class="p">,</span>
        <span class="s2">&quot;contentMD5Hex&quot;</span><span class="p">:</span> <span class="n">md5_hex</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">part_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_file_chunk</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_multipart_upload</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">part_fn</span><span class="p">,</span>
        <span class="n">md5_fn</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload.multipart_upload_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_upload_string</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.multipart_upload.multipart_upload_string" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to a Synapse upload destination in chunks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a Synapse object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a string to upload as a file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>upload as a different filename</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>content_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Refers to the Content-Type of the API request.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>number of bytes per part. Minimum 5MB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an id indicating where the file should be
                 stored. Retrieved from Synapse's UploadDestination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload
           from scratch, False to try to resume</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_threads</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>number of concurrent threads to devote
         to upload</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multipart_upload_string</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to a Synapse upload destination in chunks.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: a Synapse object</span>
<span class="sd">        text: a string to upload as a file.</span>
<span class="sd">        dest_file_name: upload as a different filename</span>
<span class="sd">        content_type: Refers to the Content-Type of the API request.</span>
<span class="sd">        part_size: number of bytes per part. Minimum 5MB.</span>
<span class="sd">        storage_location_id: an id indicating where the file should be</span>
<span class="sd">                             stored. Retrieved from Synapse&#39;s UploadDestination</span>
<span class="sd">        preview: True to generate a preview</span>
<span class="sd">        force_restart: True to restart a previously initiated upload</span>
<span class="sd">                       from scratch, False to try to resume</span>
<span class="sd">        max_threads: number of concurrent threads to devote</span>
<span class="sd">                     to upload</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">md5_hex</span> <span class="o">=</span> <span class="n">md5_fn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dest_file_name</span><span class="p">:</span>
        <span class="n">dest_file_name</span> <span class="o">=</span> <span class="s2">&quot;message.txt&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="s2">&quot;text/plain; charset=utf-8&quot;</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">MIN_PART_SIZE</span><span class="p">,</span>
        <span class="n">MAX_NUMBER_OF_PARTS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="n">content_type</span><span class="p">,</span>
        <span class="s2">&quot;contentMD5Hex&quot;</span><span class="p">:</span> <span class="n">md5_hex</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">part_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_data_chunk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span><span class="p">)</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">MIN_PART_SIZE</span><span class="p">,</span>
        <span class="n">MAX_NUMBER_OF_PARTS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">_multipart_upload</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">part_fn</span><span class="p">,</span>
        <span class="n">md5_fn</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload.multipart_copy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_copy</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">source_file_handle_association</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.multipart_upload.multipart_copy" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Makes a
<a href="https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/MultipartUploadCopyRequest.html">Multipart Upload Copy Request</a>.
This request performs a copy of an existing file handle without data transfer from the client.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A Synapse object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_file_handle_association</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Describes an association of a FileHandle with another object.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The name of the file to be uploaded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The size that each part will be (in bytes).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The identifier of the storage location where this file should be copied to.
                 The user must be the owner of the storage location.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview of the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload from scratch, False to try to resume.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_threads</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of concurrent threads to devote to copy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multipart_copy</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">,</span>
    <span class="n">source_file_handle_association</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes a</span>
<span class="sd">    [Multipart Upload Copy Request](https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/MultipartUploadCopyRequest.html).</span>
<span class="sd">    This request performs a copy of an existing file handle without data transfer from the client.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: A Synapse object</span>
<span class="sd">        source_file_handle_association: Describes an association of a FileHandle with another object.</span>
<span class="sd">        dest_file_name: The name of the file to be uploaded.</span>
<span class="sd">        part_size: The size that each part will be (in bytes).</span>
<span class="sd">        storage_location_id: The identifier of the storage location where this file should be copied to.</span>
<span class="sd">                             The user must be the owner of the storage location.</span>
<span class="sd">        preview: True to generate a preview of the data.</span>
<span class="sd">        force_restart: True to restart a previously initiated upload from scratch, False to try to resume.</span>
<span class="sd">        max_threads: Number of concurrent threads to devote to copy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">part_size</span> <span class="o">=</span> <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_COPY_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;sourceFileHandleAssociation&quot;</span><span class="p">:</span> <span class="n">source_file_handle_association</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">_multipart_upload</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">copy_part_request_body_provider_fn</span><span class="p">,</span>
        <span class="n">copy_md5_fn</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="o">=</span><span class="n">max_threads</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload._multipart_upload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_multipart_upload</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="p">,</span> <span class="n">upload_request</span><span class="p">,</span> <span class="n">part_fn</span><span class="p">,</span> <span class="n">md5_fn</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.multipart_upload._multipart_upload" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Calls upon an <a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.UploadAttempt">UploadAttempt</a>
object to initiate and/or retry a multipart file upload or copy. This function is wrapped by
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.multipart_upload_file">multipart_upload_file</a>,
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.multipart_upload_string">multipart_upload_string</a>, and
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.multipart_copy">multipart_copy</a>.
Retries cannot exceed 7 retries per call.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A Synapse object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>upload as a different filename</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upload_request</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A dictionary object with the user-fed logistical
            details of the upload/copy request.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_fn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function to calculate the partSize of each part</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5_fn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Function to calculate the MD5 of the file-like object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_threads</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>number of concurrent threads to devote to upload.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_multipart_upload</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">,</span>
    <span class="n">upload_request</span><span class="p">,</span>
    <span class="n">part_fn</span><span class="p">,</span>
    <span class="n">md5_fn</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls upon an [UploadAttempt][synapseclient.core.upload.multipart_upload.UploadAttempt]</span>
<span class="sd">    object to initiate and/or retry a multipart file upload or copy. This function is wrapped by</span>
<span class="sd">    [multipart_upload_file][synapseclient.core.upload.multipart_upload.multipart_upload_file],</span>
<span class="sd">    [multipart_upload_string][synapseclient.core.upload.multipart_upload.multipart_upload_string], and</span>
<span class="sd">    [multipart_copy][synapseclient.core.upload.multipart_upload.multipart_copy].</span>
<span class="sd">    Retries cannot exceed 7 retries per call.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: A Synapse object</span>
<span class="sd">        dest_file_name: upload as a different filename</span>
<span class="sd">        upload_request: A dictionary object with the user-fed logistical</span>
<span class="sd">                        details of the upload/copy request.</span>
<span class="sd">        part_fn: Function to calculate the partSize of each part</span>
<span class="sd">        md5_fn: Function to calculate the MD5 of the file-like object</span>
<span class="sd">        max_threads: number of concurrent threads to devote to upload.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A File Handle ID</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_threads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_threads</span> <span class="o">=</span> <span class="n">pool_provider</span><span class="o">.</span><span class="n">DEFAULT_NUM_THREADS</span>

    <span class="n">max_threads</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_threads</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">upload_status_response</span> <span class="o">=</span> <span class="n">UploadAttempt</span><span class="p">(</span>
                <span class="n">syn</span><span class="p">,</span>
                <span class="n">dest_file_name</span><span class="p">,</span>
                <span class="n">upload_request</span><span class="p">,</span>
                <span class="n">part_fn</span><span class="p">,</span>
                <span class="n">md5_fn</span><span class="p">,</span>
                <span class="n">max_threads</span><span class="p">,</span>
                <span class="c1"># only force_restart the first time through (if requested).</span>
                <span class="c1"># a retry after a caught exception will not restart the upload</span>
                <span class="c1"># from scratch.</span>
                <span class="n">force_restart</span> <span class="ow">and</span> <span class="n">retry</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">)()</span>

            <span class="c1"># success</span>
            <span class="k">return</span> <span class="n">upload_status_response</span><span class="p">[</span><span class="s2">&quot;resultFileHandleId&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="n">SynapseUploadFailedException</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">retry</span> <span class="o">&lt;</span> <span class="n">MAX_RETRIES</span><span class="p">:</span>
                <span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="upload-async">Upload Async<a class="headerlink" href="#upload-async" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.upload.upload_functions_async" class="doc doc-heading">
            <code>synapseclient.core.upload.upload_functions_async</code>


<a href="#synapseclient.core.upload.upload_functions_async" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This module handles the various ways that a user can upload a file to Synapse.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.upload.upload_functions_async-classes">Classes<a href="#synapseclient.core.upload.upload_functions_async-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="synapseclient.core.upload.upload_functions_async-functions">Functions<a href="#synapseclient.core.upload.upload_functions_async-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.upload_file_handle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file_handle</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">parent_entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">synapse_store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.upload_file_handle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Uploads the file in the provided path (if necessary) to a storage location based
on project settings. Returns a new FileHandle as a dict to represent the
stored file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The synapse client</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>parent_entity_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ID of the parent entity that the file will be attached to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file path to the file being uploaded</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_store</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If False, will not upload the file, but instead create an
ExternalFileHandle that references the file on the local machine. If True,
will upload the file based on StorageLocation determined by the
parent_entity_id.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MD5 checksum for the file, if known. Otherwise if the file is a
local file, it will be calculated automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The size the file, if known. Otherwise if the file is a local file,
it will be calculated automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mimetype</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MIME type the file, if known. Otherwise if the file is a local
file, it will be calculated automatically.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A dictionary of a new FileHandle as a dict that represents the uploaded file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">upload_file_handle</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">parent_entity_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">synapse_store</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uploads the file in the provided path (if necessary) to a storage location based</span>
<span class="sd">    on project settings. Returns a new FileHandle as a dict to represent the</span>
<span class="sd">    stored file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: The synapse client</span>
<span class="sd">        parent_entity_id: The ID of the parent entity that the file will be attached to.</span>
<span class="sd">        path: The file path to the file being uploaded</span>
<span class="sd">        synapse_store: If False, will not upload the file, but instead create an</span>
<span class="sd">            ExternalFileHandle that references the file on the local machine. If True,</span>
<span class="sd">            will upload the file based on StorageLocation determined by the</span>
<span class="sd">            parent_entity_id.</span>
<span class="sd">        md5: The MD5 checksum for the file, if known. Otherwise if the file is a</span>
<span class="sd">            local file, it will be calculated automatically.</span>
<span class="sd">        file_size: The size the file, if known. Otherwise if the file is a local file,</span>
<span class="sd">            it will be calculated automatically.</span>
<span class="sd">        mimetype: The MIME type the file, if known. Otherwise if the file is a local</span>
<span class="sd">            file, it will be calculated automatically.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of a new FileHandle as a dict that represents the uploaded file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;path can not be None&quot;</span><span class="p">)</span>

    <span class="c1"># if doing a external file handle with no actual upload</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">synapse_store</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">create_external_file_handle</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span>
        <span class="p">)</span>

    <span class="c1"># expand the path because past this point an upload is required and some upload functions require an absolute path</span>
    <span class="n">expanded_upload_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">md5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">expanded_upload_path</span><span class="p">):</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="k">await</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file_multiprocessing</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">process_pool_executor</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_process_pool_executor</span><span class="p">(</span>
                <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">md5_semaphore</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_md5_semaphore</span><span class="p">(</span>
                <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="n">entity_parent_id</span> <span class="o">=</span> <span class="n">id_of</span><span class="p">(</span><span class="n">parent_entity_id</span><span class="p">)</span>

    <span class="c1"># determine the upload function based on the UploadDestination</span>
    <span class="n">location</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_upload_destination</span><span class="p">(</span>
        <span class="n">entity_id</span><span class="o">=</span><span class="n">entity_parent_id</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span>
    <span class="p">)</span>
    <span class="n">upload_destination_type</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concreteType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">location</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;synapse.parent_id&quot;</span><span class="p">:</span> <span class="n">entity_parent_id</span><span class="p">,</span>
            <span class="s2">&quot;synapse.upload_destination_type&quot;</span><span class="p">:</span> <span class="n">upload_destination_type</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_boto_sts_transfer_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span>
        <span class="ow">and</span> <span class="k">await</span> <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_storage_location_sts_enabled_async</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="n">entity_parent_id</span><span class="p">,</span> <span class="n">location</span>
        <span class="p">)</span>
        <span class="ow">and</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">upload_synapse_sts_boto_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="n">entity_parent_id</span><span class="p">,</span>
            <span class="n">upload_destination</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="s2">&quot;Uploading file to external S3 storage using boto3&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">SYNAPSE_S3_UPLOAD_DESTINATION</span><span class="p">,</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span><span class="p">,</span>
        <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_GCP_UPLOAD_DESTINATION</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">SYNAPSE_S3_UPLOAD_DESTINATION</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;Uploading to Synapse storage&quot;</span>
        <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_S3_UPLOAD_DESTINATION</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;Uploading to your external S3 storage&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="s2">&quot;Uploading to your external Google Bucket storage&quot;</span>

        <span class="k">return</span> <span class="k">await</span> <span class="n">upload_synapse_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">storage_location_id</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">],</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># external file handle (sftp)</span>
    <span class="k">elif</span> <span class="n">upload_destination_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_UPLOAD_DESTINATION</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">location</span><span class="p">[</span><span class="s2">&quot;uploadType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SFTP&quot;</span><span class="p">:</span>
            <span class="n">storage_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Uploading to: </span><span class="si">{</span><span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">netloc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">banner</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;banner&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">banner</span><span class="p">:</span>
                <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">upload_external_file_handle_sftp</span><span class="p">(</span>
                <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
                <span class="n">sftp_url</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
                <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
                <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only handle SFTP upload locations.&quot;</span><span class="p">)</span>
    <span class="c1"># client authenticated S3</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">upload_destination_type</span>
        <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_OBJECT_STORE_UPLOAD_DESTINATION</span>
    <span class="p">):</span>
        <span class="n">storage_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Uploading to endpoint: [</span><span class="si">{</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endpointUrl&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">] bucket: [</span><span class="si">{</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bucket&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="n">banner</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;banner&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">banner</span><span class="p">:</span>
            <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">upload_client_auth_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">],</span>
            <span class="n">endpoint_url</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;endpointUrl&quot;</span><span class="p">],</span>
            <span class="n">key_prefix</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;keyPrefixUUID&quot;</span><span class="p">],</span>
            <span class="n">storage_location_id</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">],</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># unknown storage location</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">upload_synapse_s3</span><span class="p">(</span>
            <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">expanded_upload_path</span><span class="p">,</span>
            <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="s2">&quot;Uploading to Synapse storage&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.create_external_file_handle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_external_file_handle</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.create_external_file_handle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Create a file handle in Synapse without uploading any files. This is used in
cases where one wishes to store a reference to a file that is not in Synapse.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">create_external_file_handle</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">file_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a file handle in Synapse without uploading any files. This is used in</span>
<span class="sd">    cases where one wishes to store a reference to a file that is not in Synapse.&quot;&quot;&quot;</span>
    <span class="n">is_local_file</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># defaults to false</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">as_url</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">is_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">parsed_path</span> <span class="o">=</span> <span class="n">file_url_to_path</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">parsed_path</span><span class="p">):</span>
            <span class="n">actual_md5</span> <span class="o">=</span> <span class="k">await</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file_multiprocessing</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">parsed_path</span><span class="p">,</span>
                <span class="n">process_pool_executor</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_process_pool_executor</span><span class="p">(</span>
                    <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="n">md5_semaphore</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_md5_semaphore</span><span class="p">(</span>
                    <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">md5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">md5</span> <span class="o">!=</span> <span class="n">actual_md5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SynapseMd5MismatchError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The specified md5 [</span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">] does not match the calculated md5 &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">actual_md5</span><span class="si">}</span><span class="s2">] for local file [</span><span class="si">{</span><span class="n">parsed_path</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">md5</span> <span class="o">=</span> <span class="n">actual_md5</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">parsed_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
            <span class="n">is_local_file</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;externalUrl [</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">] is not a valid url&quot;</span><span class="p">)</span>

    <span class="c1"># just creates the file handle because there is nothing to upload</span>
    <span class="n">file_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_external_filehandle</span><span class="p">(</span>
        <span class="n">external_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_local_file</span><span class="p">:</span>
        <span class="n">syn</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">file_url_to_path</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span>
        <span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;synapse.file_handle_id&quot;</span><span class="p">:</span> <span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">file_handle</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.upload_external_file_handle_sftp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_external_file_handle_sftp</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">sftp_url</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.upload_external_file_handle_sftp" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to an SFTP server and create a file handle in Synapse.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">upload_external_file_handle_sftp</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sftp_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to an SFTP server and create a file handle in Synapse.&quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">_getUserCredentials</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">sftp_url</span><span class="p">)</span>
    <span class="n">uploaded_url</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
        <span class="n">file_path</span><span class="p">,</span>
        <span class="n">urllib_parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">sftp_url</span><span class="p">),</span>
        <span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">file_md5</span> <span class="o">=</span> <span class="n">md5</span> <span class="ow">or</span> <span class="k">await</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file_multiprocessing</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
        <span class="n">process_pool_executor</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_process_pool_executor</span><span class="p">(</span>
            <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="p">),</span>
        <span class="n">md5_semaphore</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_md5_semaphore</span><span class="p">(</span>
            <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">file_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_external_filehandle</span><span class="p">(</span>
        <span class="n">external_url</span><span class="o">=</span><span class="n">uploaded_url</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">file_md5</span><span class="p">,</span>
        <span class="n">file_size</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">syn</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">file_md5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file_handle</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.upload_synapse_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_synapse_s3</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_s3" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to Synapse storage and create a file handle in Synapse.</p>


<details class="argments" open>
  <summary>Argments</summary>
  <p>syn: The synapse client
file_path: The path to the file to upload.
storage_location_id: The storage location ID.
mimetype: The mimetype of the file.
force_restart: If True, will force the upload to restart.
md5: The MD5 checksum for the file.
storage_str: The storage string.</p>
</details>

<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A dictionary of the file handle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">upload_synapse_s3</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to Synapse storage and create a file handle in Synapse.</span>

<span class="sd">    Argments:</span>
<span class="sd">        syn: The synapse client</span>
<span class="sd">        file_path: The path to the file to upload.</span>
<span class="sd">        storage_location_id: The storage location ID.</span>
<span class="sd">        mimetype: The mimetype of the file.</span>
<span class="sd">        force_restart: If True, will force the upload to restart.</span>
<span class="sd">        md5: The MD5 checksum for the file.</span>
<span class="sd">        storage_str: The storage string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of the file handle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_handle_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">multipart_upload_file_async</span><span class="p">(</span>
        <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
        <span class="n">storage_location_id</span><span class="o">=</span><span class="n">storage_location_id</span><span class="p">,</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">syn</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">)</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">get_file_handle</span><span class="p">(</span><span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.upload_synapse_sts_boto_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_synapse_sts_boto_s3</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">upload_destination</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.upload_synapse_sts_boto_s3" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>When uploading to Synapse storage normally the back end will generate a random prefix
for our uploaded object. Since in this case the client is responsible for the remote
key, the client will instead generate a random prefix. this both ensures we don't have a collision
with an existing S3 object and also mitigates potential performance issues, although
key locality performance issues are likely resolved as of:
<a href="https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/">https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/</a></p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The synapse client</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>parent_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The synapse ID of the parent.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upload_destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The upload destination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>local_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The local path to the file to upload.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mimetype</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The mimetype is known. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>MD5 checksum for the file, if known.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, bool]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">upload_synapse_sts_boto_s3</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">upload_destination</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When uploading to Synapse storage normally the back end will generate a random prefix</span>
<span class="sd">    for our uploaded object. Since in this case the client is responsible for the remote</span>
<span class="sd">    key, the client will instead generate a random prefix. this both ensures we don&#39;t have a collision</span>
<span class="sd">    with an existing S3 object and also mitigates potential performance issues, although</span>
<span class="sd">    key locality performance issues are likely resolved as of:</span>
<span class="sd">    &lt;https://aws.amazon.com/about-aws/whats-new/2018/07/amazon-s3-announces-increased-request-rate-performance/&gt;</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: The synapse client</span>
<span class="sd">        parent_id: The synapse ID of the parent.</span>
<span class="sd">        upload_destination: The upload destination</span>
<span class="sd">        local_path: The local path to the file to upload.</span>
<span class="sd">        mimetype: The mimetype is known. Defaults to None.</span>
<span class="sd">        md5: MD5 checksum for the file, if known.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_prefix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">upload_destination</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">]</span>
    <span class="n">storage_location_id</span> <span class="o">=</span> <span class="n">upload_destination</span><span class="p">[</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">]</span>
    <span class="n">remote_file_key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">upload_destination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;baseKey&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">key_prefix</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload_fn</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper for the upload function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
            <span class="n">endpoint_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">remote_file_key</span><span class="o">=</span><span class="n">remote_file_key</span><span class="p">,</span>
            <span class="n">upload_file_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">transfer_config_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">:</span> <span class="n">syn</span><span class="o">.</span><span class="n">max_threads</span><span class="p">},</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
        <span class="n">syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">sts_transfer</span><span class="o">.</span><span class="n">with_boto_sts_credentials</span><span class="p">(</span>
            <span class="n">upload_fn</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="s2">&quot;read_write&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">post_external_s3_file_handle</span><span class="p">(</span>
        <span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
        <span class="n">s3_file_key</span><span class="o">=</span><span class="n">remote_file_key</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
        <span class="n">storage_location_id</span><span class="o">=</span><span class="n">storage_location_id</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.upload_functions_async.upload_client_auth_s3" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_client_auth_s3</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="p">,</span> <span class="n">key_prefix</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.upload_functions_async.upload_client_auth_s3" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Use the S3 client to upload a file to an S3 bucket.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/upload_functions_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">upload_client_auth_s3</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">key_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mimetype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use the S3 client to upload a file to an S3 bucket.&quot;&quot;&quot;</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">get_client_authenticated_s3_profile</span><span class="p">(</span>
        <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">configPath</span>
    <span class="p">)</span>
    <span class="n">file_key</span> <span class="o">=</span> <span class="n">key_prefix</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

    <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
        <span class="n">syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
            <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">,</span>
            <span class="n">remote_file_key</span><span class="o">=</span><span class="n">file_key</span><span class="p">,</span>
            <span class="n">upload_file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">profile_name</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">_get_aws_credentials</span><span class="p">(),</span>
            <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">file_handle</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_external_object_store_filehandle</span><span class="p">(</span>
        <span class="n">s3_file_key</span><span class="o">=</span><span class="n">file_key</span><span class="p">,</span>
        <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
        <span class="n">storage_location_id</span><span class="o">=</span><span class="n">storage_location_id</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">,</span>
        <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">syn</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">md5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_handle</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="multipart-upload-async">Multipart Upload Async<a class="headerlink" href="#multipart-upload-async" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.upload.multipart_upload_async" class="doc doc-heading">
            <code>synapseclient.core.upload.multipart_upload_async</code>


<a href="#synapseclient.core.upload.multipart_upload_async" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>Implements the client side of Synapse's
<a href="https://rest-docs.synapse.org/rest/index.html#org.sagebionetworks.file.controller.UploadController">Multipart File Upload API</a>,
which provides a robust means of uploading large files (into the 10s of GiB). End users
should not need to call any of the methods under
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload.UploadAttempt">UploadAttempt</a> directly.</p>
<p>This mermaid flowchart illustrates the process of uploading a file to Synapse using
the multipart upload API.</p>
<pre class="mermaid"><code>flowchart  TD
    upload_file_handle --&gt; before-upload
    subgraph before-upload
        subgraph Disk I/O &amp; CPU
            subgraph Multi-Processing
                md5["Calculate MD5"]
            end
            mime["Guess mime type"]
            file_size["Get file size"]
            file_name["Get file name"]
        end

        subgraph HTTP
            upload_destination["Find where to Upload 
 GET /entity/{entity_id}/uploadDestination"]
            start_upload["Start upload with Synapse 
 POST /file/multipart"]
            presigned_urls["Get URLs to upload to 
 POST /file/multipart/{upload_id}/presigned/url/batch"]
        end
    end

    before-upload --&gt; during-upload

    subgraph during-upload
        subgraph multi-threaded["multi-threaded for each part"]
            read_part["Read part to upload into Memory"]
            read_part --&gt; put_part["HTTP PUT to storage provider"]

            subgraph thread_locked1["Lock thread"]
                refresh_check{"New URl available?"}
                refresh_check --&gt; |no|refresh
                refresh["Refresh remaining URLs to upload to 
 POST /file/multipart/{upload_id}/presigned/url/batch"]
            end


            put_part --&gt; |URL Expired|refresh_check
            refresh_check --&gt; |yes|put_part
            refresh --&gt; put_part
            put_part --&gt; |Finished|md5_part["Calculate MD5 of part"]
        end
        complete_part["PUT /file/multipart/{upload_id}/add/{part_number}?partMD5Hex={md5_hex}"]
        multi-threaded --&gt;|Upload finished| complete_part
    end

    during-upload --&gt; post-upload

    subgraph post-upload
        post_upload_compelete["PUT /file/multipart/{upload_id}/complete"]
        get_file_handle["GET /fileHandle/{file_handle_id}"]
    end

    post-upload --&gt; entity["Create/Update Synapse entity"]</code></pre>



  <div class="doc doc-children">






<h3 id="synapseclient.core.upload.multipart_upload_async-classes">Classes<a href="#synapseclient.core.upload.multipart_upload_async-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.upload.multipart_upload_async.HandlePartResult" class="doc doc-heading">
            <code>HandlePartResult</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#synapseclient.core.upload.multipart_upload_async.HandlePartResult" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Result of a part upload.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.upload.multipart_upload_async.HandlePartResult.part_number">part_number</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The part number that was uploaded.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.upload.multipart_upload_async.HandlePartResult.part_size">part_size</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The size of the part that was uploaded.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.upload.multipart_upload_async.HandlePartResult.md5_hex">md5_hex</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The MD5 hash of the part that was uploaded.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">HandlePartResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a part upload.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        part_number: The part number that was uploaded.</span>
<span class="sd">        part_size: The size of the part that was uploaded.</span>
<span class="sd">        md5_hex: The MD5 hash of the part that was uploaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">md5_hex</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.upload.multipart_upload_async.UploadAttemptAsync" class="doc doc-heading">
            <code>UploadAttemptAsync</code>


<a href="#synapseclient.core.upload.multipart_upload_async.UploadAttemptAsync" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Used to handle multi-threaded operations for uploading one or parts of a file.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UploadAttemptAsync</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to handle multi-threaded operations for uploading one or parts of a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">upload_request_payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">part_request_body_provider_fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">]],</span>
        <span class="n">md5_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span> <span class="o">=</span> <span class="n">syn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span> <span class="o">=</span> <span class="n">dest_file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_part_size</span> <span class="o">=</span> <span class="n">upload_request_payload</span><span class="p">[</span><span class="s2">&quot;partSizeBytes&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span> <span class="o">=</span> <span class="n">upload_request_payload</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span> <span class="o">=</span> <span class="n">part_request_body_provider_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_md5_fn</span> <span class="o">=</span> <span class="n">md5_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_force_restart</span> <span class="o">=</span> <span class="n">force_restart</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_str</span> <span class="o">=</span> <span class="n">storage_str</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_close_progress_bar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_thread_local</span><span class="p">,</span> <span class="s2">&quot;progress_bar&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># populated later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Orchestrate the upload of a file to Synapse.&quot;&quot;&quot;</span>
        <span class="n">upload_status_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_file_multipart</span><span class="p">(</span>
            <span class="n">upload_request_payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="p">,</span>
            <span class="n">force_restart</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_force_restart</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
            <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">upload_state</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_state</span> <span class="o">!=</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="p">[</span><span class="s2">&quot;uploadId&quot;</span><span class="p">]</span>
            <span class="n">part_count</span><span class="p">,</span> <span class="n">remaining_part_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_remaining_part_numbers</span><span class="p">(</span>
                <span class="n">upload_status_response</span>
            <span class="p">)</span>

            <span class="c1"># if no remaining part numbers then all the parts have been</span>
            <span class="c1"># uploaded but the upload has not been marked complete.</span>
            <span class="k">if</span> <span class="n">remaining_part_numbers</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_parts</span><span class="p">(</span><span class="n">part_count</span><span class="p">,</span> <span class="n">remaining_part_numbers</span><span class="p">)</span>
            <span class="n">upload_status_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complete_upload</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">upload_status_response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_remaining_part_numbers</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">upload_status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="n">part_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parts_state</span> <span class="o">=</span> <span class="n">upload_status</span><span class="p">[</span><span class="s2">&quot;partsState&quot;</span><span class="p">]</span>

        <span class="c1"># parts are 1-based</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part_status</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts_state</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">part_status</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
                <span class="n">part_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts_state</span><span class="p">),</span> <span class="n">part_numbers</span>

    <span class="k">def</span> <span class="nf">_is_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># is this a copy or upload request</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concreteType&quot;</span><span class="p">)</span>
            <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_COPY_REQUEST</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_fetch_pre_signed_part_urls_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">upload_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">part_numbers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.upload_id&quot;</span><span class="p">:</span> <span class="n">upload_id</span><span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_file_multipart_presigned_urls</span><span class="p">(</span>
            <span class="n">upload_id</span><span class="o">=</span><span class="n">upload_id</span><span class="p">,</span>
            <span class="n">part_numbers</span><span class="o">=</span><span class="n">part_numbers</span><span class="p">,</span>
            <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">part_urls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;partPresignedUrls&quot;</span><span class="p">]:</span>
            <span class="n">part_urls</span><span class="p">[</span><span class="n">part</span><span class="p">[</span><span class="s2">&quot;partNumber&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">part</span><span class="p">[</span><span class="s2">&quot;uploadPresignedUrl&quot;</span><span class="p">],</span>
                <span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;signedHeaders&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">part_urls</span>

    <span class="k">def</span> <span class="nf">_refresh_pre_signed_part_urls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">expired_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh all unfetched presigned urls, and return the refreshed</span>
<span class="sd">        url for the given part number. If an existing expired_url is passed</span>
<span class="sd">        and the url for the given part has already changed that new url</span>
<span class="sd">        will be returned without a refresh (i.e. it is assumed that another</span>
<span class="sd">        thread has already refreshed the url since the passed url expired).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            part_number: the part number whose refreshed url should</span>
<span class="sd">                         be returned</span>
<span class="sd">            expired_url: the url that was detected as expired triggering</span>
<span class="sd">                         this refresh</span>
<span class="sd">        Returns:</span>
<span class="sd">            refreshed URL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_lock</span><span class="p">:</span>
            <span class="n">current_url</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">current_url</span> <span class="o">!=</span> <span class="n">expired_url</span><span class="p">:</span>
                <span class="c1"># if the url has already changed since the given url</span>
                <span class="c1"># was detected as expired we can assume that another</span>
                <span class="c1"># thread already refreshed the url and can avoid the extra</span>
                <span class="c1"># fetch.</span>
                <span class="n">refreshed_url</span> <span class="o">=</span> <span class="n">current_url</span><span class="p">,</span> <span class="n">headers</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span> <span class="o">=</span> <span class="n">wrap_async_to_sync</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_pre_signed_part_urls_async</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
                        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                    <span class="p">),</span>
                    <span class="n">syn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">refreshed_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">refreshed_url</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_handle_part_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HandlePartResult</span><span class="p">:</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="n">otel_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>

        <span class="n">mem_info</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mem_info</span><span class="o">.</span><span class="n">available</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_part</span><span class="p">,</span>
            <span class="n">part_number</span><span class="p">,</span>
            <span class="n">otel_context</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_upload_parts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">part_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">remaining_part_numbers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a list of part numbers and upload them to the pre-signed URLs.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            part_count: The total number of parts in the upload.</span>
<span class="sd">            remaining_part_numbers: The parts that still need to be uploaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">completed_part_count</span> <span class="o">=</span> <span class="n">part_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_part_numbers</span><span class="p">)</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_request_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_pre_signed_part_urls_async</span><span class="p">(</span>
            <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
            <span class="n">part_numbers</span><span class="o">=</span><span class="n">remaining_part_numbers</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">async_tasks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">part_number</span> <span class="ow">in</span> <span class="n">remaining_part_numbers</span><span class="p">:</span>
            <span class="n">async_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_part_wrapper</span><span class="p">(</span><span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_copy</span><span class="p">():</span>
                <span class="c1"># we won&#39;t have bytes to measure during a copy so the byte oriented</span>
                <span class="c1"># progress bar is not useful</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">_thread_local</span><span class="p">,</span> <span class="s2">&quot;progress_bar&quot;</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">part_count</span><span class="p">,</span>
                    <span class="n">desc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage_str</span> <span class="ow">or</span> <span class="s2">&quot;Copying&quot;</span><span class="p">,</span>
                    <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">postfix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span><span class="p">,</span>
                    <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">completed_part_count</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previously_transferred</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">completed_part_count</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_size</span><span class="p">,</span>
                    <span class="n">file_size</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">_thread_local</span><span class="p">,</span> <span class="s2">&quot;progress_bar&quot;</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                    <span class="n">desc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage_str</span> <span class="ow">or</span> <span class="s2">&quot;Uploading&quot;</span><span class="p">,</span>
                    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
                    <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">postfix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dest_file_name</span><span class="p">,</span>
                    <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">previously_transferred</span><span class="p">)</span>

        <span class="n">raised_exception</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orchestrate_upload_part_tasks</span><span class="p">(</span><span class="n">async_tasks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">raised_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raised_exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SynapseUploadAbortedException</span><span class="p">(</span>
                    <span class="s2">&quot;User interrupted upload&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">raised_exception</span>
            <span class="k">raise</span> <span class="n">SynapseUploadFailedException</span><span class="p">(</span>
                <span class="s2">&quot;Part upload failed&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">raised_exception</span>

    <span class="k">def</span> <span class="nf">_update_progress_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the progress bar with the given part size.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">silent</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_copy</span><span class="p">()</span> <span class="k">else</span> <span class="n">part_size</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_orchestrate_upload_part_tasks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">async_tasks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Orchestrate the result of the upload part tasks. If successful, send a</span>
<span class="sd">        request to the server to add the part to the upload.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            async_tasks: A set of tasks to orchestrate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An exception if one was raised, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raised_exception</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="n">async_tasks</span><span class="p">:</span>
            <span class="n">done_tasks</span><span class="p">,</span> <span class="n">pending_tasks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
                <span class="n">async_tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
            <span class="p">)</span>
            <span class="n">async_tasks</span> <span class="o">=</span> <span class="n">pending_tasks</span>
            <span class="k">for</span> <span class="n">completed_task</span> <span class="ow">in</span> <span class="n">done_tasks</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">task_result</span> <span class="o">=</span> <span class="n">completed_task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_result</span><span class="p">,</span> <span class="n">HandlePartResult</span><span class="p">):</span>
                        <span class="n">part_number</span> <span class="o">=</span> <span class="n">task_result</span><span class="o">.</span><span class="n">part_number</span>
                        <span class="n">part_size</span> <span class="o">=</span> <span class="n">task_result</span><span class="o">.</span><span class="n">part_size</span>
                        <span class="n">part_md5_hex</span> <span class="o">=</span> <span class="n">task_result</span><span class="o">.</span><span class="n">md5_hex</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_result</span><span class="p">,</span> <span class="n">AddPartResponse</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">task_result</span><span class="o">.</span><span class="n">add_part_state</span> <span class="o">!=</span> <span class="s2">&quot;ADD_SUCCESS&quot;</span>
                    <span class="p">):</span>
                        <span class="c1"># Restart the file upload process resuming where this left off.</span>
                        <span class="c1"># Rest docs state:</span>
                        <span class="c1"># &quot;If add part fails for any reason, the client must re-upload</span>
                        <span class="c1"># the part and then re-attempt to add the part to the upload.&quot;</span>
                        <span class="k">raise</span> <span class="n">SynapseUploadFailedException</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="s2">&quot;Adding individual part failed with unexpected state: &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task_result</span><span class="o">.</span><span class="n">add_part_state</span><span class="si">}</span><span class="s2">, for upload &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task_result</span><span class="o">.</span><span class="n">upload_id</span><span class="si">}</span><span class="s2"> and part &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task_result</span><span class="o">.</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> with message: &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task_result</span><span class="o">.</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">async_tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                            <span class="n">put_file_multipart_add</span><span class="p">(</span>
                                <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
                                <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
                                <span class="n">md5_hex</span><span class="o">=</span><span class="n">part_md5_hex</span><span class="p">,</span>
                                <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_progress_bar</span><span class="p">(</span><span class="n">part_size</span><span class="o">=</span><span class="n">part_size</span><span class="p">)</span>

                <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">cause</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_lock</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
                            <span class="c1"># we&#39;ve already aborted, no need to raise</span>
                            <span class="c1"># another exception</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">raised_exception</span> <span class="o">=</span> <span class="n">cause</span>
                    <span class="k">continue</span>
        <span class="k">return</span> <span class="n">raised_exception</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_complete_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the upload and mark it as complete.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The response from the server for the completed upload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_close_progress_bar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">upload_status_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">put_file_multipart_complete</span><span class="p">(</span>
            <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_id</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
            <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">upload_state</span> <span class="o">=</span> <span class="n">upload_status_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upload_state</span> <span class="o">!=</span> <span class="s2">&quot;COMPLETED&quot;</span><span class="p">:</span>
            <span class="c1"># at this point we think successfully uploaded all the parts</span>
            <span class="c1"># but the upload status isn&#39;t complete, we&#39;ll throw an error</span>
            <span class="c1"># and let a subsequent attempt try to reconcile</span>
            <span class="k">raise</span> <span class="n">SynapseUploadFailedException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Upload status has an unexpected state </span><span class="si">{</span><span class="n">upload_state</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">upload_status_response</span>

    <span class="k">def</span> <span class="nf">_handle_part</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">otel_context</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Context</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HandlePartResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take an individual part number and upload it to the pre-signed URL.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            part_number: The part number to upload.</span>
<span class="sd">            otel_context: The OpenTelemetry context to use for tracing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the part upload.</span>

<span class="sd">        Raises:</span>
<span class="sd">            SynapseUploadAbortedException: If the upload has been aborted.</span>
<span class="sd">            ValueError: If the part body is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">otel_context</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">otel_context</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
                <span class="c1"># this upload attempt has already been aborted</span>
                <span class="c1"># so we short circuit the attempt to upload this part</span>
                <span class="k">raise</span> <span class="n">SynapseUploadAbortedException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Upload aborted, skipping part </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">part_url</span><span class="p">,</span> <span class="n">signed_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>

        <span class="n">session</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">_requests_session_storage</span>

        <span class="c1"># obtain the body (i.e. the upload bytes) for the given part number.</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_request_body_provider_fn</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">part_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploading part </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> of size </span><span class="si">{</span><span class="n">part_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_copy</span><span class="p">()</span> <span class="ow">and</span> <span class="n">body</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No body for part </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_put_part_with_retry</span><span class="p">(</span>
            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">part_url</span><span class="o">=</span><span class="n">part_url</span><span class="p">,</span>
            <span class="n">signed_headers</span><span class="o">=</span><span class="n">signed_headers</span><span class="p">,</span>
            <span class="n">part_number</span><span class="o">=</span><span class="n">part_number</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">md5_hex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_md5_fn</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">response</span>
        <span class="k">del</span> <span class="n">body</span>

        <span class="c1"># # remove so future batch pre_signed url fetches will exclude this part</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_lock</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_signed_part_urls</span><span class="p">[</span><span class="n">part_number</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">HandlePartResult</span><span class="p">(</span><span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span><span class="p">,</span> <span class="n">md5_hex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_put_part_with_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="n">part_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">signed_headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Put a part to the storage provider with retries.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            session: The requests session to use for the put.</span>
<span class="sd">            body: The body of the part to put.</span>
<span class="sd">            part_url: The URL to put the part to.</span>
<span class="sd">            signed_headers: The signed headers to use for the put.</span>
<span class="sd">            part_number: The part number being put.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The response from the put.</span>

<span class="sd">        Raises:</span>
<span class="sd">            SynapseHTTPError: If the put fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">retry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># use our backoff mechanism here, we have encountered 500s on puts to AWS signed urls</span>

                <span class="n">response</span> <span class="o">=</span> <span class="n">with_retry_time_based</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">part_url</span><span class="o">=</span><span class="n">part_url</span><span class="p">,</span> <span class="n">signed_headers</span><span class="o">=</span><span class="n">signed_headers</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">part_url</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>  <span class="c1"># noqa: F821</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">signed_headers</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">retry_exceptions</span><span class="o">=</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="n">_raise_for_status_httpx</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

                <span class="c1"># completed upload part to s3 successfully</span>
                <span class="k">break</span>

            <span class="k">except</span> <span class="n">SynapseHTTPError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span> <span class="ow">and</span> <span class="n">retry</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># we interpret this to mean our pre_signed url expired.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The pre-signed upload URL for part </span><span class="si">{</span><span class="n">part_number</span><span class="si">}</span><span class="s2"> has expired. &quot;</span>
                        <span class="s2">&quot;Refreshing urls and retrying.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                    <span class="c1"># we refresh all the urls and obtain this part&#39;s</span>
                    <span class="c1"># specific url for the retry</span>
                    <span class="p">(</span>
                        <span class="n">part_url</span><span class="p">,</span>
                        <span class="n">signed_headers</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_pre_signed_part_urls</span><span class="p">(</span>
                        <span class="n">part_number</span><span class="p">,</span>
                        <span class="n">part_url</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.upload.multipart_upload_async-functions">Functions<a href="#synapseclient.core.upload.multipart_upload_async-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload_async.shared_progress_bar" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shared_progress_bar</span><span class="p">(</span><span class="n">progress_bar</span><span class="p">)</span></code>

<a href="#synapseclient.core.upload.multipart_upload_async.shared_progress_bar" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>An outside process that will eventually trigger an upload through this module
can configure a shared Progress Bar by running its code within this context manager.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">shared_progress_bar</span><span class="p">(</span><span class="n">progress_bar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An outside process that will eventually trigger an upload through this module</span>
<span class="sd">    can configure a shared Progress Bar by running its code within this context manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_thread_local</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="n">progress_bar</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">_thread_local</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">_thread_local</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">_thread_local</span><span class="o">.</span><span class="n">progress_bar</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload_async.multipart_upload_file_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_upload_file_async</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_file_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to a Synapse upload destination in chunks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a Synapse object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the file to upload</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>upload as a different filename</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>content_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Refers to the Content-Type of the API request.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of bytes per part. Minimum is 5MiB (5 * 1024 * 1024 bytes).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an id indicating where the file should be
                 stored. Retrieved from Synapse's UploadDestination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload
           from scratch, False to try to resume</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The MD5 of the file. If not provided, it will be calculated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_str</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional string to append to the upload message</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">multipart_upload_file_async</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to a Synapse upload destination in chunks.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: a Synapse object</span>
<span class="sd">        file_path: the file to upload</span>
<span class="sd">        dest_file_name: upload as a different filename</span>
<span class="sd">        content_type: Refers to the Content-Type of the API request.</span>
<span class="sd">        part_size: Number of bytes per part. Minimum is 5MiB (5 * 1024 * 1024 bytes).</span>
<span class="sd">        storage_location_id: an id indicating where the file should be</span>
<span class="sd">                             stored. Retrieved from Synapse&#39;s UploadDestination</span>
<span class="sd">        preview: True to generate a preview</span>
<span class="sd">        force_restart: True to restart a previously initiated upload</span>
<span class="sd">                       from scratch, False to try to resume</span>
<span class="sd">        md5: The MD5 of the file. If not provided, it will be calculated.</span>
<span class="sd">        storage_str: Optional string to append to the upload message</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;synapse.storage_location_id&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">storage_location_id</span> <span class="k">if</span> <span class="n">storage_location_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; not found.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File &quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&quot; is a directory.&#39;</span><span class="p">)</span>

    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dest_file_name</span><span class="p">:</span>
        <span class="n">dest_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">mime_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>

    <span class="n">md5_hex</span> <span class="o">=</span> <span class="n">md5</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="k">await</span> <span class="n">md5_for_file_multiprocessing</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">process_pool_executor</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_process_pool_executor</span><span class="p">(</span>
                <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">md5_semaphore</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">_get_md5_semaphore</span><span class="p">(</span>
                <span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">MIN_PART_SIZE</span><span class="p">,</span>
        <span class="n">MAX_NUMBER_OF_PARTS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="n">content_type</span><span class="p">,</span>
        <span class="s2">&quot;contentMD5Hex&quot;</span><span class="p">:</span> <span class="n">md5_hex</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">part_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the nth chunk of a file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_file_chunk</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">_multipart_upload_async</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">part_fn</span><span class="p">,</span>
        <span class="n">md5_fn_util</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload_async.multipart_upload_string_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_upload_string_async</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.multipart_upload_async.multipart_upload_string_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Upload a file to a Synapse upload destination in chunks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a Synapse object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a string to upload as a file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>upload as a different filename</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>content_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Refers to the Content-Type of the API request.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>number of bytes per part. Minimum 5MB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an id indicating where the file should be
                 stored. Retrieved from Synapse's UploadDestination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload
           from scratch, False to try to resume</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">multipart_upload_string_async</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to a Synapse upload destination in chunks.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: a Synapse object</span>
<span class="sd">        text: a string to upload as a file.</span>
<span class="sd">        dest_file_name: upload as a different filename</span>
<span class="sd">        content_type: Refers to the Content-Type of the API request.</span>
<span class="sd">        part_size: number of bytes per part. Minimum 5MB.</span>
<span class="sd">        storage_location_id: an id indicating where the file should be</span>
<span class="sd">                             stored. Retrieved from Synapse&#39;s UploadDestination</span>
<span class="sd">        preview: True to generate a preview</span>
<span class="sd">        force_restart: True to restart a previously initiated upload</span>
<span class="sd">                       from scratch, False to try to resume</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">md5_hex</span> <span class="o">=</span> <span class="n">md5_fn_util</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dest_file_name</span><span class="p">:</span>
        <span class="n">dest_file_name</span> <span class="o">=</span> <span class="s2">&quot;message.txt&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="s2">&quot;text/plain; charset=utf-8&quot;</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">MIN_PART_SIZE</span><span class="p">,</span> <span class="n">MAX_NUMBER_OF_PARTS</span>
    <span class="p">)</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;contentType&quot;</span><span class="p">:</span> <span class="n">content_type</span><span class="p">,</span>
        <span class="s2">&quot;contentMD5Hex&quot;</span><span class="p">:</span> <span class="n">md5_hex</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;fileSizeBytes&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">part_fn</span><span class="p">(</span><span class="n">part_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nth chunk of a buffer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_data_chunk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">part_number</span><span class="p">,</span> <span class="n">part_size</span><span class="p">)</span>

    <span class="n">part_size</span> <span class="o">=</span> <span class="n">get_part_size</span><span class="p">(</span>
        <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">MIN_PART_SIZE</span><span class="p">,</span> <span class="n">MAX_NUMBER_OF_PARTS</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">_multipart_upload_async</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">part_fn</span><span class="p">,</span>
        <span class="n">md5_fn_util</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.upload.multipart_upload_async.multipart_copy_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multipart_copy_async</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">source_file_handle_association</span><span class="p">,</span> <span class="n">dest_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_location_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_restart</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.upload.multipart_upload_async.multipart_copy_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Makes a
<a href="https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/MultipartUploadCopyRequest.html">Multipart Upload Copy Request</a>.
This request performs a copy of an existing file handle without data transfer from the client.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A Synapse object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source_file_handle_association</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Describes an association of a FileHandle with another object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, str]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dest_file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The name of the file to be uploaded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>part_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The size that each part will be (in bytes).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>storage_location_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The identifier of the storage location where this file should be copied to.
                 The user must be the owner of the storage location.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>preview</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to generate a preview of the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_restart</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to restart a previously initiated upload from scratch, False to try to resume.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a File Handle ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Keyword arguments are passed down to
<a class="autorefs autorefs-internal" href="#synapseclient.core.upload.multipart_upload._multipart_upload">_multipart_upload()</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/upload/multipart_upload_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">multipart_copy_async</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">source_file_handle_association</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">dest_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">part_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_location_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">force_restart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes a</span>
<span class="sd">    [Multipart Upload Copy Request](https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/MultipartUploadCopyRequest.html).</span>
<span class="sd">    This request performs a copy of an existing file handle without data transfer from the client.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: A Synapse object</span>
<span class="sd">        source_file_handle_association: Describes an association of a FileHandle with another object.</span>
<span class="sd">        dest_file_name: The name of the file to be uploaded.</span>
<span class="sd">        part_size: The size that each part will be (in bytes).</span>
<span class="sd">        storage_location_id: The identifier of the storage location where this file should be copied to.</span>
<span class="sd">                             The user must be the owner of the storage location.</span>
<span class="sd">        preview: True to generate a preview of the data.</span>
<span class="sd">        force_restart: True to restart a previously initiated upload from scratch, False to try to resume.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a File Handle ID</span>

<span class="sd">    Keyword arguments are passed down to</span>
<span class="sd">    [_multipart_upload()][synapseclient.core.upload.multipart_upload._multipart_upload].</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">part_size</span> <span class="o">=</span> <span class="n">part_size</span> <span class="ow">or</span> <span class="n">DEFAULT_PART_SIZE</span>

    <span class="n">upload_request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;concreteType&quot;</span><span class="p">:</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">MULTIPART_UPLOAD_COPY_REQUEST</span><span class="p">,</span>
        <span class="s2">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="s2">&quot;generatePreview&quot;</span><span class="p">:</span> <span class="n">preview</span><span class="p">,</span>
        <span class="s2">&quot;partSizeBytes&quot;</span><span class="p">:</span> <span class="n">part_size</span><span class="p">,</span>
        <span class="s2">&quot;sourceFileHandleAssociation&quot;</span><span class="p">:</span> <span class="n">source_file_handle_association</span><span class="p">,</span>
        <span class="s2">&quot;storageLocationId&quot;</span><span class="p">:</span> <span class="n">storage_location_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">_multipart_upload_async</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span>
        <span class="n">dest_file_name</span><span class="p">,</span>
        <span class="n">upload_request</span><span class="p">,</span>
        <span class="n">copy_part_request_body_provider_fn</span><span class="p">,</span>
        <span class="n">copy_md5_fn</span><span class="p">,</span>
        <span class="n">force_restart</span><span class="o">=</span><span class="n">force_restart</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="multithreaded-downloading">Multithreaded Downloading<a class="headerlink" href="#multithreaded-downloading" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.multithread_download" class="doc doc-heading">
            <code>synapseclient.core.multithread_download</code>


<a href="#synapseclient.core.multithread_download" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">






<h3 id="synapseclient.core.multithread_download-classes">Classes<a href="#synapseclient.core.multithread_download-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.multithread_download.DownloadRequest" class="doc doc-heading">
            <code>DownloadRequest</code>


<a href="#synapseclient.core.multithread_download.DownloadRequest" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


      <p>A request to download a file from Synapse</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.multithread_download.DownloadRequest.file_handle_id">file_handle_id</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The file handle ID to download.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.multithread_download.DownloadRequest.object_id">object_id</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The Synapse object this file associated to.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.multithread_download.DownloadRequest.object_type">object_type</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The type of the associated Synapse object.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.multithread_download.DownloadRequest.path">path</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The local path to download the file to.
This path can be either an absolute path or
a relative path from where the code is executed to the download location.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.multithread_download.DownloadRequest.debug">debug</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>A boolean to specify if debug mode is on.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/multithread_download/download_threads.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;4.4.0&quot;</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;To be removed in 5.0.0. &quot;</span>
    <span class="s2">&quot;Moved to synapseclient/core/download/download_async.py&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">DownloadRequest</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A request to download a file from Synapse</span>

<span class="sd">    Attributes:</span>
<span class="sd">        file_handle_id : The file handle ID to download.</span>
<span class="sd">        object_id : The Synapse object this file associated to.</span>
<span class="sd">        object_type : The type of the associated Synapse object.</span>
<span class="sd">        path : The local path to download the file to.</span>
<span class="sd">            This path can be either an absolute path or</span>
<span class="sd">            a relative path from where the code is executed to the download location.</span>
<span class="sd">        debug: A boolean to specify if debug mode is on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_handle_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.multithread_download-functions">Functions<a href="#synapseclient.core.multithread_download-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.multithread_download.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">download_request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_concurrent_parts</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.multithread_download.download_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Main driver for the multi-threaded download. Users an ExecutorService,
either set externally onto a thread local by an outside process,
or creating one as needed otherwise.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A synapseclient</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>download_request</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A batch of DownloadRequest objects specifying what
                Synapse files to download</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.core.multithread_download.download_threads.DownloadRequest" href="#synapseclient.core.multithread_download.DownloadRequest">DownloadRequest</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_concurrent_parts</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum concurrent number parts to download
                    at once when downloading this file</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/multithread_download/download_threads.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;4.4.0&quot;</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;To be removed in 5.0.0. &quot;</span>
    <span class="s2">&quot;Moved to synapseclient/core/download/download_async.py&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
    <span class="n">client</span><span class="p">,</span>
    <span class="n">download_request</span><span class="p">:</span> <span class="n">DownloadRequest</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_concurrent_parts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main driver for the multi-threaded download. Users an ExecutorService,</span>
<span class="sd">    either set externally onto a thread local by an outside process,</span>
<span class="sd">    or creating one as needed otherwise.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        client: A synapseclient</span>
<span class="sd">        download_request: A batch of DownloadRequest objects specifying what</span>
<span class="sd">                            Synapse files to download</span>
<span class="sd">        max_concurrent_parts: The maximum concurrent number parts to download</span>
<span class="sd">                                at once when downloading this file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># we obtain an executor from a thread local if we are in the context of a Synapse sync</span>
    <span class="c1"># and wan&#39;t to re-use the same threadpool as was created for that</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_thread_local</span><span class="p">,</span> <span class="s2">&quot;executor&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">shutdown_after</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">shutdown_after</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">executor</span> <span class="o">=</span> <span class="n">get_executor</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">max_threads</span><span class="p">)</span>

    <span class="n">max_concurrent_parts</span> <span class="o">=</span> <span class="n">max_concurrent_parts</span> <span class="ow">or</span> <span class="n">client</span><span class="o">.</span><span class="n">max_threads</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">downloader</span> <span class="o">=</span> <span class="n">_MultithreadedDownloader</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">max_concurrent_parts</span><span class="p">)</span>
        <span class="n">downloader</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">download_request</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># if we created the Executor for the purposes of processing this download we also</span>
        <span class="c1"># shut it down. if it was passed in from the outside then it&#39;s managed by the caller</span>
        <span class="k">if</span> <span class="n">shutdown_after</span><span class="p">:</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.multithread_download.shared_executor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shared_executor</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span></code>

<a href="#synapseclient.core.multithread_download.shared_executor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>An outside process that will eventually trigger a download through the this module
can configure a shared Executor by running its code within this context manager.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/multithread_download/download_threads.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="nd">@deprecated</span><span class="p">(</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;4.4.0&quot;</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;To be removed in 5.0.0. &quot;</span>
    <span class="s2">&quot;Moved to synapseclient/core/download/download_async.py&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">shared_executor</span><span class="p">(</span><span class="n">executor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An outside process that will eventually trigger a download through the this module</span>
<span class="sd">    can configure a shared Executor by running its code within this context manager.&quot;&quot;&quot;</span>
    <span class="n">_thread_local</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">executor</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">_thread_local</span><span class="o">.</span><span class="n">executor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="download-functions">Download Functions<a class="headerlink" href="#download-functions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.download.download_functions" class="doc doc-heading">
            <code>synapseclient.core.download.download_functions</code>


<a href="#synapseclient.core.download.download_functions" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This module handles the various ways that a user can download a file to Synapse.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.download.download_functions-classes">Classes<a href="#synapseclient.core.download.download_functions-classes" class="headerlink" title="Permanent link">&para;</a></h3>
<h3 id="synapseclient.core.download.download_functions-functions">Functions<a href="#synapseclient.core.download.download_functions-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.download_file_entity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file_entity</span><span class="p">(</span><span class="n">download_location</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">if_collision</span><span class="p">,</span> <span class="n">submission</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_functions.download_file_entity" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Download file entity</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>download_location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The location on disk where the entity will be downloaded. If
there is a matching file at the location, the download collision will be
handled according to the <code>if_collision</code> argument.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entity</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Synapse Entity object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Entity" href="../entity/#synapseclient.entity.Entity">Entity</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>if_collision</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Determines how to handle file collisions.
                May be</p>
<ul>
<li><code>overwrite.local</code></li>
<li><code>keep.local</code></li>
<li><code>keep.both</code></li>
</ul>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>submission</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Access associated files through a submission rather than through an entity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not passed in or None this will use the last client from
the <code>.login()</code> method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">download_file_entity</span><span class="p">(</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">entity</span><span class="p">:</span> <span class="s2">&quot;Entity&quot;</span><span class="p">,</span>
    <span class="n">if_collision</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">submission</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download file entity</span>

<span class="sd">    Arguments:</span>
<span class="sd">        download_location: The location on disk where the entity will be downloaded. If</span>
<span class="sd">            there is a matching file at the location, the download collision will be</span>
<span class="sd">            handled according to the `if_collision` argument.</span>
<span class="sd">        entity:           The Synapse Entity object</span>
<span class="sd">        if_collision:      Determines how to handle file collisions.</span>
<span class="sd">                            May be</span>

<span class="sd">            - `overwrite.local`</span>
<span class="sd">            - `keep.local`</span>
<span class="sd">            - `keep.both`</span>

<span class="sd">        submission:       Access associated files through a submission rather than through an entity.</span>
<span class="sd">        synapse_client: If not passed in or None this will use the last client from</span>
<span class="sd">            the `.login()` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>
    <span class="c1"># set the initial local state</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">cacheDir</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># check to see if an UNMODIFIED version of the file (since it was last downloaded) already exists</span>
    <span class="c1"># this location could be either in .synapseCache or a user specified location to which the user previously</span>
    <span class="c1"># downloaded the file</span>
    <span class="n">cached_file_path</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">file_handle_id</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">dataFileHandleId</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">download_location</span>
    <span class="p">)</span>

    <span class="c1"># location in .synapseCache where the file would be corresponding to its FileHandleId</span>
    <span class="n">synapse_cache_location</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span>
        <span class="n">file_handle_id</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">dataFileHandleId</span>
    <span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">entity</span><span class="o">.</span><span class="n">_file_handle</span><span class="o">.</span><span class="n">fileName</span>
        <span class="k">if</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Decide the best download location for the file</span>
    <span class="k">if</span> <span class="n">download_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Make sure the specified download location is a fully resolved directory</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">ensure_download_location_is_directory</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># file already cached so use that as the download location</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># file not cached and no user-specified location so default to .synapseCache</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">synapse_cache_location</span>

    <span class="c1"># resolve file path collisions by either overwriting, renaming, or not downloading, depending on the</span>
    <span class="c1"># ifcollision value</span>
    <span class="n">download_path</span> <span class="o">=</span> <span class="n">resolve_download_path_collisions</span><span class="p">(</span>
        <span class="n">download_location</span><span class="o">=</span><span class="n">download_location</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">if_collision</span><span class="o">=</span><span class="n">if_collision</span><span class="p">,</span>
        <span class="n">synapse_cache_location</span><span class="o">=</span><span class="n">synapse_cache_location</span><span class="p">,</span>
        <span class="n">cached_file_path</span><span class="o">=</span><span class="n">cached_file_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">download_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># copy from cache</span>
        <span class="k">if</span> <span class="n">download_path</span> <span class="o">!=</span> <span class="n">cached_file_path</span><span class="p">:</span>
            <span class="c1"># create the foider if it does not exist already</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_location</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span>
            <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Copying existing file from </span><span class="si">{</span><span class="n">cached_file_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">download_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># download the file from URL (could be a local file)</span>
        <span class="n">object_type</span> <span class="o">=</span> <span class="s2">&quot;FileEntity&quot;</span> <span class="k">if</span> <span class="n">submission</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;SubmissionAttachment&quot;</span>
        <span class="n">object_id</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">submission</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">submission</span>

        <span class="c1"># reassign downloadPath because if url points to local file (e.g. file://~/someLocalFile.txt)</span>
        <span class="c1"># it won&#39;t be &quot;downloaded&quot; and, instead, downloadPath will just point to &#39;~/someLocalFile.txt&#39;</span>
        <span class="c1"># _downloadFileHandle may also return None to indicate that the download failed</span>
        <span class="k">with</span> <span class="n">logging_redirect_tqdm</span><span class="p">(</span><span class="n">loggers</span><span class="o">=</span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="p">]):</span>
            <span class="n">download_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">download_by_file_handle</span><span class="p">(</span>
                <span class="n">file_handle_id</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">dataFileHandleId</span><span class="p">,</span>
                <span class="n">synapse_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
                <span class="n">entity_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">download_path</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">download_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_path</span><span class="p">):</span>
            <span class="k">return</span>

    <span class="c1"># converts the path format from forward slashes back to backward slashes on Windows</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">download_path</span><span class="p">)]</span>
    <span class="n">entity</span><span class="o">.</span><span class="n">cacheDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.download_file_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file_entity_model</span><span class="p">(</span><span class="n">download_location</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">if_collision</span><span class="p">,</span> <span class="n">submission</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_functions.download_file_entity_model" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Download file entity</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>download_location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The location on disk where the entity will be downloaded. If
there is a matching file at the location, the download collision will be
handled according to the <code>if_collision</code> argument.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[str, None]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entity</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The File object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>if_collision</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Determines how to handle file collisions.
                May be</p>
<ul>
<li><code>overwrite.local</code></li>
<li><code>keep.local</code></li>
<li><code>keep.both</code></li>
</ul>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>submission</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Access associated files through a submission rather than through an entity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not passed in or None this will use the last client from
the <code>.login()</code> method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">download_file_entity_model</span><span class="p">(</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">file</span><span class="p">:</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span>
    <span class="n">if_collision</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">submission</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download file entity</span>

<span class="sd">    Arguments:</span>
<span class="sd">        download_location: The location on disk where the entity will be downloaded. If</span>
<span class="sd">            there is a matching file at the location, the download collision will be</span>
<span class="sd">            handled according to the `if_collision` argument.</span>
<span class="sd">        entity:           The File object</span>
<span class="sd">        if_collision:      Determines how to handle file collisions.</span>
<span class="sd">                            May be</span>

<span class="sd">            - `overwrite.local`</span>
<span class="sd">            - `keep.local`</span>
<span class="sd">            - `keep.both`</span>

<span class="sd">        submission:       Access associated files through a submission rather than through an entity.</span>
<span class="sd">        synapse_client: If not passed in or None this will use the last client from</span>
<span class="sd">            the `.login()` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>
    <span class="c1"># set the initial local state</span>
    <span class="n">file</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># check to see if an UNMODIFIED version of the file (since it was last downloaded) already exists</span>
    <span class="c1"># this location could be either in .synapseCache or a user specified location to which the user previously</span>
    <span class="c1"># downloaded the file</span>
    <span class="n">cached_file_path</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">data_file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">download_location</span>
    <span class="p">)</span>

    <span class="c1"># location in .synapseCache where the file would be corresponding to its FileHandleId</span>
    <span class="n">synapse_cache_location</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span>
        <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">data_file_handle_id</span>
    <span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">file</span><span class="o">.</span><span class="n">file_handle</span><span class="o">.</span><span class="n">file_name</span>
        <span class="k">if</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Decide the best download location for the file</span>
    <span class="k">if</span> <span class="n">download_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Make sure the specified download location is a fully resolved directory</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">ensure_download_location_is_directory</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># file already cached so use that as the download location</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># file not cached and no user-specified location so default to .synapseCache</span>
        <span class="n">download_location</span> <span class="o">=</span> <span class="n">synapse_cache_location</span>

    <span class="c1"># resolve file path collisions by either overwriting, renaming, or not downloading, depending on the</span>
    <span class="c1"># ifcollision value</span>
    <span class="n">download_path</span> <span class="o">=</span> <span class="n">resolve_download_path_collisions</span><span class="p">(</span>
        <span class="n">download_location</span><span class="o">=</span><span class="n">download_location</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
        <span class="n">if_collision</span><span class="o">=</span><span class="n">if_collision</span><span class="p">,</span>
        <span class="n">synapse_cache_location</span><span class="o">=</span><span class="n">synapse_cache_location</span><span class="p">,</span>
        <span class="n">cached_file_path</span><span class="o">=</span><span class="n">cached_file_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">download_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">cached_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># copy from cache</span>
        <span class="k">if</span> <span class="n">download_path</span> <span class="o">!=</span> <span class="n">cached_file_path</span><span class="p">:</span>
            <span class="c1"># create the foider if it does not exist already</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_location</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span>
            <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Copying existing file from </span><span class="si">{</span><span class="n">cached_file_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">download_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># download the file from URL (could be a local file)</span>
        <span class="n">object_type</span> <span class="o">=</span> <span class="s2">&quot;FileEntity&quot;</span> <span class="k">if</span> <span class="n">submission</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;SubmissionAttachment&quot;</span>
        <span class="n">object_id</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">submission</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">submission</span>

        <span class="c1"># reassign downloadPath because if url points to local file (e.g. file://~/someLocalFile.txt)</span>
        <span class="c1"># it won&#39;t be &quot;downloaded&quot; and, instead, downloadPath will just point to &#39;~/someLocalFile.txt&#39;</span>
        <span class="c1"># _downloadFileHandle may also return None to indicate that the download failed</span>
        <span class="k">with</span> <span class="n">logging_redirect_tqdm</span><span class="p">(</span><span class="n">loggers</span><span class="o">=</span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="p">]):</span>
            <span class="n">download_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">download_by_file_handle</span><span class="p">(</span>
                <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">data_file_handle_id</span><span class="p">,</span>
                <span class="n">synapse_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
                <span class="n">entity_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">download_path</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">download_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_path</span><span class="p">):</span>
            <span class="k">return</span>

    <span class="c1"># converts the path format from forward slashes back to backward slashes on Windows</span>
    <span class="n">file</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.download_by_file_handle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_by_file_handle</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">synapse_id</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_functions.download_by_file_handle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Download a file from the given URL to the local file system.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The id of the FileHandle to download</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The id of the Synapse object that uses the FileHandle e.g. "syn123"</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entity_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The type of the Synapse object that uses the FileHandle e.g. "FileEntity"</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The destination on local file system</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retries</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Number of download retries attempted before throwing an exception.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not passed in or None this will use the last client from
the <code>.login()</code> method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The path to downloaded file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <pre class="mermaid"><code>sequenceDiagram
    title Multi-Threaded Download Process with Retry Mechanism

    actor Client as Client
    participant download_functions as download_functions
    participant download_async as download_async
    participant download_execution as download_execution
    participant multi_threaded_download as multi_threaded_download
    participant remote_storage_server as remote_storage_server
    participant file as file

    activate Client
    Client -&gt;&gt; download_functions: download_by_file_handle
    activate download_functions

    loop retryable

        alt Download type = multi_threaded
            note over download_functions: download_from_url_multi_threaded

            download_functions -&gt;&gt; download_async: download_file
            activate download_async

            download_async -&gt;&gt; download_async: _generate_stream_and_write_chunk_tasks


            loop for each download task
                download_async -&gt;&gt; download_execution: _execute_download_tasks
                activate download_execution

                par MULTI-THREADED: Run in thread executor
                    download_execution -&gt;&gt; multi_threaded_download: _stream_and_write_chunk
                    activate multi_threaded_download

                    loop stream chunk into memory
                        multi_threaded_download -&gt;&gt; remote_storage_server: stream chunk from remote server
                        remote_storage_server --&gt;&gt; multi_threaded_download: Return partial range
                    end

                    note over multi_threaded_download: Chunk loaded into memory

                    alt obtain thread lock [Failed]
                        note over multi_threaded_download: Wait to obtain lock
                    else obtain thread lock [Success]
                        multi_threaded_download -&gt;&gt; file: write chunk to file
                        file --&gt;&gt; multi_threaded_download: .
                        note over multi_threaded_download: Update progress bar
                        note over multi_threaded_download: Release lock
                    end
                    multi_threaded_download --&gt;&gt; download_execution: .
                end
                download_execution --&gt;&gt; download_async: .
                note over download_async: Run garbage collection every 100 iterations
                deactivate multi_threaded_download
                deactivate download_execution
            end

            download_async --&gt;&gt; download_functions: .
            deactivate download_async

            download_functions -&gt;&gt; download_functions: md5_for_file
            download_functions --&gt;&gt; Client: File downloaded
            deactivate download_functions
        else Download type = non multi_threaded
            note over download_functions: Execute `download_from_url`
        else Download type = external s3 object store
            note over download_functions: Execute `S3ClientWrapper.download_file`
        else Download type = aws s3 sts storage
            note over download_functions: Execute `S3ClientWrapper.download_file` with with_boto_sts_credentials
        end
    end

    deactivate Client</code></pre>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">download_by_file_handle</span><span class="p">(</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">synapse_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a file from the given URL to the local file system.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_handle_id: The id of the FileHandle to download</span>
<span class="sd">        synapse_id: The id of the Synapse object that uses the FileHandle e.g. &quot;syn123&quot;</span>
<span class="sd">        entity_type: The type of the Synapse object that uses the FileHandle e.g. &quot;FileEntity&quot;</span>
<span class="sd">        destination: The destination on local file system</span>
<span class="sd">        retries: The Number of download retries attempted before throwing an exception.</span>
<span class="sd">        synapse_client: If not passed in or None this will use the last client from</span>
<span class="sd">            the `.login()` method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path to downloaded file</span>


<span class="sd">    ```mermaid</span>
<span class="sd">    sequenceDiagram</span>
<span class="sd">        title Multi-Threaded Download Process with Retry Mechanism</span>

<span class="sd">        actor Client as Client</span>
<span class="sd">        participant download_functions as download_functions</span>
<span class="sd">        participant download_async as download_async</span>
<span class="sd">        participant download_execution as download_execution</span>
<span class="sd">        participant multi_threaded_download as multi_threaded_download</span>
<span class="sd">        participant remote_storage_server as remote_storage_server</span>
<span class="sd">        participant file as file</span>

<span class="sd">        activate Client</span>
<span class="sd">        Client -&gt;&gt; download_functions: download_by_file_handle</span>
<span class="sd">        activate download_functions</span>

<span class="sd">        loop retryable</span>

<span class="sd">            alt Download type = multi_threaded</span>
<span class="sd">                note over download_functions: download_from_url_multi_threaded</span>

<span class="sd">                download_functions -&gt;&gt; download_async: download_file</span>
<span class="sd">                activate download_async</span>

<span class="sd">                download_async -&gt;&gt; download_async: _generate_stream_and_write_chunk_tasks</span>


<span class="sd">                loop for each download task</span>
<span class="sd">                    download_async -&gt;&gt; download_execution: _execute_download_tasks</span>
<span class="sd">                    activate download_execution</span>

<span class="sd">                    par MULTI-THREADED: Run in thread executor</span>
<span class="sd">                        download_execution -&gt;&gt; multi_threaded_download: _stream_and_write_chunk</span>
<span class="sd">                        activate multi_threaded_download</span>

<span class="sd">                        loop stream chunk into memory</span>
<span class="sd">                            multi_threaded_download -&gt;&gt; remote_storage_server: stream chunk from remote server</span>
<span class="sd">                            remote_storage_server --&gt;&gt; multi_threaded_download: Return partial range</span>
<span class="sd">                        end</span>

<span class="sd">                        note over multi_threaded_download: Chunk loaded into memory</span>

<span class="sd">                        alt obtain thread lock [Failed]</span>
<span class="sd">                            note over multi_threaded_download: Wait to obtain lock</span>
<span class="sd">                        else obtain thread lock [Success]</span>
<span class="sd">                            multi_threaded_download -&gt;&gt; file: write chunk to file</span>
<span class="sd">                            file --&gt;&gt; multi_threaded_download: .</span>
<span class="sd">                            note over multi_threaded_download: Update progress bar</span>
<span class="sd">                            note over multi_threaded_download: Release lock</span>
<span class="sd">                        end</span>
<span class="sd">                        multi_threaded_download --&gt;&gt; download_execution: .</span>
<span class="sd">                    end</span>
<span class="sd">                    download_execution --&gt;&gt; download_async: .</span>
<span class="sd">                    note over download_async: Run garbage collection every 100 iterations</span>
<span class="sd">                    deactivate multi_threaded_download</span>
<span class="sd">                    deactivate download_execution</span>
<span class="sd">                end</span>

<span class="sd">                download_async --&gt;&gt; download_functions: .</span>
<span class="sd">                deactivate download_async</span>

<span class="sd">                download_functions -&gt;&gt; download_functions: md5_for_file</span>
<span class="sd">                download_functions --&gt;&gt; Client: File downloaded</span>
<span class="sd">                deactivate download_functions</span>
<span class="sd">            else Download type = non multi_threaded</span>
<span class="sd">                note over download_functions: Execute `download_from_url`</span>
<span class="sd">            else Download type = external s3 object store</span>
<span class="sd">                note over download_functions: Execute `S3ClientWrapper.download_file`</span>
<span class="sd">            else Download type = aws s3 sts storage</span>
<span class="sd">                note over download_functions: Execute `S3ClientWrapper.download_file` with with_boto_sts_credentials</span>
<span class="sd">            end</span>
<span class="sd">        end</span>

<span class="sd">        deactivate Client</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">syn</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">destination</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">retries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_handle_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
                <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span>
            <span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_file_handle_for_download_async</span><span class="p">(</span>
                <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span><span class="p">,</span>
                <span class="n">synapse_id</span><span class="o">=</span><span class="n">synapse_id</span><span class="p">,</span>
                <span class="n">entity_type</span><span class="o">=</span><span class="n">entity_type</span><span class="p">,</span>
                <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file_handle_result</span><span class="p">[</span><span class="s2">&quot;fileHandle&quot;</span><span class="p">]</span>
            <span class="n">concrete_type</span> <span class="o">=</span> <span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;concreteType&quot;</span><span class="p">]</span>
            <span class="n">storage_location_id</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storageLocationId&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">concrete_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">EXTERNAL_OBJECT_STORE_FILE_HANDLE</span><span class="p">:</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="n">get_client_authenticated_s3_profile</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;endpointUrl&quot;</span><span class="p">],</span>
                    <span class="n">bucket</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">],</span>
                    <span class="n">config_path</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">configPath</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">get_or_create_download_progress_bar</span><span class="p">(</span>
                    <span class="n">file_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="n">synapse_id</span>
                <span class="p">)</span>
                <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="n">downloaded_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                    <span class="n">syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
                        <span class="n">bucket</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;bucket&quot;</span><span class="p">],</span>
                        <span class="n">endpoint_url</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;endpointUrl&quot;</span><span class="p">],</span>
                        <span class="n">remote_file_key</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;fileKey&quot;</span><span class="p">],</span>
                        <span class="n">download_file_path</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                        <span class="n">profile_name</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span>
                        <span class="n">credentials</span><span class="o">=</span><span class="n">_get_aws_credentials</span><span class="p">(),</span>
                        <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_boto_sts_transfer_enabled</span><span class="p">(</span><span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">)</span>
                <span class="ow">and</span> <span class="k">await</span> <span class="n">sts_transfer</span><span class="o">.</span><span class="n">is_storage_location_sts_enabled_async</span><span class="p">(</span>
                    <span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="o">=</span><span class="n">synapse_id</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">storage_location_id</span>
                <span class="p">)</span>
                <span class="ow">and</span> <span class="n">concrete_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">S3_FILE_HANDLE</span>
            <span class="p">):</span>
                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">get_or_create_download_progress_bar</span><span class="p">(</span>
                    <span class="n">file_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="n">synapse_id</span>
                <span class="p">)</span>

                <span class="k">def</span> <span class="nf">download_fn</span><span class="p">(</span>
                    <span class="n">credentials</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                    <span class="n">file_handle</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_handle</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;Use the STS credentials to download the file from S3.</span>

<span class="sd">                    Arguments:</span>
<span class="sd">                        credentials: The STS credentials</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        The path to the downloaded file</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                    <span class="k">return</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
                        <span class="n">bucket</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;bucketName&quot;</span><span class="p">],</span>
                        <span class="n">endpoint_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">remote_file_key</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
                        <span class="n">download_file_path</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                        <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
                        <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
                        <span class="c1"># pass through our synapse threading config to boto s3</span>
                        <span class="n">transfer_config_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">:</span> <span class="n">syn</span><span class="o">.</span><span class="n">max_threads</span><span class="p">},</span>
                    <span class="p">)</span>

                <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="n">downloaded_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                    <span class="n">syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="n">sts_transfer</span><span class="o">.</span><span class="n">with_boto_sts_credentials</span><span class="p">(</span>
                        <span class="n">download_fn</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">synapse_id</span><span class="p">,</span> <span class="s2">&quot;read_only&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">syn</span><span class="o">.</span><span class="n">multi_threaded</span>
                <span class="ow">and</span> <span class="n">concrete_type</span> <span class="o">==</span> <span class="n">concrete_types</span><span class="o">.</span><span class="n">S3_FILE_HANDLE</span>
                <span class="ow">and</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentSize&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">&gt;</span> <span class="n">SYNAPSE_DEFAULT_DOWNLOAD_PART_SIZE</span>
            <span class="p">):</span>
                <span class="c1"># run the download multi threaded if the file supports it, we&#39;re configured to do so,</span>
                <span class="c1"># and the file is large enough that it would be broken into parts to take advantage of</span>
                <span class="c1"># multiple downloading threads. otherwise it&#39;s more efficient to run the download as a simple</span>
                <span class="c1"># single threaded URL download.</span>
                <span class="n">downloaded_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">download_from_url_multi_threaded</span><span class="p">(</span>
                    <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span><span class="p">,</span>
                    <span class="n">object_id</span><span class="o">=</span><span class="n">synapse_id</span><span class="p">,</span>
                    <span class="n">object_type</span><span class="o">=</span><span class="n">entity_type</span><span class="p">,</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                    <span class="n">expected_md5</span><span class="o">=</span><span class="n">file_handle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentMd5&quot;</span><span class="p">),</span>
                    <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">get_or_create_download_progress_bar</span><span class="p">(</span>
                    <span class="n">file_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="n">synapse_id</span>
                <span class="p">)</span>
                <span class="n">downloaded_path</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                    <span class="n">syn</span><span class="o">.</span><span class="n">_get_thread_pool_executor</span><span class="p">(</span><span class="n">asyncio_event_loop</span><span class="o">=</span><span class="n">loop</span><span class="p">),</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="n">download_from_url</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">file_handle_result</span><span class="p">[</span><span class="s2">&quot;preSignedURL&quot;</span><span class="p">],</span>
                        <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                        <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="n">expected_md5</span><span class="o">=</span><span class="n">file_handle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentMd5&quot;</span><span class="p">),</span>
                        <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
                        <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>

            <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="n">synapse_id</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">downloaded_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">syn</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">file_handle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">downloaded_path</span><span class="p">,</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contentMd5&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">close_download_progress_bar</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">downloaded_path</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_retryable_download_error</span><span class="p">(</span><span class="n">ex</span><span class="p">):</span>
                <span class="n">close_download_progress_bar</span><span class="p">()</span>
                <span class="k">raise</span>

            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">ex</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;progress&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ex</span><span class="o">.</span><span class="n">progress</span>
            <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrying download on error: [</span><span class="si">{</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">] after progressing </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">progress</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># this will include stack trace</span>
            <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">progress</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># No progress was made reduce remaining retries.</span>
                <span class="n">retries</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">retries</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">close_download_progress_bar</span><span class="p">()</span>
                <span class="c1"># Re-raise exception</span>
                <span class="k">raise</span>

    <span class="n">close_download_progress_bar</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;should not reach this line&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.download_from_url_multi_threaded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_from_url_multi_threaded</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">object_id</span><span class="p">,</span> <span class="n">object_type</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">expected_md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_functions.download_from_url_multi_threaded" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Download a file from the given URL using multiple threads.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The id of the FileHandle to download</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>object_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The id of the Synapse object that uses the FileHandle
e.g. "syn123"</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>object_type</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The type of the Synapse object that uses the
FileHandle e.g. "FileEntity". Any of
<a href="https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html">https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html</a></p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The destination on local file system</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expected_md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expected MD5</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>content_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The size of the content</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not passed in or None this will use the last client from
the <code>.login()</code> method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Raises:
    SynapseMd5MismatchError: If the actual MD5 does not match expected MD5.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The path to downloaded file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">download_from_url_multi_threaded</span><span class="p">(</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">expected_md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a file from the given URL using multiple threads.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_handle_id: The id of the FileHandle to download</span>
<span class="sd">        object_id:      The id of the Synapse object that uses the FileHandle</span>
<span class="sd">            e.g. &quot;syn123&quot;</span>
<span class="sd">        object_type:    The type of the Synapse object that uses the</span>
<span class="sd">            FileHandle e.g. &quot;FileEntity&quot;. Any of</span>
<span class="sd">            &lt;https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html&gt;</span>
<span class="sd">        destination:    The destination on local file system</span>
<span class="sd">        expected_md5:   The expected MD5</span>
<span class="sd">        content_size:   The size of the content</span>
<span class="sd">        synapse_client: If not passed in or None this will use the last client from</span>
<span class="sd">            the `.login()` method.</span>
<span class="sd">    Raises:</span>
<span class="sd">        SynapseMd5MismatchError: If the actual MD5 does not match expected MD5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path to downloaded file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
    <span class="n">temp_destination</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_download_filename</span><span class="p">(</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span>
    <span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">DownloadRequest</span><span class="p">(</span>
        <span class="n">file_handle_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">),</span>
        <span class="n">object_id</span><span class="o">=</span><span class="n">object_id</span><span class="p">,</span>
        <span class="n">object_type</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">temp_destination</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">await</span> <span class="n">download_file</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">download_request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">expected_md5</span><span class="p">:</span>  <span class="c1"># if md5 not set (should be the case for all except http download)</span>
        <span class="n">actual_md5</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file_hex</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">temp_destination</span><span class="p">)</span>
        <span class="c1"># check md5 if given</span>
        <span class="k">if</span> <span class="n">actual_md5</span> <span class="o">!=</span> <span class="n">expected_md5</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="c1"># file already does not exist. nothing to do</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="n">SynapseMd5MismatchError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Downloaded file </span><span class="si">{</span><span class="n">temp_destination</span><span class="si">}</span><span class="s2">&#39;s md5 </span><span class="si">{</span><span class="n">actual_md5</span><span class="si">}</span><span class="s2"> does not match expected MD5 of </span><span class="si">{</span><span class="n">expected_md5</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="c1"># once download completed, rename to desired destination</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.download_from_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expected_md5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.download.download_functions.download_from_url" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Download a file from the given URL to the local file system.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The source of download</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The destination on local file system</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional. If given, the file will be given a temporary name that includes the file
                    handle id which allows resuming partial downloads of the same file from previous
                    sessions</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expected_md5</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional. If given, check that the MD5 of the downloaded file matches the expected MD5</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not passed in or None this will use the last client from
the <code>.login()</code> method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>IOError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the local file does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><a class="autorefs autorefs-internal" title="synapseclient.core.exceptions.SynapseError" href="../exceptions/#synapseclient.core.exceptions.SynapseError">SynapseError</a></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If fail to download the file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><a class="autorefs autorefs-internal" title="synapseclient.core.exceptions.SynapseHTTPError" href="../exceptions/#synapseclient.core.exceptions.SynapseHTTPError">SynapseHTTPError</a></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If there are too many redirects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><a class="autorefs autorefs-internal" title="synapseclient.core.exceptions.SynapseMd5MismatchError" href="../exceptions/#synapseclient.core.exceptions.SynapseMd5MismatchError">SynapseMd5MismatchError</a></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the actual MD5 does not match expected MD5.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The path to downloaded file or None if the download failed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_from_url</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">expected_md5</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tqdm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a file from the given URL to the local file system.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        url:           The source of download</span>
<span class="sd">        destination:   The destination on local file system</span>
<span class="sd">        file_handle_id:  Optional. If given, the file will be given a temporary name that includes the file</span>
<span class="sd">                                handle id which allows resuming partial downloads of the same file from previous</span>
<span class="sd">                                sessions</span>
<span class="sd">        expected_md5:  Optional. If given, check that the MD5 of the downloaded file matches the expected MD5</span>
<span class="sd">        synapse_client: If not passed in or None this will use the last client from</span>
<span class="sd">            the `.login()` method.</span>

<span class="sd">    Raises:</span>
<span class="sd">        IOError:                 If the local file does not exist.</span>
<span class="sd">        SynapseError:            If fail to download the file.</span>
<span class="sd">        SynapseHTTPError:        If there are too many redirects.</span>
<span class="sd">        SynapseMd5MismatchError: If the actual MD5 does not match expected MD5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The path to downloaded file or None if the download failed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>

    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
    <span class="n">actual_md5</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">redirect_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">delete_on_md5_mismatch</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">redirect_count</span> <span class="o">&lt;</span> <span class="n">REDIRECT_LIMIT</span><span class="p">:</span>
        <span class="n">redirect_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="n">urllib_urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">scheme</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">delete_on_md5_mismatch</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">file_url_to_path</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">destination</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local file (</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">) does not exist.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
                <span class="n">increment_progress_bar_total</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>
                <span class="n">increment_progress_bar</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;sftp&quot;</span><span class="p">:</span>
            <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_getUserCredentials</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="n">localFilepath</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;ftp&quot;</span><span class="p">:</span>
            <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">_ftp_report_hook</span><span class="p">(</span>
                <span class="n">_</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">read_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">total_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Report hook for urllib.request.urlretrieve to show download progress.</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    _: The number of blocks transferred so far</span>
<span class="sd">                    read_size: The size of each block</span>
<span class="sd">                    total_size: The total size of the file</span>

<span class="sd">                Returns:</span>
<span class="sd">                    None</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">nonlocal</span> <span class="n">updated_progress_bar_with_total</span>
                <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">updated_progress_bar_with_total</span><span class="p">:</span>
                        <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">increment_progress_bar_total</span><span class="p">(</span>
                            <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
                        <span class="p">)</span>
                    <span class="n">increment_progress_bar</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">read_size</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>

            <span class="n">urllib_request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">reporthook</span><span class="o">=</span><span class="n">_ftp_report_hook</span>
            <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]:</span>
            <span class="c1"># if a partial download exists with the temporary name,</span>
            <span class="n">temp_destination</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_download_filename</span><span class="p">(</span>
                <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="o">=</span><span class="n">file_handle_id</span>
            <span class="p">)</span>
            <span class="n">range_header</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;Range&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;bytes=</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">temp_destination</span><span class="p">)</span><span class="si">}</span><span class="s2">-&quot;</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">{}</span>
            <span class="p">)</span>

            <span class="c1"># pass along synapse auth credentials only if downloading directly from synapse</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">client</span><span class="o">.</span><span class="n">credentials</span>
                <span class="k">if</span> <span class="n">is_synapse_uri</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">with_retry</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">range_header</span><span class="o">=</span><span class="n">range_header</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">_requests_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">_generate_headers</span><span class="p">(</span><span class="n">range_header</span><span class="p">),</span>
                    <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                <span class="o">**</span><span class="n">STANDARD_RETRY_PARAMS</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">exceptions</span><span class="o">.</span><span class="n">_raise_for_status</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SynapseHTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SynapseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not download the file at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">err</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">416</span>
                <span class="p">):</span>  <span class="c1"># Requested Range Not Statisfiable</span>
                    <span class="c1"># this is a weird error when the client already finished downloading but the loop continues</span>
                    <span class="c1"># When this exception occurs, the range we request is guaranteed to be &gt;= file size so we</span>
                    <span class="c1"># assume that the file has been fully downloaded, rename it to destination file</span>
                    <span class="c1"># and break out of the loop to perform the MD5 check.</span>
                    <span class="c1"># If it fails the user can retry with another download.</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">raise</span>

            <span class="c1"># handle redirects</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">301</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">308</span><span class="p">]:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
                <span class="c1"># don&#39;t break, loop again</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># get filename from content-disposition, if we don&#39;t have it already</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">extract_filename</span><span class="p">(</span>
                        <span class="n">content_disposition_header</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s2">&quot;content-disposition&quot;</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="p">),</span>
                        <span class="n">default_filename</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">guess_file_name</span><span class="p">(</span><span class="n">url</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="c1"># Stream the file to disk</span>
                <span class="k">if</span> <span class="s2">&quot;content-length&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                    <span class="n">to_be_transferred</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;content-length&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_be_transferred</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">transferred</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Servers that respect the Range header return 206 Partial Content</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">206</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;ab&quot;</span>
                    <span class="n">previously_transferred</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">temp_destination</span><span class="p">)</span>
                    <span class="n">to_be_transferred</span> <span class="o">+=</span> <span class="n">previously_transferred</span>
                    <span class="n">transferred</span> <span class="o">+=</span> <span class="n">previously_transferred</span>
                    <span class="n">increment_progress_bar_total</span><span class="p">(</span>
                        <span class="n">total</span><span class="o">=</span><span class="n">to_be_transferred</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
                    <span class="p">)</span>
                    <span class="n">increment_progress_bar</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">transferred</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Resuming partial download to </span><span class="si">{</span><span class="n">temp_destination</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">previously_transferred</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">to_be_transferred</span><span class="si">}</span><span class="s2"> bytes already &quot;</span>
                        <span class="s2">&quot;transferred.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">sig</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">temp_destination</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;wb&quot;</span>
                    <span class="n">previously_transferred</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">increment_progress_bar_total</span><span class="p">(</span>
                        <span class="n">total</span><span class="o">=</span><span class="n">to_be_transferred</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
                    <span class="p">)</span>
                    <span class="n">sig</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="n">usedforsecurity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># nosec</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                            <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">FILE_BUFFER_SIZE</span><span class="p">)</span>
                        <span class="p">):</span>
                            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                            <span class="n">sig</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

                            <span class="c1"># the &#39;content-length&#39; header gives the total number of bytes that will be transferred</span>
                            <span class="c1"># to us len(chunk) cannot be used to track progress because iter_content automatically</span>
                            <span class="c1"># decodes the chunks if the response body is encoded so the len(chunk) could be</span>
                            <span class="c1"># different from the total number of bytes we&#39;ve read read from the response body</span>
                            <span class="c1"># response.raw.tell() is the total number of response body bytes transferred over the</span>
                            <span class="c1"># wire so far</span>
                            <span class="n">transferred</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="n">previously_transferred</span>
                            <span class="n">increment_progress_bar</span><span class="p">(</span>
                                <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
                            <span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span>
                    <span class="ne">Exception</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># We will add a progress parameter then push it back to retry.</span>
                    <span class="n">ex</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">transferred</span> <span class="o">-</span> <span class="n">previously_transferred</span>
                    <span class="k">raise</span>

                <span class="c1"># verify that the file was completely downloaded and retry if it is not complete</span>
                <span class="k">if</span> <span class="n">to_be_transferred</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">transferred</span> <span class="o">&lt;</span> <span class="n">to_be_transferred</span><span class="p">:</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrying download because the connection ended early.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">actual_md5</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                <span class="c1"># rename to final destination</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">temp_destination</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to download URLs of type </span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># didn&#39;t break out of loop</span>
        <span class="k">raise</span> <span class="n">SynapseHTTPError</span><span class="p">(</span><span class="s2">&quot;Too many redirects&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">actual_md5</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">):</span>  <span class="c1"># if md5 not set (should be the case for all except http download)</span>
        <span class="n">actual_md5</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file_hex</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">destination</span><span class="p">)</span>

    <span class="c1"># check md5 if given</span>
    <span class="k">if</span> <span class="n">expected_md5</span> <span class="ow">and</span> <span class="n">actual_md5</span> <span class="o">!=</span> <span class="n">expected_md5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delete_on_md5_mismatch</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SynapseMd5MismatchError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Downloaded file </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">&#39;s md5 </span><span class="si">{</span><span class="n">actual_md5</span><span class="si">}</span><span class="s2"> does not match expected MD5 of </span><span class="si">{</span><span class="n">expected_md5</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.is_retryable_download_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_retryable_download_error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span></code>

<a href="#synapseclient.core.download.download_functions.is_retryable_download_error" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Check if the download error is retryable</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ex</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An exception</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>Exception</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Boolean value indicating whether the download error is retryable</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_retryable_download_error</span><span class="p">(</span><span class="n">ex</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the download error is retryable</span>

<span class="sd">    Arguments:</span>
<span class="sd">        ex: An exception</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean value indicating whether the download error is retryable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># some exceptions caught during download indicate non-recoverable situations that</span>
    <span class="c1"># will not be remedied by a repeated download attempt.</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ex</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOSPC</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">SynapseMd5MismatchError</span><span class="p">)</span>  <span class="c1"># out of disk space</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.resolve_download_path_collisions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_download_path_collisions</span><span class="p">(</span><span class="n">download_location</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">if_collision</span><span class="p">,</span> <span class="n">synapse_cache_location</span><span class="p">,</span> <span class="n">cached_file_path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.download.download_functions.resolve_download_path_collisions" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Resolve file path collisions</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>download_location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The location on disk where the entity will be downloaded. If
there is a matching file at the location, the download collision will be
handled according to the <code>if_collision</code> argument.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file name</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>if_collision</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Determines how to handle file collisions.
                    May be "overwrite.local", "keep.local", or "keep.both".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>synapse_cache_location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The location in .synapseCache where the file would be
                    corresponding to its FileHandleId.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cached_file_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file path of the cached copy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ValueError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>Invalid ifcollision. Should be "overwrite.local", "keep.local", or "keep.both".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The download file path with collisions resolved or None if the file should</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>not be downloaded</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resolve_download_path_collisions</span><span class="p">(</span>
    <span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">if_collision</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">synapse_cache_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cached_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolve file path collisions</span>

<span class="sd">    Arguments:</span>
<span class="sd">        download_location: The location on disk where the entity will be downloaded. If</span>
<span class="sd">            there is a matching file at the location, the download collision will be</span>
<span class="sd">            handled according to the `if_collision` argument.</span>
<span class="sd">        file_name:             The file name</span>
<span class="sd">        if_collision:           Determines how to handle file collisions.</span>
<span class="sd">                                May be &quot;overwrite.local&quot;, &quot;keep.local&quot;, or &quot;keep.both&quot;.</span>
<span class="sd">        synapse_cache_location: The location in .synapseCache where the file would be</span>
<span class="sd">                                corresponding to its FileHandleId.</span>
<span class="sd">        cached_file_path:      The file path of the cached copy</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Invalid ifcollision. Should be &quot;overwrite.local&quot;, &quot;keep.local&quot;, or &quot;keep.both&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The download file path with collisions resolved or None if the file should</span>
<span class="sd">        not be downloaded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>

    <span class="c1"># always overwrite if we are downloading to .synapseCache</span>
    <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span> <span class="o">==</span> <span class="n">synapse_cache_location</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">if_collision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">if_collision</span> <span class="o">!=</span> <span class="n">COLLISION_OVERWRITE_LOCAL</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;!&quot;</span> <span class="o">*</span> <span class="mi">50</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ifcollision=</span><span class="si">{</span><span class="n">if_collision</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;is being IGNORED because the download destination is synapse&#39;s cache.&quot;</span>
                <span class="sa">f</span><span class="s1">&#39; Instead, the behavior is &quot;</span><span class="si">{</span><span class="n">COLLISION_OVERWRITE_LOCAL</span><span class="si">}</span><span class="s1">&quot;. </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;!&quot;</span> <span class="o">*</span> <span class="mi">50</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">if_collision</span> <span class="o">=</span> <span class="n">COLLISION_OVERWRITE_LOCAL</span>
    <span class="c1"># if ifcollision not specified, keep.local</span>
    <span class="n">if_collision</span> <span class="o">=</span> <span class="n">if_collision</span> <span class="ow">or</span> <span class="n">COLLISION_KEEP_BOTH</span>

    <span class="n">download_path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_location</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="c1"># resolve collision</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">download_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">if_collision</span> <span class="o">==</span> <span class="n">COLLISION_OVERWRITE_LOCAL</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Let the download proceed and overwrite the local file.</span>
        <span class="k">elif</span> <span class="n">if_collision</span> <span class="o">==</span> <span class="n">COLLISION_KEEP_LOCAL</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found existing file at </span><span class="si">{</span><span class="n">download_path</span><span class="si">}</span><span class="s2">, skipping download.&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Don&#39;t want to overwrite the local file.</span>
            <span class="n">download_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">if_collision</span> <span class="o">==</span> <span class="n">COLLISION_KEEP_BOTH</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">download_path</span> <span class="o">!=</span> <span class="n">cached_file_path</span><span class="p">:</span>
                <span class="n">download_path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unique_filename</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid parameter: &quot;</span><span class="si">{</span><span class="n">if_collision</span><span class="si">}</span><span class="s1">&quot; is not a valid value for &quot;ifcollision&quot;&#39;</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">download_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.ensure_download_location_is_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ensure_download_location_is_directory</span><span class="p">(</span><span class="n">download_location</span><span class="p">)</span></code>

<a href="#synapseclient.core.download.download_functions.ensure_download_location_is_directory" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Check if the download location is a directory</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>download_location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The location on disk where the entity will be downloaded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ValueError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the download_location is not a directory</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The download location</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensure_download_location_is_directory</span><span class="p">(</span><span class="n">download_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the download location is a directory</span>

<span class="sd">    Arguments:</span>
<span class="sd">        download_location: The location on disk where the entity will be downloaded.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the download_location is not a directory</span>

<span class="sd">    Returns:</span>
<span class="sd">        The download location</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">download_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">download_location</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Parameter &#39;download_location&#39; should be a directory, not a file.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">download_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_functions.is_synapse_uri" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_synapse_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.download.download_functions.is_synapse_uri" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Check whether the given uri is hosted at the configured Synapse repo endpoint</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>uri</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A given uri</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A boolean value indicating whether the given uri is hosted at the configured Synapse repo endpoint</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_synapse_uri</span><span class="p">(</span>
    <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">synapse_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the given uri is hosted at the configured Synapse repo endpoint</span>

<span class="sd">    Arguments:</span>
<span class="sd">        uri: A given uri</span>

<span class="sd">    Returns:</span>
<span class="sd">        A boolean value indicating whether the given uri is hosted at the configured Synapse repo endpoint</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">synapse_client</span><span class="o">=</span><span class="n">synapse_client</span><span class="p">)</span>

    <span class="n">uri_domain</span> <span class="o">=</span> <span class="n">urllib_urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
    <span class="n">synapse_repo_domain</span> <span class="o">=</span> <span class="n">urllib_urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">repoEndpoint</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>
    <span class="k">return</span> <span class="n">uri_domain</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">synapse_repo_domain</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="async-managed-multithreaded-downloads">Async managed Multithreaded Downloads<a class="headerlink" href="#async-managed-multithreaded-downloads" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.download.download_async" class="doc doc-heading">
            <code>synapseclient.core.download.download_async</code>


<a href="#synapseclient.core.download.download_async" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>Logic required for the actual transferring of files.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.download.download_async-classes">Classes<a href="#synapseclient.core.download.download_async-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.download.download_async.DownloadRequest" class="doc doc-heading">
            <code>DownloadRequest</code>


<a href="#synapseclient.core.download.download_async.DownloadRequest" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


      <p>A request to download a file from Synapse</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.DownloadRequest.file_handle_id">file_handle_id</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The file handle ID to download.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.DownloadRequest.object_id">object_id</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The Synapse object this file associated to.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.DownloadRequest.object_type">object_type</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The type of the associated Synapse object. Any of
<a href="https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html">https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html</a></p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.DownloadRequest.path">path</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The local path to download the file to.
This path can be either an absolute path or
a relative path from where the code is executed to the download location.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.DownloadRequest.debug">debug</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>A boolean to specify if debug mode is on.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DownloadRequest</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A request to download a file from Synapse</span>

<span class="sd">    Attributes:</span>
<span class="sd">        file_handle_id : The file handle ID to download.</span>
<span class="sd">        object_id : The Synapse object this file associated to.</span>
<span class="sd">        object_type : The type of the associated Synapse object. Any of</span>
<span class="sd">            &lt;https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandleAssociateType.html&gt;</span>
<span class="sd">        path : The local path to download the file to.</span>
<span class="sd">            This path can be either an absolute path or</span>
<span class="sd">            a relative path from where the code is executed to the download location.</span>
<span class="sd">        debug: A boolean to specify if debug mode is on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_handle_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">object_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.download.download_async.PresignedUrlInfo" class="doc doc-heading">
            <code>PresignedUrlInfo</code>


<a href="#synapseclient.core.download.download_async.PresignedUrlInfo" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


      <p>Information about a retrieved presigned-url</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.PresignedUrlInfo.file_name">file_name</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Name of the file for the presigned url</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.PresignedUrlInfo.url">url</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>The actual presigned url</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.download.download_async.PresignedUrlInfo.expiration_utc">expiration_utc</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>datetime in UTC at which the url will expire</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><span title="datetime.datetime">datetime</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PresignedUrlInfo</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information about a retrieved presigned-url</span>

<span class="sd">    Attributes:</span>
<span class="sd">        file_name: Name of the file for the presigned url</span>
<span class="sd">        url: The actual presigned url</span>
<span class="sd">        expiration_utc: datetime in UTC at which the url will expire</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">expiration_utc</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.download.download_async.PresignedUrlProvider" class="doc doc-heading">
            <code>PresignedUrlProvider</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#synapseclient.core.download.download_async.PresignedUrlProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Provides an un-exipired pre-signed url to download a file</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PresignedUrlProvider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides an un-exipired pre-signed url to download a file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span>
    <span class="n">request</span><span class="p">:</span> <span class="n">DownloadRequest</span>
    <span class="n">_lock</span><span class="p">:</span> <span class="n">_threading</span><span class="o">.</span><span class="n">Lock</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="n">_cached_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PresignedUrlInfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># offset parameter used to buffer url expiration checks, time in seconds</span>
    <span class="n">_TIME_BUFFER</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_info_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using async, returns the cached info if it&#39;s not expired, otherwise</span>
<span class="sd">        retrieves a new pre-signed url and returns that.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Information about a retrieved presigned-url from either the cache or a</span>
<span class="sd">            new request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">PresignedUrlProvider</span><span class="o">.</span><span class="n">_TIME_BUFFER</span>
            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span><span class="o">.</span><span class="n">expiration_utc</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pre_signed_info_async</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span>

    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using a thread lock, returns the cached info if it&#39;s not expired, otherwise</span>
<span class="sd">        retrieves a new pre-signed url and returns that.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Information about a retrieved presigned-url from either the cache or a</span>
<span class="sd">            new request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">PresignedUrlProvider</span><span class="o">.</span><span class="n">_TIME_BUFFER</span>
                <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span><span class="o">.</span><span class="n">expiration_utc</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pre_signed_info</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span>

    <span class="k">def</span> <span class="nf">_get_pre_signed_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an HTTP request to get a pre-signed url to download a file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Information about a retrieved presigned-url from a new request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get_file_handle_for_download</span><span class="p">(</span>
            <span class="n">file_handle_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">file_handle_id</span><span class="p">,</span>
            <span class="n">synapse_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
            <span class="n">entity_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">object_type</span><span class="p">,</span>
            <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;fileHandle&quot;</span><span class="p">][</span><span class="s2">&quot;fileName&quot;</span><span class="p">]</span>
        <span class="n">pre_signed_url</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;preSignedURL&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PresignedUrlInfo</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">pre_signed_url</span><span class="p">,</span>
            <span class="n">expiration_utc</span><span class="o">=</span><span class="n">_pre_signed_url_expiration_time</span><span class="p">(</span><span class="n">pre_signed_url</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_pre_signed_info_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an HTTP request to get a pre-signed url to download a file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Information about a retrieved presigned-url from a new request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_file_handle_for_download_async</span><span class="p">(</span>
            <span class="n">file_handle_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">file_handle_id</span><span class="p">,</span>
            <span class="n">synapse_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
            <span class="n">entity_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">object_type</span><span class="p">,</span>
            <span class="n">synapse_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;fileHandle&quot;</span><span class="p">][</span><span class="s2">&quot;fileName&quot;</span><span class="p">]</span>
        <span class="n">pre_signed_url</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;preSignedURL&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PresignedUrlInfo</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">pre_signed_url</span><span class="p">,</span>
            <span class="n">expiration_utc</span><span class="o">=</span><span class="n">_pre_signed_url_expiration_time</span><span class="p">(</span><span class="n">pre_signed_url</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.download.download_async.PresignedUrlProvider-functions">Functions<a href="#synapseclient.core.download.download_async.PresignedUrlProvider-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.download.download_async.PresignedUrlProvider.get_info_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_info_async</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info_async" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Using async, returns the cached info if it's not expired, otherwise
retrieves a new pre-signed url and returns that.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="synapseclient.core.download.download_async.PresignedUrlInfo" href="#synapseclient.core.download.download_async.PresignedUrlInfo">PresignedUrlInfo</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Information about a retrieved presigned-url from either the cache or a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="synapseclient.core.download.download_async.PresignedUrlInfo" href="#synapseclient.core.download.download_async.PresignedUrlInfo">PresignedUrlInfo</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>new request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_info_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using async, returns the cached info if it&#39;s not expired, otherwise</span>
<span class="sd">    retrieves a new pre-signed url and returns that.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Information about a retrieved presigned-url from either the cache or a</span>
<span class="sd">        new request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">PresignedUrlProvider</span><span class="o">.</span><span class="n">_TIME_BUFFER</span>
        <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span><span class="o">.</span><span class="n">expiration_utc</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pre_signed_info_async</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.download.download_async.PresignedUrlProvider.get_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_info</span><span class="p">()</span></code>

<a href="#synapseclient.core.download.download_async.PresignedUrlProvider.get_info" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Using a thread lock, returns the cached info if it's not expired, otherwise
retrieves a new pre-signed url and returns that.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="synapseclient.core.download.download_async.PresignedUrlInfo" href="#synapseclient.core.download.download_async.PresignedUrlInfo">PresignedUrlInfo</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Information about a retrieved presigned-url from either the cache or a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="synapseclient.core.download.download_async.PresignedUrlInfo" href="#synapseclient.core.download.download_async.PresignedUrlInfo">PresignedUrlInfo</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>new request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PresignedUrlInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using a thread lock, returns the cached info if it&#39;s not expired, otherwise</span>
<span class="sd">    retrieves a new pre-signed url and returns that.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Information about a retrieved presigned-url from either the cache or a</span>
<span class="sd">        new request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">PresignedUrlProvider</span><span class="o">.</span><span class="n">_TIME_BUFFER</span>
            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span><span class="o">.</span><span class="n">expiration_utc</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pre_signed_info</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="synapseclient.core.download.download_async-functions">Functions<a href="#synapseclient.core.download.download_async-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.download.download_async.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">download_request</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.download.download_async.download_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Main driver for the multi-threaded download. Users an ExecutorService,
either set externally onto a thread local by an outside process,
or creating one as needed otherwise.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>client</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A synapseclient</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>download_request</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A batch of DownloadRequest objects specifying what
                Synapse files to download</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.core.download.download_async.DownloadRequest" href="#synapseclient.core.download.download_async.DownloadRequest">DownloadRequest</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/download/download_async.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="n">download_request</span><span class="p">:</span> <span class="n">DownloadRequest</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main driver for the multi-threaded download. Users an ExecutorService,</span>
<span class="sd">    either set externally onto a thread local by an outside process,</span>
<span class="sd">    or creating one as needed otherwise.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        client: A synapseclient</span>
<span class="sd">        download_request: A batch of DownloadRequest objects specifying what</span>
<span class="sd">                            Synapse files to download</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">_MultithreadedDownloader</span><span class="p">(</span><span class="n">syn</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">download_request</span><span class="o">=</span><span class="n">download_request</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">downloader</span><span class="o">.</span><span class="n">download_file</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="cache">Cache<a class="headerlink" href="#cache" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.cache" class="doc doc-heading">
            <code>synapseclient.core.cache</code>


<a href="#synapseclient.core.cache" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <hr />
<p>File Caching</p>
<hr />
<p>Implements a cache on local disk for Synapse file entities and other objects with a
<a href="https://rest-docs.synapse.org/rest/org/sagebionetworks/repo/model/file/FileHandle.html">FileHandle</a>.
This is part of the internal implementation of the client and should not be accessed directly by users of the client.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.cache-classes">Classes<a href="#synapseclient.core.cache-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.cache.Cache" class="doc doc-heading">
            <code>Cache</code>


<a href="#synapseclient.core.cache.Cache" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Represent a cache in which files are accessed by file handle ID.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Cache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a cache in which files are accessed by file handle ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># expand out home shortcut (&#39;~&#39;) and environment variables when setting cache_root_dir</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;cache_root_dir&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="c1"># create the cache_root_dir if it does not already exist</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_root_dir</span><span class="o">=</span><span class="n">CACHE_ROOT_DIR</span><span class="p">,</span> <span class="n">fanout</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="c1"># set root dir of cache in which meta data will be stored and files</span>
        <span class="c1"># will be stored here by default, but other locations can be specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_root_dir</span> <span class="o">=</span> <span class="n">cache_root_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fanout</span> <span class="o">=</span> <span class="n">fanout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span> <span class="o">=</span> <span class="s2">&quot;.cacheMap&quot;</span>

    <span class="k">def</span> <span class="nf">get_cache_dir</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;dataFileHandleId&quot;</span> <span class="ow">in</span> <span class="n">file_handle_id</span><span class="p">:</span>
                <span class="n">file_handle_id</span> <span class="o">=</span> <span class="n">file_handle_id</span><span class="p">[</span><span class="s2">&quot;dataFileHandleId&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="s2">&quot;concreteType&quot;</span> <span class="ow">in</span> <span class="n">file_handle_id</span>
                <span class="ow">and</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">file_handle_id</span>
                <span class="ow">and</span> <span class="n">file_handle_id</span><span class="p">[</span><span class="s2">&quot;concreteType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                    <span class="s2">&quot;org.sagebionetworks.repo.model.file&quot;</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">file_handle_id</span> <span class="o">=</span> <span class="n">file_handle_id</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_root_dir</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fanout</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_cache_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">cache_map_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_map_file</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_map_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cache_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                <span class="c1"># a corrupt cache map file that is not parseable as JSON is treated</span>
                <span class="c1"># as if it does not exist at all (will be overwritten).</span>
                <span class="k">return</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">cache_map</span>

    <span class="k">def</span> <span class="nf">_write_cache_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

        <span class="n">cache_map_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_map_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache_map</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># For compatibility with R&#39;s JSON parser</span>

    <span class="k">def</span> <span class="nf">_get_cache_modified_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cache_map_entry</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the `modified_time` from the `cache_map_entry`. This needed to be</span>
<span class="sd">        backwards-compatible any cache entries that do not have the new JSON structure</span>
<span class="sd">        for data. That means that if the cache_map_entry has a `modified_time` key,</span>
<span class="sd">        then it is a new entry and we can return the value. If it does not, then it</span>
<span class="sd">        is an old entry and we should return the `cache_map_entry` itself.</span>

<span class="sd">        The caveat is that `cache_map_entry` needs to be a string to return the value</span>
<span class="sd">        otherwise it will return None.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cache_map_entry: The entry from the cache map</span>

<span class="sd">        Returns:</span>
<span class="sd">            The modified time if it exists, otherwise the cache_map_entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache_map_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;modified_time&quot;</span> <span class="ow">in</span> <span class="n">cache_map_entry</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache_map_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modified_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cache_map_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cache_map_entry</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_cache_content_md5</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cache_map_entry</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the `content_md5` from the cache_map_entry.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cache_map_entry: The entry from the cache map</span>

<span class="sd">        Returns:</span>
<span class="sd">            The content md5 if it exists, otherwise None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache_map_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;content_md5&quot;</span> <span class="ow">in</span> <span class="n">cache_map_entry</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache_map_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content_md5&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_cache_item_unmodified</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cache_map_entry</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if the cache_map_entry is unmodified by comparing the modified_time</span>
<span class="sd">        and content_md5 to the file at the given path.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cache_map_entry: The entry from the cache map</span>
<span class="sd">            path:            The path to the file to compare to</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the cache_map_entry is unmodified, otherwise False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cached_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_modified_time</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">)</span>
        <span class="n">cached_md5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_content_md5</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">)</span>

        <span class="c1"># compare_timestamps has an implicit check for whether the path exists</span>
        <span class="k">return</span> <span class="n">compare_timestamps</span><span class="p">(</span><span class="n">_get_modified_time</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">cached_time</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">cached_md5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cached_md5</span> <span class="o">==</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a file and file_handle_id, return True if an unmodified cached</span>
<span class="sd">        copy of the file exists at the exact path given or False otherwise.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_handle_id: The ID of the fileHandle</span>
<span class="sd">            path:           The file path at which to look for a cached copy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">cached_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_modified_time</span><span class="p">(</span><span class="n">cache_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">cached_time</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">compare_timestamps</span><span class="p">(</span><span class="n">_get_modified_time</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">cached_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;cache::get&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a file with the given file handle from the cache.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_handle_id: The ID of the fileHandle</span>
<span class="sd">            path:           If the given path is None, look for a cached copy of the</span>
<span class="sd">                            file in the cache directory. If the path is a directory,</span>
<span class="sd">                            look there for a cached copy. If a full file-path is</span>
<span class="sd">                            given, only check whether that exact file exists and is</span>
<span class="sd">                            unmodified since it was cached.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Either a file path, if an unmodified cached copy of the file</span>
<span class="sd">            exists in the specified location or None if it does not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;synapse.cache.dir&quot;</span><span class="p">:</span> <span class="n">cache_dir</span><span class="p">,</span>
                <span class="s2">&quot;synapse.cache.file_handle_id&quot;</span><span class="p">:</span> <span class="n">file_handle_id</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># If the caller specifies a path and that path exists in the cache</span>
            <span class="c1"># but has been modified, we need to indicate no match by returning</span>
            <span class="c1"># None. The logic for updating a synapse entity depends on this to</span>
            <span class="c1"># determine the need to upload a new file.</span>

            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># If we&#39;re given a path to a directory, look for a cached file in that directory</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">matching_unmodified_directory</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">removed_entry_from_cache</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="kc">False</span>  <span class="c1"># determines if cache_map needs to be rewritten to disk</span>
                    <span class="p">)</span>

                    <span class="c1"># iterate a copy of cache_map to allow modifying original cache_map</span>
                    <span class="k">for</span> <span class="n">cached_file_path</span><span class="p">,</span> <span class="n">cache_map_entry</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cache_map</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span>
                                <span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">cached_file_path</span>
                            <span class="p">):</span>
                                <span class="c1"># &quot;break&quot; instead of &quot;return&quot; to write removed invalid entries to disk if necessary</span>
                                <span class="n">matching_unmodified_directory</span> <span class="o">=</span> <span class="n">cached_file_path</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># remove invalid cache entries pointing to files that that no longer exist</span>
                                <span class="c1"># or have been modified</span>
                                <span class="k">del</span> <span class="n">cache_map</span><span class="p">[</span><span class="n">cached_file_path</span><span class="p">]</span>
                                <span class="n">removed_entry_from_cache</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="n">removed_entry_from_cache</span><span class="p">:</span>
                        <span class="c1"># write cache_map with non-existent entries removed</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">matching_unmodified_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
                            <span class="p">{</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="n">matching_unmodified_directory</span>

                <span class="c1"># if we&#39;re given a full file path, look up a matching file in the cache</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cache_map_entry</span> <span class="o">=</span> <span class="n">cache_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cache_map_entry</span><span class="p">:</span>
                        <span class="n">matching_file_path</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">path</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                            <span class="k">else</span> <span class="kc">None</span>
                        <span class="p">)</span>
                        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
                            <span class="p">{</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="n">matching_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="n">matching_file_path</span>

            <span class="c1"># return most recently cached and unmodified file OR</span>
            <span class="c1"># None if there are no unmodified files</span>
            <span class="k">for</span> <span class="n">cached_file_path</span><span class="p">,</span> <span class="n">cache_map_entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">cache_map</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;modified_time&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">cached_file_path</span><span class="p">):</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
                    <span class="k">return</span> <span class="n">cached_file_path</span>

            <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a file to the cache</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t find file &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
        <span class="n">content_md5</span> <span class="o">=</span> <span class="n">md5</span> <span class="ow">or</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># write .000 milliseconds for backward compatibility</span>
            <span class="n">cache_map</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;modified_time&quot;</span><span class="p">:</span> <span class="n">epoch_time_to_iso</span><span class="p">(</span>
                    <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_get_modified_time</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="p">),</span>
                <span class="s2">&quot;content_md5&quot;</span><span class="p">:</span> <span class="n">content_md5</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cache_map</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a file from the cache.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_handle_id: Will also extract file handle id from either a File or file handle</span>
<span class="sd">            path:           If the given path is None, remove (and potentially delete)</span>
<span class="sd">                            all cached copies. If the path is that of a file in the</span>
<span class="sd">                            .cacheMap file, remove it.</span>
<span class="sd">            delete:         If True, delete the file from disk as well as removing it from the cache</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of files removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>

        <span class="c1"># if we&#39;ve passed an entity and not a path, get path from entity</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">file_handle_id</span>
        <span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">file_handle_id</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cache_map</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">cache_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cache_map</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">cache_map</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
                    <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">removed</span>

    <span class="k">def</span> <span class="nf">_cache_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a list of all cache dirs, directories of the form:</span>
<span class="sd">        [cache.cache_root_dir]/949/59949</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_root_dir</span><span class="p">):</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_root_dir</span><span class="p">,</span> <span class="n">item1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+&quot;</span><span class="p">,</span> <span class="n">item1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path1</span><span class="p">):</span>
                    <span class="n">path2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">item2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+&quot;</span><span class="p">,</span> <span class="n">item2</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">path2</span>

    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">before_date</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">after_date</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purge the cache. Use with caution. Deletes files whose cache maps were last updated in a specified period.</span>

<span class="sd">        Deletes .cacheMap files and files stored in the cache.cache_root_dir, but does not delete files stored outside</span>
<span class="sd">        the cache.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            before_date: If specified, all files before this date will be removed</span>
<span class="sd">            after_date:  If specified, all files after this date will be removed</span>
<span class="sd">            dry_run:     If dry_run is True, then the selected files are printed rather than removed</span>

<span class="sd">        Returns:</span>
<span class="sd">            The number of files selected for removal</span>

<span class="sd">        Example: Using this function</span>
<span class="sd">            Either the before_date or after_date must be specified. If both are passed, files between the two dates are</span>
<span class="sd">            selected for removal. Dates must either be a timezone naive Python datetime.datetime instance or the number</span>
<span class="sd">            of seconds since the unix epoch. For example to delete all the files modified in January 2021, either of the</span>
<span class="sd">            following can be used::</span>

<span class="sd">            using offset naive datetime objects</span>

<span class="sd">                cache.purge(after_date=datetime.datetime(2021, 1, 1), before_date=datetime.datetime(2021, 2, 1))</span>

<span class="sd">            using seconds since the unix epoch</span>

<span class="sd">                cache.purge(after_date=1609459200, before_date=1612137600)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">before_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">after_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either before date or after date should be provided&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">before_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">before_date</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">before_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">after_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">after_date</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">after_date</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">before_date</span> <span class="ow">and</span> <span class="n">after_date</span> <span class="ow">and</span> <span class="n">before_date</span> <span class="o">&lt;</span> <span class="n">after_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Before date should be larger than after date&quot;</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cache_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirs</span><span class="p">():</span>
            <span class="c1"># _get_modified_time returns None if the cache map file doesn&#39;t</span>
            <span class="c1"># exist and n &gt; None evaluates to True in python 2.7(wtf?). I&#39;m guessing it&#39;s</span>
            <span class="c1"># OK to purge directories in the cache that have no .cacheMap file</span>

            <span class="n">last_modified_time</span> <span class="o">=</span> <span class="n">_get_modified_time</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">last_modified_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">before_date</span> <span class="ow">or</span> <span class="n">before_date</span> <span class="o">&gt;</span> <span class="n">last_modified_time</span><span class="p">)</span>
                <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">after_date</span> <span class="ow">or</span> <span class="n">after_date</span> <span class="o">&lt;</span> <span class="n">last_modified_time</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.cache.Cache-functions">Functions<a href="#synapseclient.core.cache.Cache-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.cache.Cache.contains" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">contains</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.Cache.contains" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Given a file and file_handle_id, return True if an unmodified cached
copy of the file exists at the exact path given or False otherwise.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ID of the fileHandle</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="collections.abc.Mapping">Mapping</span>, str]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file path at which to look for a cached copy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a file and file_handle_id, return True if an unmodified cached</span>
<span class="sd">    copy of the file exists at the exact path given or False otherwise.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_handle_id: The ID of the fileHandle</span>
<span class="sd">        path:           The file path at which to look for a cached copy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">cached_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_modified_time</span><span class="p">(</span><span class="n">cache_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cached_time</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compare_timestamps</span><span class="p">(</span><span class="n">_get_modified_time</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">cached_time</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.cache.Cache.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.Cache.get" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Retrieve a file with the given file handle from the cache.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ID of the fileHandle</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="collections.abc.Mapping">Mapping</span>, str]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the given path is None, look for a cached copy of the
            file in the cache directory. If the path is a directory,
            look there for a cached copy. If a full file-path is
            given, only check whether that exact file exists and is
            unmodified since it was cached.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Either a file path, if an unmodified cached copy of the file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>exists in the specified location or None if it does not</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;cache::get&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a file with the given file handle from the cache.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_handle_id: The ID of the fileHandle</span>
<span class="sd">        path:           If the given path is None, look for a cached copy of the</span>
<span class="sd">                        file in the cache directory. If the path is a directory,</span>
<span class="sd">                        look there for a cached copy. If a full file-path is</span>
<span class="sd">                        given, only check whether that exact file exists and is</span>
<span class="sd">                        unmodified since it was cached.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Either a file path, if an unmodified cached copy of the file</span>
<span class="sd">        exists in the specified location or None if it does not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;synapse.cache.dir&quot;</span><span class="p">:</span> <span class="n">cache_dir</span><span class="p">,</span>
            <span class="s2">&quot;synapse.cache.file_handle_id&quot;</span><span class="p">:</span> <span class="n">file_handle_id</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># If the caller specifies a path and that path exists in the cache</span>
        <span class="c1"># but has been modified, we need to indicate no match by returning</span>
        <span class="c1"># None. The logic for updating a synapse entity depends on this to</span>
        <span class="c1"># determine the need to upload a new file.</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If we&#39;re given a path to a directory, look for a cached file in that directory</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">matching_unmodified_directory</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">removed_entry_from_cache</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="kc">False</span>  <span class="c1"># determines if cache_map needs to be rewritten to disk</span>
                <span class="p">)</span>

                <span class="c1"># iterate a copy of cache_map to allow modifying original cache_map</span>
                <span class="k">for</span> <span class="n">cached_file_path</span><span class="p">,</span> <span class="n">cache_map_entry</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cache_map</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cached_file_path</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span>
                            <span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">cached_file_path</span>
                        <span class="p">):</span>
                            <span class="c1"># &quot;break&quot; instead of &quot;return&quot; to write removed invalid entries to disk if necessary</span>
                            <span class="n">matching_unmodified_directory</span> <span class="o">=</span> <span class="n">cached_file_path</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># remove invalid cache entries pointing to files that that no longer exist</span>
                            <span class="c1"># or have been modified</span>
                            <span class="k">del</span> <span class="n">cache_map</span><span class="p">[</span><span class="n">cached_file_path</span><span class="p">]</span>
                            <span class="n">removed_entry_from_cache</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">removed_entry_from_cache</span><span class="p">:</span>
                    <span class="c1"># write cache_map with non-existent entries removed</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">matching_unmodified_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">matching_unmodified_directory</span>

            <span class="c1"># if we&#39;re given a full file path, look up a matching file in the cache</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cache_map_entry</span> <span class="o">=</span> <span class="n">cache_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cache_map_entry</span><span class="p">:</span>
                    <span class="n">matching_file_path</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">path</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="n">matching_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">matching_file_path</span>

        <span class="c1"># return most recently cached and unmodified file OR</span>
        <span class="c1"># None if there are no unmodified files</span>
        <span class="k">for</span> <span class="n">cached_file_path</span><span class="p">,</span> <span class="n">cache_map_entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">cache_map</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;modified_time&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_item_unmodified</span><span class="p">(</span><span class="n">cache_map_entry</span><span class="p">,</span> <span class="n">cached_file_path</span><span class="p">):</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">cached_file_path</span>

        <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">({</span><span class="s2">&quot;synapse.cache.hit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.cache.Cache.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.Cache.add" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Add a file to the cache</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">md5</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a file to the cache</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t find file &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>
    <span class="n">content_md5</span> <span class="o">=</span> <span class="n">md5</span> <span class="ow">or</span> <span class="n">utils</span><span class="o">.</span><span class="n">md5_for_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># write .000 milliseconds for backward compatibility</span>
        <span class="n">cache_map</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modified_time&quot;</span><span class="p">:</span> <span class="n">epoch_time_to_iso</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_get_modified_time</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="p">),</span>
            <span class="s2">&quot;content_md5&quot;</span><span class="p">:</span> <span class="n">content_md5</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cache_map</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.cache.Cache.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.Cache.remove" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Remove a file from the cache.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_handle_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Will also extract file handle id from either a File or file handle</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="collections.abc.Mapping">Mapping</span>, str]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the given path is None, remove (and potentially delete)
            all cached copies. If the path is that of a file in the
            .cacheMap file, remove it.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>delete</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, delete the file from disk as well as removing it from the cache</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[str]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A list of files removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">file_handle_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a file from the cache.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        file_handle_id: Will also extract file handle id from either a File or file handle</span>
<span class="sd">        path:           If the given path is None, remove (and potentially delete)</span>
<span class="sd">                        all cached copies. If the path is that of a file in the</span>
<span class="sd">                        .cacheMap file, remove it.</span>
<span class="sd">        delete:         If True, delete the file from disk as well as removing it from the cache</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of files removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_dir</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">)</span>

    <span class="c1"># if we&#39;ve passed an entity and not a path, get path from entity</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_handle_id</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span>
        <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">file_handle_id</span>
    <span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">file_handle_id</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">Lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">):</span>
        <span class="n">cache_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cache_map</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">delete</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">cache_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cache_map</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">delete</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">cache_map</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
                <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_cache_map</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">removed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.cache.Cache.purge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">purge</span><span class="p">(</span><span class="n">before_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">after_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.Cache.purge" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Purge the cache. Use with caution. Deletes files whose cache maps were last updated in a specified period.</p>
<p>Deletes .cacheMap files and files stored in the cache.cache_root_dir, but does not delete files stored outside
the cache.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>before_date</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If specified, all files before this date will be removed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="datetime.datetime">datetime</span>, int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>after_date</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If specified, all files after this date will be removed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="datetime.datetime">datetime</span>, int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dry_run</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If dry_run is True, then the selected files are printed rather than removed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>int</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The number of files selected for removal</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Using this function</summary>
  <p>Either the before_date or after_date must be specified. If both are passed, files between the two dates are
selected for removal. Dates must either be a timezone naive Python datetime.datetime instance or the number
of seconds since the unix epoch. For example to delete all the files modified in January 2021, either of the
following can be used::</p>
<p>using offset naive datetime objects</p>
<pre><code>cache.purge(after_date=datetime.datetime(2021, 1, 1), before_date=datetime.datetime(2021, 2, 1))
</code></pre>
<p>using seconds since the unix epoch</p>
<pre><code>cache.purge(after_date=1609459200, before_date=1612137600)
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">purge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">before_date</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">after_date</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Purge the cache. Use with caution. Deletes files whose cache maps were last updated in a specified period.</span>

<span class="sd">    Deletes .cacheMap files and files stored in the cache.cache_root_dir, but does not delete files stored outside</span>
<span class="sd">    the cache.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        before_date: If specified, all files before this date will be removed</span>
<span class="sd">        after_date:  If specified, all files after this date will be removed</span>
<span class="sd">        dry_run:     If dry_run is True, then the selected files are printed rather than removed</span>

<span class="sd">    Returns:</span>
<span class="sd">        The number of files selected for removal</span>

<span class="sd">    Example: Using this function</span>
<span class="sd">        Either the before_date or after_date must be specified. If both are passed, files between the two dates are</span>
<span class="sd">        selected for removal. Dates must either be a timezone naive Python datetime.datetime instance or the number</span>
<span class="sd">        of seconds since the unix epoch. For example to delete all the files modified in January 2021, either of the</span>
<span class="sd">        following can be used::</span>

<span class="sd">        using offset naive datetime objects</span>

<span class="sd">            cache.purge(after_date=datetime.datetime(2021, 1, 1), before_date=datetime.datetime(2021, 2, 1))</span>

<span class="sd">        using seconds since the unix epoch</span>

<span class="sd">            cache.purge(after_date=1609459200, before_date=1612137600)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">before_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">after_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either before date or after date should be provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">before_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="n">before_date</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">before_date</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">after_date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="n">after_date</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">after_date</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">before_date</span> <span class="ow">and</span> <span class="n">after_date</span> <span class="ow">and</span> <span class="n">before_date</span> <span class="o">&lt;</span> <span class="n">after_date</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Before date should be larger than after date&quot;</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cache_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirs</span><span class="p">():</span>
        <span class="c1"># _get_modified_time returns None if the cache map file doesn&#39;t</span>
        <span class="c1"># exist and n &gt; None evaluates to True in python 2.7(wtf?). I&#39;m guessing it&#39;s</span>
        <span class="c1"># OK to purge directories in the cache that have no .cacheMap file</span>

        <span class="n">last_modified_time</span> <span class="o">=</span> <span class="n">_get_modified_time</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_map_file_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">last_modified_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">before_date</span> <span class="ow">or</span> <span class="n">before_date</span> <span class="o">&gt;</span> <span class="n">last_modified_time</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">after_date</span> <span class="ow">or</span> <span class="n">after_date</span> <span class="o">&lt;</span> <span class="n">last_modified_time</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="synapseclient.core.cache-functions">Functions<a href="#synapseclient.core.cache-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.cache.epoch_time_to_iso" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">epoch_time_to_iso</span><span class="p">(</span><span class="n">epoch_time</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.epoch_time_to_iso" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert seconds since unix epoch to a string in ISO format</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">epoch_time_to_iso</span><span class="p">(</span><span class="n">epoch_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert seconds since unix epoch to a string in ISO format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="kc">None</span>
        <span class="k">if</span> <span class="n">epoch_time</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">utils</span><span class="o">.</span><span class="n">datetime_to_iso</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">from_unix_epoch_time_secs</span><span class="p">(</span><span class="n">epoch_time</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.cache.iso_time_to_epoch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iso_time_to_epoch</span><span class="p">(</span><span class="n">iso_time</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.iso_time_to_epoch" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert an ISO formatted time into seconds since unix epoch</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">iso_time_to_epoch</span><span class="p">(</span><span class="n">iso_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an ISO formatted time into seconds since unix epoch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="kc">None</span>
        <span class="k">if</span> <span class="n">iso_time</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">iso_to_datetime</span><span class="p">(</span><span class="n">iso_time</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.cache.compare_timestamps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_timestamps</span><span class="p">(</span><span class="n">modified_time</span><span class="p">,</span> <span class="n">cached_time</span><span class="p">)</span></code>

<a href="#synapseclient.core.cache.compare_timestamps" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Compare two ISO formatted timestamps, with a special case when cached_time ends in .000Z.</p>
<p>For backward compatibility, we always write .000 for milliseconds into the cache.
We then match a cached time ending in .000Z, meaning zero milliseconds with a modified time with any number of
milliseconds.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>modified_time</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The float representing seconds since unix epoch</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cached_time</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The string holding a ISO formatted time</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/cache.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_timestamps</span><span class="p">(</span><span class="n">modified_time</span><span class="p">,</span> <span class="n">cached_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare two ISO formatted timestamps, with a special case when cached_time ends in .000Z.</span>

<span class="sd">    For backward compatibility, we always write .000 for milliseconds into the cache.</span>
<span class="sd">    We then match a cached time ending in .000Z, meaning zero milliseconds with a modified time with any number of</span>
<span class="sd">    milliseconds.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        modified_time: The float representing seconds since unix epoch</span>
<span class="sd">        cached_time:   The string holding a ISO formatted time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cached_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">modified_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">cached_time</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.000Z&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cached_time</span> <span class="o">==</span> <span class="n">epoch_time_to_iso</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">modified_time</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cached_time</span> <span class="o">==</span> <span class="n">epoch_time_to_iso</span><span class="p">(</span><span class="n">modified_time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="credentials">Credentials<a class="headerlink" href="#credentials" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="synapseclient.core.credentials.cred_data.SynapseCredentials" class="doc doc-heading">
            <code>synapseclient.core.credentials.cred_data.SynapseCredentials</code>


<a href="#synapseclient.core.credentials.cred_data.SynapseCredentials" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="requests.auth.AuthBase">AuthBase</span></code>, <code><span title="abc.ABC">ABC</span></code></p>


              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/cred_data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseCredentials</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">AuthBase</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The username associated with these credentials.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">secret</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The secret associated with these credentials.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h3 id="synapseclient.core.credentials.cred_data.SynapseCredentials-attributes">Attributes<a href="#synapseclient.core.credentials.cred_data.SynapseCredentials-attributes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-attribute">



<h4 id="synapseclient.core.credentials.cred_data.SynapseCredentials.username" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">username</span><span class="p">:</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.username" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>The username associated with these credentials.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="synapseclient.core.credentials.cred_data.SynapseCredentials.secret" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">secret</span><span class="p">:</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#synapseclient.core.credentials.cred_data.SynapseCredentials.secret" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>The secret associated with these credentials.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials" class="doc doc-heading">
            <code>synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials</code>


<a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.cred_data.SynapseCredentials" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a></code></p>


              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/cred_data.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseAuthTokenCredentials</span><span class="p">(</span><span class="n">SynapseCredentials</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_keyring_service_name</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;SYNAPSE.ORG_CLIENT_AUTH_TOKEN&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;SYNAPSE.ORG_CLIENT_AUTH_TOKEN&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_validate_token</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="c1"># decode the token to ensure it minimally has view scope.</span>
        <span class="c1"># if it doesn&#39;t raise an error, the client will not be useful without it.</span>

        <span class="c1"># if for any reason we are not able to decode the token and check its scopes</span>
        <span class="c1"># we do NOT raise an error. this is to accommodate the possibility of a changed</span>
        <span class="c1"># token format some day that this version of the client may still be able to</span>
        <span class="c1"># pass as a bearer token.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">token_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span>
                    <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64decode</span><span class="p">(</span>
                        <span class="c1"># we add padding to ensure that lack of padding won&#39;t prevent a decode error.</span>
                        <span class="c1"># the python base64 implementation will truncate extra padding so we can overpad</span>
                        <span class="c1"># rather than compute exactly how much padding we might need.</span>
                        <span class="c1"># https://stackoverflow.com/a/49459036</span>
                        <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="o">+</span> <span class="s2">&quot;===&quot;</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scopes</span> <span class="o">=</span> <span class="n">token_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scopes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;view&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SynapseAuthenticationError</span><span class="p">(</span><span class="s2">&quot;A view scoped token is required&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># possible errors if token is not encoded as expected:</span>
            <span class="c1"># IndexError if the token is not a &#39;.&#39; delimited base64 string with a header and body</span>
            <span class="c1"># ValueError if the split string is not base64 encoded or if the decoded base64 is not json</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The username associated with this token.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span>

    <span class="nd">@username</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">secret</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The bearer token.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;SynapseAuthTokenCredentials(username=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;, token=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h3 id="synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials-attributes">Attributes<a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials-attributes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-attribute">



<h4 id="synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.username" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

<a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.username" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>The username associated with this token.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.secret" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">secret</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#synapseclient.core.credentials.cred_data.SynapseAuthTokenCredentials.secret" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>The bearer token.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.credentials.credential_provider" class="doc doc-heading">
            <code>synapseclient.core.credentials.credential_provider</code>


<a href="#synapseclient.core.credentials.credential_provider" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This module contains classes that are responsible for retrieving synapse authentication
information (e.g. authToken) from a source (e.g. login args, config file).</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.credentials.credential_provider-classes">Classes<a href="#synapseclient.core.credentials.credential_provider-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" class="doc doc-heading">
            <code>SynapseCredentialsProvider</code>


<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>A credential provider is responsible for retrieving synapse authentication
information (e.g. authToken) from a source (e.g. login args, config file),
and use them to return a
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>
instance.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseCredentialsProvider</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A credential provider is responsible for retrieving synapse authentication</span>
<span class="sd">    information (e.g. authToken) from a source (e.g. login args, config file),</span>
<span class="sd">    and use them to return a</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">    instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_auth_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses must implement this to decide how to obtain an authentication token.</span>
<span class="sd">        For any of these values, return None if it is not possible to get that value.</span>

<span class="sd">        Not all implementations will need to make use of the user_login_args parameter</span>
<span class="sd">        or syn. These parameters provide context about the Synapse client&#39;s configuration</span>
<span class="sd">        and login() arguments.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            syn: Synapse client instance</span>
<span class="sd">            user_login_args: subset of arguments passed during syn.login()</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (username, bearer authentication token e.g. a personal access token),</span>
<span class="sd">            any of these values could None if it is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_synapse_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SynapseCredentials</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">        if this provider is able to get valid credentials, returns None otherwise.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            syn: Synapse client instance</span>
<span class="sd">            user_login_args: subset of arguments passed during syn.login()</span>

<span class="sd">        Returns:</span>
<span class="sd">            [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">                if valid credentials can be found by this provider, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_synapse_credential</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_auth_info</span><span class="p">(</span><span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="o">=</span><span class="n">user_login_args</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_synapse_credential</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">auth_token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SynapseCredentials</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">auth_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">SynapseAuthTokenCredentials</span><span class="p">(</span><span class="n">auth_token</span><span class="p">)</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">restGET</span><span class="p">(</span><span class="s2">&quot;/userProfile&quot;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
            <span class="n">profile_username</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;userName&quot;</span><span class="p">)</span>
            <span class="n">profile_emails</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;emails&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="k">if</span> <span class="n">username</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">username</span> <span class="o">!=</span> <span class="n">profile_username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profile_emails</span>
            <span class="p">):</span>
                <span class="c1"># a username/email is not required when logging in with an auth token</span>
                <span class="c1"># however if both are provided raise an error if they do not correspond</span>
                <span class="c1"># to avoid any ambiguity about what profile was logged in</span>
                <span class="k">raise</span> <span class="n">SynapseAuthenticationError</span><span class="p">(</span>
                    <span class="s2">&quot;username/email and auth_token both provided but username does not &quot;</span>
                    <span class="s2">&quot;match token profile&quot;</span>
                <span class="p">)</span>

            <span class="n">credentials</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">profile_username</span>
            <span class="k">return</span> <span class="n">credentials</span>

        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider-functions">Functions<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider.get_synapse_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_synapse_credentials</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">)</span></code>

<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider.get_synapse_credentials" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Returns
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>
if this provider is able to get valid credentials, returns None otherwise.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Synapse client instance</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>user_login_args</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>subset of arguments passed during syn.login()</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, str]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="synapseclient.core.credentials.cred_data.SynapseCredentials" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>
if valid credentials can be found by this provider, None otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_synapse_credentials</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SynapseCredentials</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">    if this provider is able to get valid credentials, returns None otherwise.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: Synapse client instance</span>
<span class="sd">        user_login_args: subset of arguments passed during syn.login()</span>

<span class="sd">    Returns:</span>
<span class="sd">        [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">            if valid credentials can be found by this provider, None otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_synapse_credential</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_auth_info</span><span class="p">(</span><span class="n">syn</span><span class="o">=</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="o">=</span><span class="n">user_login_args</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider" class="doc doc-heading">
            <code>UserArgsCredentialsProvider</code>


<a href="#synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a></code></p>


      <p>Retrieves auth info from user_login_args during a CLI session.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UserArgsCredentialsProvider</span><span class="p">(</span><span class="n">SynapseCredentialsProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves auth info from user_login_args during a CLI session.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_auth_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="n">user_login_args</span><span class="o">.</span><span class="n">auth_token</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider" class="doc doc-heading">
            <code>ConfigFileCredentialsProvider</code>


<a href="#synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a></code></p>


      <p>Retrieves auth info from the <code>~/.synapseConfig</code> file</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ConfigFileCredentialsProvider</span><span class="p">(</span><span class="n">SynapseCredentialsProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves auth info from the `~/.synapseConfig` file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_auth_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">get_config_authentication</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">configPath</span><span class="p">)</span>
        <span class="c1"># check to make sure we didn&#39;t accidentally provide the wrong user</span>

        <span class="n">username</span> <span class="o">=</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authtoken&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span> <span class="ow">and</span> <span class="n">username</span> <span class="o">!=</span> <span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
            <span class="c1"># if the username is provided and there is a config file username but they</span>
            <span class="c1"># don&#39;t match then we don&#39;t use any of the values from the config</span>
            <span class="c1"># to prevent ambiguity</span>
            <span class="n">username</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> was defined in the user login &quot;</span>
                <span class="s2">&quot;arguments, however, it is also defined in the `~/.synapseConfig` &quot;</span>
                <span class="s2">&quot;file. Becuase they do not match we will not use the `authtoken` &quot;</span>
                <span class="s2">&quot;in the `~/.synapseConfig` file.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">token</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider" class="doc doc-heading">
            <code>AWSParameterStoreCredentialsProvider</code>


<a href="#synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a></code></p>


      <p>Retrieves user's authentication token from AWS SSM Parameter store</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AWSParameterStoreCredentialsProvider</span><span class="p">(</span><span class="n">SynapseCredentialsProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves user&#39;s authentication token from AWS SSM Parameter store</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ENVIRONMENT_VAR_NAME</span> <span class="o">=</span> <span class="s2">&quot;SYNAPSE_TOKEN_AWS_SSM_PARAMETER_NAME&quot;</span>

    <span class="k">def</span> <span class="nf">_get_auth_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="n">ssm_param_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENT_VAR_NAME</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ssm_param_name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">boto3</span>
                <span class="kn">import</span> <span class="nn">botocore</span>

                <span class="n">ssm_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;ssm&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ssm_client</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
                    <span class="n">Name</span><span class="o">=</span><span class="n">ssm_param_name</span><span class="p">,</span>
                    <span class="n">WithDecryption</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">][</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENT_VAR_NAME</span><span class="si">}</span><span class="s2"> was defined as </span><span class="si">{</span><span class="n">ssm_param_name</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="s1">&#39;but &quot;boto3&quot; could not be imported. The Synapse client uses &quot;boto3&quot; &#39;</span>
                    <span class="s2">&quot;in order to access Systems Manager Parameter Storage. Please ensure &quot;</span>
                    <span class="s1">&#39;that you have installed &quot;boto3&quot; to enable this feature.&#39;</span>
                <span class="p">)</span>
            <span class="c1"># this except block must be defined after the ImportError except block</span>
            <span class="c1"># otherwise, there&#39;s no guarantee &quot;botocore&quot; is already imported and defined</span>
            <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">:</span>
                <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENT_VAR_NAME</span><span class="si">}</span><span class="s2"> was defined as </span><span class="si">{</span><span class="n">ssm_param_name</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="s2">&quot;but the matching parameter name could not be found in AWS Parameter &quot;</span>
                    <span class="s2">&quot;Store. Caused by AWS error:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># if username is included in user&#39;s arguments, return it so that</span>
        <span class="c1"># it may be validated against the username authenticated by the token</span>
        <span class="k">return</span> <span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">token</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider" class="doc doc-heading">
            <code>EnvironmentVariableCredentialsProvider</code>


<a href="#synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a></code></p>


      <p>Retrieves the user's authentication token from an environment variable</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EnvironmentVariableCredentialsProvider</span><span class="p">(</span><span class="n">SynapseCredentialsProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the user&#39;s authentication token from an environment variable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ENVIRONMENT_VAR_NAME</span> <span class="o">=</span> <span class="s2">&quot;SYNAPSE_AUTH_TOKEN&quot;</span>

    <span class="k">def</span> <span class="nf">_get_auth_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">user_login_args</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENVIRONMENT_VAR_NAME</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain" class="doc doc-heading">
            <code>SynapseCredentialsProviderChain</code>


<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Class that has a list of
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a>
from which this class attempts to retrieve
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>.</p>
<p>By default this class uses the following providers in this order:</p>
<ol>
<li><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider">UserArgsCredentialsProvider</a></li>
<li><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider">ConfigFileCredentialsProvider</a></li>
<li><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider">EnvironmentVariableCredentialsProvider</a></li>
<li><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider">AWSParameterStoreCredentialsProvider</a></li>
</ol>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain.cred_providers">cred_providers</span></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>list of
(<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a>)
credential providers</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SynapseCredentialsProviderChain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that has a list of</span>
<span class="sd">    [SynapseCredentialsProvider][synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider]</span>
<span class="sd">    from which this class attempts to retrieve</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials].</span>


<span class="sd">    By default this class uses the following providers in this order:</span>

<span class="sd">    1. [UserArgsCredentialsProvider][synapseclient.core.credentials.credential_provider.UserArgsCredentialsProvider]</span>
<span class="sd">    2. [ConfigFileCredentialsProvider][synapseclient.core.credentials.credential_provider.ConfigFileCredentialsProvider]</span>
<span class="sd">    3. [EnvironmentVariableCredentialsProvider][synapseclient.core.credentials.credential_provider.EnvironmentVariableCredentialsProvider]</span>
<span class="sd">    4. [AWSParameterStoreCredentialsProvider][synapseclient.core.credentials.credential_provider.AWSParameterStoreCredentialsProvider]</span>

<span class="sd">    Attributes:</span>
<span class="sd">        cred_providers: list of</span>
<span class="sd">            ([SynapseCredentialsProvider][synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider])</span>
<span class="sd">            credential providers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cred_providers</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cred_providers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cred_providers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SynapseCredentials</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates its list of</span>
<span class="sd">        [SynapseCredentialsProvider][synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider]</span>
<span class="sd">        and returns the first non-None</span>
<span class="sd">        [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">        returned by a provider. If no provider is able to provide a</span>
<span class="sd">        [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials],</span>
<span class="sd">        returns None.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            syn: Synapse client instance</span>
<span class="sd">            user_login_args: subset of arguments passed during syn.login()</span>

<span class="sd">        Returns:</span>
<span class="sd">            [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">                returned by the first non-None provider in its list, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cred_providers</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_synapse_credentials</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">creds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">creds</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain-functions">Functions<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain.get_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_credentials</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">)</span></code>

<a href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain.get_credentials" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Iterates its list of
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider">SynapseCredentialsProvider</a>
and returns the first non-None
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>
returned by a provider. If no provider is able to provide a
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>,
returns None.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Synapse client instance</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>user_login_args</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>subset of arguments passed during syn.login()</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, str]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="synapseclient.core.credentials.cred_data.SynapseCredentials" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p><a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>
returned by the first non-None provider in its list, None otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_credentials</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SynapseCredentials</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates its list of</span>
<span class="sd">    [SynapseCredentialsProvider][synapseclient.core.credentials.credential_provider.SynapseCredentialsProvider]</span>
<span class="sd">    and returns the first non-None</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">    returned by a provider. If no provider is able to provide a</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials],</span>
<span class="sd">    returns None.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: Synapse client instance</span>
<span class="sd">        user_login_args: subset of arguments passed during syn.login()</span>

<span class="sd">    Returns:</span>
<span class="sd">        [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials]</span>
<span class="sd">            returned by the first non-None provider in its list, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cred_providers</span><span class="p">:</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_synapse_credentials</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">user_login_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">creds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">creds</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="synapseclient.core.credentials.credential_provider-functions">Functions<a href="#synapseclient.core.credentials.credential_provider-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.credentials.credential_provider.get_default_credential_chain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_default_credential_chain</span><span class="p">()</span></code>

<a href="#synapseclient.core.credentials.credential_provider.get_default_credential_chain" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Creates and uses a default credential chain to retrieve
<a class="autorefs autorefs-internal" href="#synapseclient.core.credentials.cred_data.SynapseCredentials">SynapseCredentials</a>.
The order this is returned is the order in which the credential providers
are attempted.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain" href="#synapseclient.core.credentials.credential_provider.SynapseCredentialsProviderChain">SynapseCredentialsProviderChain</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>credential chain</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/credentials/credential_provider.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_default_credential_chain</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SynapseCredentialsProviderChain</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and uses a default credential chain to retrieve</span>
<span class="sd">    [SynapseCredentials][synapseclient.core.credentials.cred_data.SynapseCredentials].</span>
<span class="sd">    The order this is returned is the order in which the credential providers</span>
<span class="sd">    are attempted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        credential chain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DEFAULT_CREDENTIAL_PROVIDER_CHAIN</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="remote-file-storage-wrappers">Remote File Storage Wrappers<a class="headerlink" href="#remote-file-storage-wrappers" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.remote_file_storage_wrappers" class="doc doc-heading">
            <code>synapseclient.core.remote_file_storage_wrappers</code>


<a href="#synapseclient.core.remote_file_storage_wrappers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>Wrappers for remote file storage clients like S3 and SFTP.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.remote_file_storage_wrappers-classes">Classes<a href="#synapseclient.core.remote_file_storage_wrappers-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper" class="doc doc-heading">
            <code>S3ClientWrapper</code>


<a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Wrapper class for S3 client.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">S3ClientWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper class for S3 client.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># These methods are static because in our use case, we always have the bucket and</span>
    <span class="c1"># endpoint and usually only call the download/upload once so there is no need to instantiate multiple objects</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_attempt_import_boto3</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if boto3 installed and give instructions if not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The boto3 module or instructions to install it if unavailable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">attempt_import</span><span class="p">(</span>
            <span class="s2">&quot;boto3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Libraries required for client authenticated S3 access are not installed!</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;The Synapse client uses boto3 in order to access S3-like storage &quot;</span>
            <span class="s2">&quot;locations.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_progress_callback_func</span><span class="p">(</span>
        <span class="n">progress_bar</span><span class="p">:</span> <span class="n">tqdm</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a progress callback function for tracking the progress of a file transfer.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            file_size: The total size of the file being transferred.</span>
<span class="sd">            filename: The name of the file being transferred.</span>
<span class="sd">            prefix: A prefix to display before the progress bar. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            progress_callback: The progress callback function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">progress_callback</span><span class="p">(</span><span class="n">transferred_bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Update the progress of a transfer.</span>

<span class="sd">            Arguments:</span>
<span class="sd">                bytes: The number of bytes transferred.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">increment_progress_bar</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">transferred_bytes</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">progress_callback</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
        <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">endpoint_url</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">remote_file_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">download_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progress_bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tqdm</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transfer_config_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download a file from s3 using boto3.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            bucket: name of bucket to upload to</span>
<span class="sd">            endpoint_url: a boto3 compatible endpoint url</span>
<span class="sd">            remote_file_key: object key to upload the file to</span>
<span class="sd">            download_file_path: local path to save the file to</span>
<span class="sd">            profile_name: AWS profile name from local aws config, **mutually exclusive with credentials**</span>
<span class="sd">            credentials: a dictionary of AWS credentials to use, **mutually exclusive with profile_name**</span>

<span class="sd">                Expected items:</span>

<span class="sd">                - `aws_access_key_id`</span>
<span class="sd">                - `aws_secret_access_key`</span>
<span class="sd">                - `aws_session_token`</span>
<span class="sd">            progress_bar: The progress bar to update. Defaults to None.</span>
<span class="sd">            transfer_config_kwargs: boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</span>

<span class="sd">        Returns:</span>
<span class="sd">            download_file_path: S3 path of the file</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the key does not exist in the bucket.</span>
<span class="sd">            botocore.exceptions.ClientError: If there is an error with the S3 client.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_attempt_import_boto3</span><span class="p">()</span>

        <span class="kn">import</span> <span class="nn">boto3.s3.transfer</span>
        <span class="kn">import</span> <span class="nn">botocore</span>

        <span class="n">transfer_config</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">TransferConfig</span><span class="p">(</span>
            <span class="o">**</span><span class="p">(</span><span class="n">transfer_config_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="p">)</span>

        <span class="n">session_args</span> <span class="o">=</span> <span class="n">credentials</span> <span class="k">if</span> <span class="n">credentials</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="n">profile_name</span><span class="p">}</span>
        <span class="n">boto_session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="o">**</span><span class="n">session_args</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">s3_obj</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">)</span>

            <span class="n">progress_callback</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s3_obj</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">s3_obj</span><span class="o">.</span><span class="n">content_length</span>
                <span class="n">increment_progress_bar_total</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>
                <span class="n">progress_callback</span> <span class="o">=</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_create_progress_callback_func</span><span class="p">(</span>
                    <span class="n">progress_bar</span>
                <span class="p">)</span>

            <span class="n">s3_obj</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
                <span class="n">download_file_path</span><span class="p">,</span>
                <span class="n">Callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
                <span class="n">Config</span><span class="o">=</span><span class="n">transfer_config</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">download_file_path</span>

        <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;Error&quot;</span><span class="p">][</span><span class="s2">&quot;Code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;404&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The key:</span><span class="si">%s</span><span class="s2"> does not exist in bucket:</span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">,</span> <span class="n">bucket</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
        <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">endpoint_url</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">remote_file_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">upload_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">profile_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">transfer_config_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a file to s3 using boto3.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            bucket: name of bucket to upload to</span>
<span class="sd">            endpoint_url: a boto3 compatible endpoint url</span>
<span class="sd">            remote_file_key: object key to upload the file to</span>
<span class="sd">            upload_file_path: local path of the file to upload</span>
<span class="sd">            profile_name: AWS profile name from local aws config, **mutually exclusive with credentials**</span>
<span class="sd">            credentials: a dictionary of AWS credentials to use, **mutually exclusive with profile_name**</span>

<span class="sd">                Expected items:</span>

<span class="sd">                - `aws_access_key_id`</span>
<span class="sd">                - `aws_secret_access_key`</span>
<span class="sd">                - `aws_session_token`</span>
<span class="sd">            show_progress: whether to print progress indicator to console</span>
<span class="sd">            transfer_config_kwargs: boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</span>

<span class="sd">        Returns:</span>
<span class="sd">            upload_file_path: S3 path of the file</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the path does not exist or is not a file</span>
<span class="sd">            botocore.exceptions.ClientError: If there is an error with the S3 client.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The path: [</span><span class="si">%s</span><span class="s2">] does not exist or is not a file&quot;</span><span class="p">,</span> <span class="n">upload_file_path</span>
            <span class="p">)</span>

        <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_attempt_import_boto3</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">boto3.s3.transfer</span>

        <span class="n">transfer_config</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">TransferConfig</span><span class="p">(</span>
            <span class="o">**</span><span class="p">(</span><span class="n">transfer_config_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="p">)</span>

        <span class="n">session_args</span> <span class="o">=</span> <span class="n">credentials</span> <span class="k">if</span> <span class="n">credentials</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="n">profile_name</span><span class="p">}</span>
        <span class="n">boto_session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="o">**</span><span class="n">session_args</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">)</span>

        <span class="n">progress_callback</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">)</span>
            <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
                <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">postfix</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">progress_callback</span> <span class="o">=</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_create_progress_callback_func</span><span class="p">(</span>
                <span class="n">progress_bar</span>
            <span class="p">)</span>

        <span class="c1"># automatically determines whether to perform multi-part upload</span>
        <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">upload_file_path</span><span class="p">,</span>
            <span class="n">remote_file_key</span><span class="p">,</span>
            <span class="n">Callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
            <span class="n">Config</span><span class="o">=</span><span class="n">transfer_config</span><span class="p">,</span>
            <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ACL&quot;</span><span class="p">:</span> <span class="s2">&quot;bucket-owner-full-control&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">upload_file_path</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper-functions">Functions<a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">,</span> <span class="n">download_file_path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transfer_config_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.download_file" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Download a file from s3 using boto3.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bucket</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>name of bucket to upload to</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>endpoint_url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a boto3 compatible endpoint url</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[str, None]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remote_file_key</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>object key to upload the file to</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>download_file_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>local path to save the file to</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>profile_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>AWS profile name from local aws config, <strong>mutually exclusive with credentials</strong></p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credentials</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a dictionary of AWS credentials to use, <strong>mutually exclusive with profile_name</strong></p>
<p>Expected items:</p>
<ul>
<li><code>aws_access_key_id</code></li>
<li><code>aws_secret_access_key</code></li>
<li><code>aws_session_token</code></li>
</ul>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>progress_bar</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The progress bar to update. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="tqdm.tqdm">tqdm</span>, None]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transfer_config_kwargs</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>download_file_path</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>S3 path of the file</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ValueError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the key does not exist in the bucket.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="botocore.exceptions.ClientError">ClientError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If there is an error with the S3 client.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">remote_file_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">download_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">profile_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tqdm</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transfer_config_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a file from s3 using boto3.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        bucket: name of bucket to upload to</span>
<span class="sd">        endpoint_url: a boto3 compatible endpoint url</span>
<span class="sd">        remote_file_key: object key to upload the file to</span>
<span class="sd">        download_file_path: local path to save the file to</span>
<span class="sd">        profile_name: AWS profile name from local aws config, **mutually exclusive with credentials**</span>
<span class="sd">        credentials: a dictionary of AWS credentials to use, **mutually exclusive with profile_name**</span>

<span class="sd">            Expected items:</span>

<span class="sd">            - `aws_access_key_id`</span>
<span class="sd">            - `aws_secret_access_key`</span>
<span class="sd">            - `aws_session_token`</span>
<span class="sd">        progress_bar: The progress bar to update. Defaults to None.</span>
<span class="sd">        transfer_config_kwargs: boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</span>

<span class="sd">    Returns:</span>
<span class="sd">        download_file_path: S3 path of the file</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the key does not exist in the bucket.</span>
<span class="sd">        botocore.exceptions.ClientError: If there is an error with the S3 client.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_attempt_import_boto3</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">boto3.s3.transfer</span>
    <span class="kn">import</span> <span class="nn">botocore</span>

    <span class="n">transfer_config</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">TransferConfig</span><span class="p">(</span>
        <span class="o">**</span><span class="p">(</span><span class="n">transfer_config_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="p">)</span>

    <span class="n">session_args</span> <span class="o">=</span> <span class="n">credentials</span> <span class="k">if</span> <span class="n">credentials</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="n">profile_name</span><span class="p">}</span>
    <span class="n">boto_session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="o">**</span><span class="n">session_args</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">s3_obj</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">)</span>

        <span class="n">progress_callback</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s3_obj</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">s3_obj</span><span class="o">.</span><span class="n">content_length</span>
            <span class="n">increment_progress_bar_total</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">)</span>
            <span class="n">progress_callback</span> <span class="o">=</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_create_progress_callback_func</span><span class="p">(</span>
                <span class="n">progress_bar</span>
            <span class="p">)</span>

        <span class="n">s3_obj</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
            <span class="n">download_file_path</span><span class="p">,</span>
            <span class="n">Callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
            <span class="n">Config</span><span class="o">=</span><span class="n">transfer_config</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">download_file_path</span>

    <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;Error&quot;</span><span class="p">][</span><span class="s2">&quot;Code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;404&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The key:</span><span class="si">%s</span><span class="s2"> does not exist in bucket:</span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">,</span> <span class="n">bucket</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.upload_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="p">,</span> <span class="n">remote_file_key</span><span class="p">,</span> <span class="n">upload_file_path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transfer_config_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#synapseclient.core.remote_file_storage_wrappers.S3ClientWrapper.upload_file" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Upload a file to s3 using boto3.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>bucket</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>name of bucket to upload to</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>endpoint_url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a boto3 compatible endpoint url</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>remote_file_key</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>object key to upload the file to</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>upload_file_path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>local path of the file to upload</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>profile_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>AWS profile name from local aws config, <strong>mutually exclusive with credentials</strong></p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>credentials</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a dictionary of AWS credentials to use, <strong>mutually exclusive with profile_name</strong></p>
<p>Expected items:</p>
<ul>
<li><code>aws_access_key_id</code></li>
<li><code>aws_secret_access_key</code></li>
<li><code>aws_session_token</code></li>
</ul>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>show_progress</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether to print progress indicator to console</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transfer_config_kwargs</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>upload_file_path</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>S3 path of the file</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ValueError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the path does not exist or is not a file</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><span title="botocore.exceptions.ClientError">ClientError</span></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If there is an error with the S3 client.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">remote_file_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">upload_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">profile_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">transfer_config_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload a file to s3 using boto3.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        bucket: name of bucket to upload to</span>
<span class="sd">        endpoint_url: a boto3 compatible endpoint url</span>
<span class="sd">        remote_file_key: object key to upload the file to</span>
<span class="sd">        upload_file_path: local path of the file to upload</span>
<span class="sd">        profile_name: AWS profile name from local aws config, **mutually exclusive with credentials**</span>
<span class="sd">        credentials: a dictionary of AWS credentials to use, **mutually exclusive with profile_name**</span>

<span class="sd">            Expected items:</span>

<span class="sd">            - `aws_access_key_id`</span>
<span class="sd">            - `aws_secret_access_key`</span>
<span class="sd">            - `aws_session_token`</span>
<span class="sd">        show_progress: whether to print progress indicator to console</span>
<span class="sd">        transfer_config_kwargs: boto S3 transfer configuration (see boto3.s3.transfer.TransferConfig)</span>

<span class="sd">    Returns:</span>
<span class="sd">        upload_file_path: S3 path of the file</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the path does not exist or is not a file</span>
<span class="sd">        botocore.exceptions.ClientError: If there is an error with the S3 client.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The path: [</span><span class="si">%s</span><span class="s2">] does not exist or is not a file&quot;</span><span class="p">,</span> <span class="n">upload_file_path</span>
        <span class="p">)</span>

    <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_attempt_import_boto3</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">boto3.s3.transfer</span>

    <span class="n">transfer_config</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">TransferConfig</span><span class="p">(</span>
        <span class="o">**</span><span class="p">(</span><span class="n">transfer_config_kwargs</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="p">)</span>

    <span class="n">session_args</span> <span class="o">=</span> <span class="n">credentials</span> <span class="k">if</span> <span class="n">credentials</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="n">profile_name</span><span class="p">}</span>
    <span class="n">boto_session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="o">**</span><span class="n">session_args</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint_url</span><span class="p">)</span>

    <span class="n">progress_callback</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">progress_bar</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">upload_file_path</span><span class="p">)</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="n">file_size</span><span class="p">,</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">postfix</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">progress_callback</span> <span class="o">=</span> <span class="n">S3ClientWrapper</span><span class="o">.</span><span class="n">_create_progress_callback_func</span><span class="p">(</span>
            <span class="n">progress_bar</span>
        <span class="p">)</span>

    <span class="c1"># automatically determines whether to perform multi-part upload</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
        <span class="n">upload_file_path</span><span class="p">,</span>
        <span class="n">remote_file_key</span><span class="p">,</span>
        <span class="n">Callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
        <span class="n">Config</span><span class="o">=</span><span class="n">transfer_config</span><span class="p">,</span>
        <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ACL&quot;</span><span class="p">:</span> <span class="s2">&quot;bucket-owner-full-control&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">upload_file_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.remote_file_storage_wrappers.SFTPWrapper" class="doc doc-heading">
            <code>SFTPWrapper</code>


<a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SFTPWrapper</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_attempt_import_sftp</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if pysftp is installed and give instructions if not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The pysftp module if available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">attempt_import</span><span class="p">(</span>
            <span class="s2">&quot;pysftp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Libraries required for SFTP are not installed!</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;The Synapse client uses pysftp in order to access SFTP storage locations. &quot;</span>
            <span class="s2">&quot;This library in turn depends on pycrypto.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;For Windows systems without a C/C++ compiler, install the appropriate binary &quot;</span>
            <span class="s2">&quot;distribution of pycrypto from:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;http://www.voidspace.org.uk/python/modules.shtml#pycrypto</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;For more information, see: http://python-docs.synapse.org/build/html/sftp.html&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_for_sftp</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">scheme</span> <span class="o">!=</span> <span class="s2">&quot;sftp&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span>
                <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;This method only supports sftp URLs of the form sftp://...&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">parsedURL</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs upload of a local file to an sftp server.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            filepath: The path to the file to be uploaded.</span>
<span class="sd">            url: URL where file will be deposited. Should include path and protocol. e.g.</span>
<span class="sd">                        sftp://sftp.example.com/path/to/file/store</span>
<span class="sd">            username: The username for authentication. Defaults to None.</span>
<span class="sd">            password: The password for authentication. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The URL of the uploaded file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
            <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">postfix</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">progress_callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span><span class="p">:</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">_parse_for_sftp</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">_retry_pysftp_connection</span><span class="p">(</span>
            <span class="n">parsedURL</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
            <span class="n">sftp</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">sftp</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">preserve_mtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">)</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">parsedURL</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">localFilepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progress_bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tqdm</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs download of a file from an sftp server.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            url: URL where file will be deposited.  Path will be chopped out.</span>
<span class="sd">            localFilepath: location where to store file</span>
<span class="sd">            username: username on server</span>
<span class="sd">            password: password for authentication on  server</span>
<span class="sd">            progress_bar: The progress bar to update. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The local filepath where the file was saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">last_transfer_checkpoint</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">progress_callback</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">nonlocal</span> <span class="n">updated_progress_bar_with_total</span>
            <span class="k">nonlocal</span> <span class="n">last_transfer_checkpoint</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">updated_progress_bar_with_total</span><span class="p">:</span>
                <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">increment_progress_bar_total</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">progress_bar</span><span class="p">)</span>
            <span class="n">increment_progress_bar</span><span class="p">(</span>
                <span class="n">n</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_transfer_checkpoint</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
            <span class="p">)</span>
            <span class="n">last_transfer_checkpoint</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">_parse_for_sftp</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Create the local file path if it doesn&#39;t exist</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">localFilepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">localFilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">):</span>
            <span class="n">localFilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Check and create the directory</span>
        <span class="n">download_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_directory</span><span class="p">)</span>

        <span class="c1"># Download file</span>
        <span class="k">with</span> <span class="n">_retry_pysftp_connection</span><span class="p">(</span>
            <span class="n">parsed_url</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
            <span class="n">sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span>
                <span class="n">localFilepath</span><span class="p">,</span>
                <span class="n">preserve_mtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="p">(</span><span class="n">progress_callback</span> <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">localFilepath</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="synapseclient.core.remote_file_storage_wrappers.SFTPWrapper-functions">Functions<a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper-functions" class="headerlink" title="Permanent link">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.upload_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.upload_file" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Performs upload of a local file to an sftp server.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filepath</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The path to the file to be uploaded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>URL where file will be deposited. Should include path and protocol. e.g.
        sftp://sftp.example.com/path/to/file/store</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>username</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The username for authentication. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>password</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The password for authentication. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The URL of the uploaded file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">storage_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs upload of a local file to an sftp server.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        filepath: The path to the file to be uploaded.</span>
<span class="sd">        url: URL where file will be deposited. Should include path and protocol. e.g.</span>
<span class="sd">                    sftp://sftp.example.com/path/to/file/store</span>
<span class="sd">        username: The username for authentication. Defaults to None.</span>
<span class="sd">        password: The password for authentication. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The URL of the uploaded file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">storage_str</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">postfix</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">progress_callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span><span class="p">:</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">_parse_for_sftp</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_retry_pysftp_connection</span><span class="p">(</span>
        <span class="n">parsedURL</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
        <span class="n">sftp</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">sftp</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">preserve_mtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">parsedURL</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">localFilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#synapseclient.core.remote_file_storage_wrappers.SFTPWrapper.download_file" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">

      <p>Performs download of a file from an sftp server.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>URL where file will be deposited.  Path will be chopped out.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>localFilepath</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>location where to store file</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>username</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>username on server</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>password</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>password for authentication on  server</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>progress_bar</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The progress bar to update. Defaults to None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="tqdm.tqdm">tqdm</span>, None]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The local filepath where the file was saved.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/remote_file_storage_wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">localFilepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tqdm</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs download of a file from an sftp server.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        url: URL where file will be deposited.  Path will be chopped out.</span>
<span class="sd">        localFilepath: location where to store file</span>
<span class="sd">        username: username on server</span>
<span class="sd">        password: password for authentication on  server</span>
<span class="sd">        progress_bar: The progress bar to update. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The local filepath where the file was saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last_transfer_checkpoint</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">progress_callback</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">updated_progress_bar_with_total</span>
        <span class="k">nonlocal</span> <span class="n">last_transfer_checkpoint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">updated_progress_bar_with_total</span><span class="p">:</span>
            <span class="n">updated_progress_bar_with_total</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">increment_progress_bar_total</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">progress_bar</span><span class="p">)</span>
        <span class="n">increment_progress_bar</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_transfer_checkpoint</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span>
        <span class="p">)</span>
        <span class="n">last_transfer_checkpoint</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">SFTPWrapper</span><span class="o">.</span><span class="n">_parse_for_sftp</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Create the local file path if it doesn&#39;t exist</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">localFilepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">localFilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">):</span>
        <span class="n">localFilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># Check and create the directory</span>
    <span class="n">download_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_directory</span><span class="p">)</span>

    <span class="c1"># Download file</span>
    <span class="k">with</span> <span class="n">_retry_pysftp_connection</span><span class="p">(</span>
        <span class="n">parsed_url</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
        <span class="n">sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="n">localFilepath</span><span class="p">,</span>
            <span class="n">preserve_mtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="p">(</span><span class="n">progress_callback</span> <span class="k">if</span> <span class="n">progress_bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">localFilepath</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="synapseclient.core.remote_file_storage_wrappers-functions">Functions<a href="#synapseclient.core.remote_file_storage_wrappers-functions" class="headerlink" title="Permanent link">&para;</a></h3>



  </div>

    </div>

</div><h2 id="retry">Retry<a class="headerlink" href="#retry" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.retry" class="doc doc-heading">
            <code>synapseclient.core.retry</code>


<a href="#synapseclient.core.retry" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>A helper tool that allows the Python client to
make more than one attempt at connecting to the server if initially met
with an error. These retry attempts can be made under certain conditions,
i.e. for certain status codes, connection errors, and/or connection exceptions.</p>



  <div class="doc doc-children">







<h3 id="synapseclient.core.retry-functions">Functions<a href="#synapseclient.core.retry-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.retry.with_retry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_retry</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">retry_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span> <span class="n">expected_status_codes</span><span class="o">=</span><span class="p">[],</span> <span class="n">retry_errors</span><span class="o">=</span><span class="p">[],</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="p">[],</span> <span class="n">retries</span><span class="o">=</span><span class="n">DEFAULT_RETRIES</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">DEFAULT_WAIT</span><span class="p">,</span> <span class="n">back_off</span><span class="o">=</span><span class="n">DEFAULT_BACK_OFF</span><span class="p">,</span> <span class="n">max_wait</span><span class="o">=</span><span class="n">DEFAULT_MAX_WAIT</span><span class="p">)</span></code>

<a href="#synapseclient.core.retry.with_retry" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Retries the given function under certain conditions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>function</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A function with no arguments.  If arguments are needed, use a lambda (see example).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What status codes to retry upon in the case of a SynapseHTTPError.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[429, 500, 502, 503, 504]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expected_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If specified responses with any other status codes result in a retry.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_errors</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What reasons to retry upon, if function().response.json()['reason'] exists.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_exceptions</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What types of exceptions, specified as strings or Exception classes, to retry upon.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retries</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How many times to retry maximum.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_RETRIES">DEFAULT_RETRIES</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wait</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How many seconds to wait between retries.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_WAIT">DEFAULT_WAIT</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>back_off</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Exponential constant to increase wait for between progressive failures.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_BACK_OFF">DEFAULT_BACK_OFF</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_wait</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>back_off between requests will not exceed this value</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_MAX_WAIT">DEFAULT_MAX_WAIT</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>function()</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Using with_retry</summary>
  <p>Using <code>with_retry</code> to consolidate inputs into a list.</p>
<pre><code>from synapseclient.core.retry import with_retry

def foo(a, b, c): return [a, b, c]
result = with_retry(lambda: foo("1", "2", "3"), **STANDARD_RETRY_PARAMS)
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/retry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_retry</span><span class="p">(</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">retry_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>
    <span class="n">expected_status_codes</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">retry_errors</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">retry_exceptions</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">retries</span><span class="o">=</span><span class="n">DEFAULT_RETRIES</span><span class="p">,</span>
    <span class="n">wait</span><span class="o">=</span><span class="n">DEFAULT_WAIT</span><span class="p">,</span>
    <span class="n">back_off</span><span class="o">=</span><span class="n">DEFAULT_BACK_OFF</span><span class="p">,</span>
    <span class="n">max_wait</span><span class="o">=</span><span class="n">DEFAULT_MAX_WAIT</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retries the given function under certain conditions.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        function: A function with no arguments.  If arguments are needed, use a lambda (see example).</span>
<span class="sd">        retry_status_codes: What status codes to retry upon in the case of a SynapseHTTPError.</span>
<span class="sd">        expected_status_codes: If specified responses with any other status codes result in a retry.</span>
<span class="sd">        retry_errors: What reasons to retry upon, if function().response.json()[&#39;reason&#39;] exists.</span>
<span class="sd">        retry_exceptions: What types of exceptions, specified as strings or Exception classes, to retry upon.</span>
<span class="sd">        retries: How many times to retry maximum.</span>
<span class="sd">        wait: How many seconds to wait between retries.</span>
<span class="sd">        back_off: Exponential constant to increase wait for between progressive failures.</span>
<span class="sd">        max_wait: back_off between requests will not exceed this value</span>

<span class="sd">    Returns:</span>
<span class="sd">        function()</span>

<span class="sd">    Example: Using with_retry</span>
<span class="sd">        Using ``with_retry`` to consolidate inputs into a list.</span>

<span class="sd">            from synapseclient.core.retry import with_retry</span>

<span class="sd">            def foo(a, b, c): return [a, b, c]</span>
<span class="sd">            result = with_retry(lambda: foo(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;), **STANDARD_RETRY_PARAMS)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">DEBUG_LOGGER_NAME</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">DEFAULT_LOGGER_NAME</span><span class="p">)</span>

    <span class="c1"># Retry until we succeed or run out of tries</span>
    <span class="n">total_wait</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Start with a clean slate</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">exc_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Try making the call</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="n">ex</span>
            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">DEBUG_EXCEPTION</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">response</span>

        <span class="c1"># Check if we got a retry-able error</span>
        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;status_code&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">expected_status_codes</span>
                <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expected_status_codes</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">retry_status_codes</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="n">retry_status_codes</span><span class="p">):</span>
                <span class="n">response_message</span> <span class="o">=</span> <span class="n">_get_message</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="n">retry</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;retrying on status code: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>
                <span class="c1"># TODO: this was originally printed regardless of &#39;verbose&#39; was that behavior correct?</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response_message</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wait</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response_message</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Retrying in </span><span class="si">%i</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">wait</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">299</span><span class="p">):</span>
                <span class="c1"># For all other non 200 messages look for retryable errors in the body or reason field</span>
                <span class="n">response_message</span> <span class="o">=</span> <span class="n">_get_message</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">response_message</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">retry_errors</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">retry</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;retrying </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response_message</span><span class="p">)</span>
                <span class="c1"># special case for message throttling</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">&quot;Please slow down.  You may send a maximum of 10 message&quot;</span>
                    <span class="ow">in</span> <span class="n">response</span>
                <span class="p">):</span>
                    <span class="n">retry</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">wait</span> <span class="o">=</span> <span class="mi">16</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;retrying &quot;</span> <span class="o">+</span> <span class="n">response_message</span><span class="p">)</span>

        <span class="c1"># Check if we got a retry-able exception</span>
        <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">retry_exceptions</span>
                <span class="ow">or</span> <span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">in</span> <span class="n">retry_exceptions</span>
                <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">retry_errors</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">retry</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;retrying exception: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>

        <span class="c1"># Wait then retry</span>
        <span class="n">retries</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">retries</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">retry</span><span class="p">:</span>
            <span class="n">randomized_wait</span> <span class="o">=</span> <span class="n">wait</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;total wait time </span><span class="si">{total_wait:5.0f}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;... Retrying in </span><span class="si">{wait:5.1f}</span><span class="s2"> seconds...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">total_wait</span><span class="o">=</span><span class="n">total_wait</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">randomized_wait</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">total_wait</span> <span class="o">+=</span> <span class="n">randomized_wait</span>
            <span class="n">doze</span><span class="p">(</span><span class="n">randomized_wait</span><span class="p">)</span>
            <span class="n">wait</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_wait</span><span class="p">,</span> <span class="n">wait</span> <span class="o">*</span> <span class="n">back_off</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Out of retries, re-raise the exception or return the response</span>
        <span class="k">if</span> <span class="n">exc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;retries have run out. re-raising the exception&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">exc</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.retry.calculate_exponential_backoff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_exponential_backoff</span><span class="p">(</span><span class="n">retries</span><span class="p">,</span> <span class="n">base_wait</span><span class="p">,</span> <span class="n">wait_random_lower</span><span class="p">,</span> <span class="n">wait_random_upper</span><span class="p">,</span> <span class="n">back_off_factor</span><span class="p">,</span> <span class="n">max_back_off</span><span class="p">)</span></code>

<a href="#synapseclient.core.retry.calculate_exponential_backoff" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Handle calculating the exponential backoff.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>retries</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The number of retries that have been attempted</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>base_wait</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The base wait time</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wait_random_lower</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The lower bound of the random wait time</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wait_random_upper</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The upper bound of the random wait time</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>back_off_factor</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The factor to increase the wait time by for each retry</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_back_off</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum wait time</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The total wait time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/retry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_exponential_backoff</span><span class="p">(</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">base_wait</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">wait_random_lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">wait_random_upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">back_off_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_back_off</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle calculating the exponential backoff.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        retries: The number of retries that have been attempted</span>
<span class="sd">        base_wait: The base wait time</span>
<span class="sd">        wait_random_lower: The lower bound of the random wait time</span>
<span class="sd">        wait_random_upper: The upper bound of the random wait time</span>
<span class="sd">        back_off_factor: The factor to increase the wait time by for each retry</span>
<span class="sd">        max_back_off: The maximum wait time</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total wait time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_jitter</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">wait_random_lower</span><span class="p">,</span> <span class="n">wait_random_upper</span><span class="p">)</span>
    <span class="n">time_to_wait</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="p">(</span><span class="n">base_wait</span> <span class="o">*</span> <span class="p">(</span><span class="n">back_off_factor</span><span class="o">**</span><span class="n">retries</span><span class="p">))</span> <span class="o">+</span> <span class="n">random_jitter</span><span class="p">,</span>
        <span class="n">max_back_off</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">time_to_wait</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.retry.with_retry_time_based_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_retry_time_based_async</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">retry_status_codes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expected_status_codes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_base_wait</span><span class="o">=</span><span class="n">DEFAULT_BASE_WAIT_ASYNC</span><span class="p">,</span> <span class="n">retry_wait_random_lower</span><span class="o">=</span><span class="n">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span><span class="p">,</span> <span class="n">retry_wait_random_upper</span><span class="o">=</span><span class="n">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span><span class="p">,</span> <span class="n">retry_back_off_factor</span><span class="o">=</span><span class="n">DEFAULT_BACK_OFF_FACTOR_ASYNC</span><span class="p">,</span> <span class="n">retry_max_back_off</span><span class="o">=</span><span class="n">DEFAULT_MAX_BACK_OFF_ASYNC</span><span class="p">,</span> <span class="n">retry_max_wait_before_failure</span><span class="o">=</span><span class="n">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.retry.with_retry_time_based_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Retries the given function under certain conditions. This is created such that it
will retry an unbounded number of times until the maximum wait time is reached. The
backoff is calculated using an exponential backoff algorithm with a random jitter.
The maximum backoff inbetween retries is capped at <code>retry_max_back_off</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to log debug messages</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>function</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A function with no arguments. If arguments are needed, use a lambda
(see example).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Coroutine">Coroutine</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What status codes to retry upon in the case of a
SynapseHTTPError.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expected_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If specified responses with any other status codes result
in a retry.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_errors</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What reasons to retry upon, if
<code>function().response.json()['reason']</code> exists.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_exceptions</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What types of exceptions, specified as strings or Exception
classes, to retry upon.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[Exception, str]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_base_wait</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The base wait time inbetween retries.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_BASE_WAIT_ASYNC">DEFAULT_BASE_WAIT_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_wait_random_lower</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The lower bound of the random wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_WAIT_RANDOM_LOWER_ASYNC">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_wait_random_upper</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The upper bound of the random wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_WAIT_RANDOM_UPPER_ASYNC">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_back_off_factor</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The factor to increase the wait time by for each retry.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_BACK_OFF_FACTOR_ASYNC">DEFAULT_BACK_OFF_FACTOR_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_max_back_off</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_MAX_BACK_OFF_ASYNC">DEFAULT_MAX_BACK_OFF_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_max_wait_before_failure</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum wait time before failure.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Using with_retry</summary>
  <p>Using <code>with_retry_time_based_async</code> to consolidate inputs into a list.</p>
<pre><code>from synapseclient.core.retry import with_retry_time_based_async

async def foo(a, b, c): return [a, b, c]
result = await with_retry_time_based_async(lambda: foo("1", "2", "3"))
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/retry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">with_retry_time_based_async</span><span class="p">(</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">Coroutine</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">retry_status_codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">expected_status_codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_errors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_base_wait</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BASE_WAIT_ASYNC</span><span class="p">,</span>
    <span class="n">retry_wait_random_lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span><span class="p">,</span>
    <span class="n">retry_wait_random_upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span><span class="p">,</span>
    <span class="n">retry_back_off_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BACK_OFF_FACTOR_ASYNC</span><span class="p">,</span>
    <span class="n">retry_max_back_off</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_BACK_OFF_ASYNC</span><span class="p">,</span>
    <span class="n">retry_max_wait_before_failure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retries the given function under certain conditions. This is created such that it</span>
<span class="sd">    will retry an unbounded number of times until the maximum wait time is reached. The</span>
<span class="sd">    backoff is calculated using an exponential backoff algorithm with a random jitter.</span>
<span class="sd">    The maximum backoff inbetween retries is capped at `retry_max_back_off`.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        verbose: Whether to log debug messages</span>
<span class="sd">        function: A function with no arguments. If arguments are needed, use a lambda</span>
<span class="sd">            (see example).</span>
<span class="sd">        retry_status_codes: What status codes to retry upon in the case of a</span>
<span class="sd">            SynapseHTTPError.</span>
<span class="sd">        expected_status_codes: If specified responses with any other status codes result</span>
<span class="sd">            in a retry.</span>
<span class="sd">        retry_errors: What reasons to retry upon, if</span>
<span class="sd">            `function().response.json()[&#39;reason&#39;]` exists.</span>
<span class="sd">        retry_exceptions: What types of exceptions, specified as strings or Exception</span>
<span class="sd">            classes, to retry upon.</span>
<span class="sd">        retry_base_wait: The base wait time inbetween retries.</span>
<span class="sd">        retry_wait_random_lower: The lower bound of the random wait time.</span>
<span class="sd">        retry_wait_random_upper: The upper bound of the random wait time.</span>
<span class="sd">        retry_back_off_factor: The factor to increase the wait time by for each retry.</span>
<span class="sd">        retry_max_back_off: The maximum wait time.</span>
<span class="sd">        retry_max_wait_before_failure: The maximum wait time before failure.</span>

<span class="sd">    Example: Using with_retry</span>
<span class="sd">        Using ``with_retry_time_based_async`` to consolidate inputs into a list.</span>

<span class="sd">            from synapseclient.core.retry import with_retry_time_based_async</span>

<span class="sd">            async def foo(a, b, c): return [a, b, c]</span>
<span class="sd">            result = await with_retry_time_based_async(lambda: foo(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span>
        <span class="n">retry_status_codes</span><span class="p">,</span>
        <span class="n">expected_status_codes</span><span class="p">,</span>
        <span class="n">retry_errors</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">_assign_default_values</span><span class="p">(</span>
        <span class="n">retry_status_codes</span><span class="o">=</span><span class="n">retry_status_codes</span><span class="p">,</span>
        <span class="n">expected_status_codes</span><span class="o">=</span><span class="n">expected_status_codes</span><span class="p">,</span>
        <span class="n">retry_errors</span><span class="o">=</span><span class="n">retry_errors</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="o">=</span><span class="n">retry_exceptions</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Retry until we succeed or run past the maximum wait time</span>
    <span class="n">total_wait</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">retries</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">caught_exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">caught_exception_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
        <span class="n">current_span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;synapse.retries&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">function</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">caught_exception</span> <span class="o">=</span> <span class="n">ex</span>
            <span class="n">caught_exception_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">DEBUG_EXCEPTION</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">response</span>

        <span class="n">retry</span> <span class="o">=</span> <span class="n">_is_retryable</span><span class="p">(</span>
            <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
            <span class="n">caught_exception</span><span class="o">=</span><span class="n">caught_exception</span><span class="p">,</span>
            <span class="n">caught_exception_info</span><span class="o">=</span><span class="n">caught_exception_info</span><span class="p">,</span>
            <span class="n">expected_status_codes</span><span class="o">=</span><span class="n">expected_status_codes</span><span class="p">,</span>
            <span class="n">retry_status_codes</span><span class="o">=</span><span class="n">retry_status_codes</span><span class="p">,</span>
            <span class="n">retry_exceptions</span><span class="o">=</span><span class="n">retry_exceptions</span><span class="p">,</span>
            <span class="n">retry_errors</span><span class="o">=</span><span class="n">retry_errors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Wait then retry</span>
        <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">total_wait</span> <span class="o">&lt;</span> <span class="n">retry_max_wait_before_failure</span> <span class="ow">and</span> <span class="n">retry</span><span class="p">:</span>
            <span class="n">_log_for_retry</span><span class="p">(</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">caught_exception</span><span class="o">=</span><span class="n">caught_exception</span>
            <span class="p">)</span>

            <span class="n">backoff_wait</span> <span class="o">=</span> <span class="n">calculate_exponential_backoff</span><span class="p">(</span>
                <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
                <span class="n">base_wait</span><span class="o">=</span><span class="n">retry_base_wait</span><span class="p">,</span>
                <span class="n">wait_random_lower</span><span class="o">=</span><span class="n">retry_wait_random_lower</span><span class="p">,</span>
                <span class="n">wait_random_upper</span><span class="o">=</span><span class="n">retry_wait_random_upper</span><span class="p">,</span>
                <span class="n">back_off_factor</span><span class="o">=</span><span class="n">retry_back_off_factor</span><span class="p">,</span>
                <span class="n">max_back_off</span><span class="o">=</span><span class="n">retry_max_back_off</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">total_wait</span> <span class="o">+=</span> <span class="n">backoff_wait</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_wait</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Out of retries, re-raise the exception or return the response</span>
        <span class="k">if</span> <span class="n">caught_exception_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">caught_exception_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Retries have run out. re-raising the exception: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">retry</span>
                    <span class="k">else</span> <span class="s2">&quot;Raising the exception: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">caught_exception_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">caught_exception</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.retry.with_retry_time_based" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_retry_time_based</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">retry_status_codes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expected_status_codes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry_base_wait</span><span class="o">=</span><span class="n">DEFAULT_BASE_WAIT_ASYNC</span><span class="p">,</span> <span class="n">retry_wait_random_lower</span><span class="o">=</span><span class="n">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span><span class="p">,</span> <span class="n">retry_wait_random_upper</span><span class="o">=</span><span class="n">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span><span class="p">,</span> <span class="n">retry_back_off_factor</span><span class="o">=</span><span class="n">DEFAULT_BACK_OFF_FACTOR_ASYNC</span><span class="p">,</span> <span class="n">retry_max_back_off</span><span class="o">=</span><span class="n">DEFAULT_MAX_BACK_OFF_ASYNC</span><span class="p">,</span> <span class="n">retry_max_wait_before_failure</span><span class="o">=</span><span class="n">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span><span class="p">)</span></code>

<a href="#synapseclient.core.retry.with_retry_time_based" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Retries the given function under certain conditions. This is created such that it
will retry an unbounded number of times until the maximum wait time is reached. The
backoff is calculated using an exponential backoff algorithm with a random jitter.
The maximum backoff inbetween retries is capped at <code>retry_max_back_off</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to log debug messages</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>function</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A function with no arguments. If arguments are needed, use a lambda
(see example).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What status codes to retry upon in the case of a
SynapseHTTPError.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expected_status_codes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If specified responses with any other status codes result
in a retry.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[int]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_errors</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What reasons to retry upon, if
<code>function().response.json()['reason']</code> exists.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_exceptions</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>What types of exceptions, specified as strings or Exception
classes, to retry upon.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[Exception, str]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_base_wait</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The base wait time inbetween retries.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_BASE_WAIT_ASYNC">DEFAULT_BASE_WAIT_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_wait_random_lower</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The lower bound of the random wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_WAIT_RANDOM_LOWER_ASYNC">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_wait_random_upper</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The upper bound of the random wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_WAIT_RANDOM_UPPER_ASYNC">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_back_off_factor</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The factor to increase the wait time by for each retry.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_BACK_OFF_FACTOR_ASYNC">DEFAULT_BACK_OFF_FACTOR_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_max_back_off</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum wait time.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_MAX_BACK_OFF_ASYNC">DEFAULT_MAX_BACK_OFF_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>retry_max_wait_before_failure</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The maximum wait time before failure.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.retry.DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Using with_retry</summary>
  <p>Using <code>with_retry_time_based</code> to consolidate inputs into a list.</p>
<pre><code>from synapseclient.core.retry import with_retry_time_based

async def foo(a, b, c): return [a, b, c]
result = with_retry_time_based(lambda: foo("1", "2", "3"))
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/retry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_retry_time_based</span><span class="p">(</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">retry_status_codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">expected_status_codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_errors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_base_wait</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BASE_WAIT_ASYNC</span><span class="p">,</span>
    <span class="n">retry_wait_random_lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_WAIT_RANDOM_LOWER_ASYNC</span><span class="p">,</span>
    <span class="n">retry_wait_random_upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_WAIT_RANDOM_UPPER_ASYNC</span><span class="p">,</span>
    <span class="n">retry_back_off_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_BACK_OFF_FACTOR_ASYNC</span><span class="p">,</span>
    <span class="n">retry_max_back_off</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_BACK_OFF_ASYNC</span><span class="p">,</span>
    <span class="n">retry_max_wait_before_failure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_MAX_WAIT_BEFORE_FAIL_ASYNC</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retries the given function under certain conditions. This is created such that it</span>
<span class="sd">    will retry an unbounded number of times until the maximum wait time is reached. The</span>
<span class="sd">    backoff is calculated using an exponential backoff algorithm with a random jitter.</span>
<span class="sd">    The maximum backoff inbetween retries is capped at `retry_max_back_off`.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        verbose: Whether to log debug messages</span>
<span class="sd">        function: A function with no arguments. If arguments are needed, use a lambda</span>
<span class="sd">            (see example).</span>
<span class="sd">        retry_status_codes: What status codes to retry upon in the case of a</span>
<span class="sd">            SynapseHTTPError.</span>
<span class="sd">        expected_status_codes: If specified responses with any other status codes result</span>
<span class="sd">            in a retry.</span>
<span class="sd">        retry_errors: What reasons to retry upon, if</span>
<span class="sd">            `function().response.json()[&#39;reason&#39;]` exists.</span>
<span class="sd">        retry_exceptions: What types of exceptions, specified as strings or Exception</span>
<span class="sd">            classes, to retry upon.</span>
<span class="sd">        retry_base_wait: The base wait time inbetween retries.</span>
<span class="sd">        retry_wait_random_lower: The lower bound of the random wait time.</span>
<span class="sd">        retry_wait_random_upper: The upper bound of the random wait time.</span>
<span class="sd">        retry_back_off_factor: The factor to increase the wait time by for each retry.</span>
<span class="sd">        retry_max_back_off: The maximum wait time.</span>
<span class="sd">        retry_max_wait_before_failure: The maximum wait time before failure.</span>

<span class="sd">    Example: Using with_retry</span>
<span class="sd">        Using ``with_retry_time_based`` to consolidate inputs into a list.</span>

<span class="sd">            from synapseclient.core.retry import with_retry_time_based</span>

<span class="sd">            async def foo(a, b, c): return [a, b, c]</span>
<span class="sd">            result = with_retry_time_based(lambda: foo(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span>
        <span class="n">retry_status_codes</span><span class="p">,</span>
        <span class="n">expected_status_codes</span><span class="p">,</span>
        <span class="n">retry_errors</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">_assign_default_values</span><span class="p">(</span>
        <span class="n">retry_status_codes</span><span class="o">=</span><span class="n">retry_status_codes</span><span class="p">,</span>
        <span class="n">expected_status_codes</span><span class="o">=</span><span class="n">expected_status_codes</span><span class="p">,</span>
        <span class="n">retry_errors</span><span class="o">=</span><span class="n">retry_errors</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="o">=</span><span class="n">retry_exceptions</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Retry until we succeed or run past the maximum wait time</span>
    <span class="n">total_wait</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">retries</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">caught_exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">caught_exception_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
        <span class="n">current_span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;synapse.retries&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">caught_exception</span> <span class="o">=</span> <span class="n">ex</span>
            <span class="n">caught_exception_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">DEBUG_EXCEPTION</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">response</span>

        <span class="n">retry</span> <span class="o">=</span> <span class="n">_is_retryable</span><span class="p">(</span>
            <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
            <span class="n">caught_exception</span><span class="o">=</span><span class="n">caught_exception</span><span class="p">,</span>
            <span class="n">caught_exception_info</span><span class="o">=</span><span class="n">caught_exception_info</span><span class="p">,</span>
            <span class="n">expected_status_codes</span><span class="o">=</span><span class="n">expected_status_codes</span><span class="p">,</span>
            <span class="n">retry_status_codes</span><span class="o">=</span><span class="n">retry_status_codes</span><span class="p">,</span>
            <span class="n">retry_exceptions</span><span class="o">=</span><span class="n">retry_exceptions</span><span class="p">,</span>
            <span class="n">retry_errors</span><span class="o">=</span><span class="n">retry_errors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Wait then retry</span>
        <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">total_wait</span> <span class="o">&lt;</span> <span class="n">retry_max_wait_before_failure</span> <span class="ow">and</span> <span class="n">retry</span><span class="p">:</span>
            <span class="n">_log_for_retry</span><span class="p">(</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">caught_exception</span><span class="o">=</span><span class="n">caught_exception</span>
            <span class="p">)</span>

            <span class="n">backoff_wait</span> <span class="o">=</span> <span class="n">calculate_exponential_backoff</span><span class="p">(</span>
                <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
                <span class="n">base_wait</span><span class="o">=</span><span class="n">retry_base_wait</span><span class="p">,</span>
                <span class="n">wait_random_lower</span><span class="o">=</span><span class="n">retry_wait_random_lower</span><span class="p">,</span>
                <span class="n">wait_random_upper</span><span class="o">=</span><span class="n">retry_wait_random_upper</span><span class="p">,</span>
                <span class="n">back_off_factor</span><span class="o">=</span><span class="n">retry_back_off_factor</span><span class="p">,</span>
                <span class="n">max_back_off</span><span class="o">=</span><span class="n">retry_max_back_off</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">total_wait</span> <span class="o">+=</span> <span class="n">backoff_wait</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_wait</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Out of retries, re-raise the exception or return the response</span>
        <span class="k">if</span> <span class="n">caught_exception_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">caught_exception_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Retries have run out. re-raising the exception: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">retry</span>
                    <span class="k">else</span> <span class="s2">&quot;Raising the exception: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">caught_exception_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">caught_exception</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="utils">Utils<a class="headerlink" href="#utils" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.utils" class="doc doc-heading">
            <code>synapseclient.core.utils</code>


<a href="#synapseclient.core.utils" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>Utility functions useful in the implementation and testing of the Synapse client.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.utils-classes">Classes<a href="#synapseclient.core.utils-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.utils.threadsafe_iter" class="doc doc-heading">
            <code>threadsafe_iter</code>


<a href="#synapseclient.core.utils.threadsafe_iter" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Takes an iterator/generator and makes it thread-safe by serializing call to the
<code>next</code> method of given iterator/generator.
See: <a href="http://anandology.com/blog/using-iterators-and-generators/">http://anandology.com/blog/using-iterators-and-generators/</a></p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">threadsafe_iter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes an iterator/generator and makes it thread-safe by serializing call to the</span>
<span class="sd">    `next` method of given iterator/generator.</span>
<span class="sd">    See: &lt;http://anandology.com/blog/using-iterators-and-generators/&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">it</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">it</span> <span class="o">=</span> <span class="n">it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.utils.deprecated_keyword_param" class="doc doc-heading">
            <code>deprecated_keyword_param</code>


<a href="#synapseclient.core.utils.deprecated_keyword_param" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>A decorator to use to warn when a keyword parameter from a function has been deprecated
and is intended for future removal. Will emit a warning such a keyword is passed.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">deprecated_keyword_param</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator to use to warn when a keyword parameter from a function has been deprecated</span>
<span class="sd">    and is intended for future removal. Will emit a warning such a keyword is passed.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Parameter(s) </span><span class="si">{}</span><span class="s2"> deprecated since version </span><span class="si">{}</span><span class="s2">; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">found</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason</span>
                    <span class="p">),</span>
                    <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.utils-functions">Functions<a href="#synapseclient.core.utils-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.md5_for_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">md5_for_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.md5_for_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Calculates the MD5 of the given file.
See source <a href="http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python">http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python</a>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file to read in</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>block_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How much of the file to read in at once (bytes).
        Defaults to 2 MB</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>2 * <span title="synapseclient.core.utils.MB">MB</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>callback</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The callback function that help us show loading spinner on terminal.
        Defaults to None</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The MD5 Checksum</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">md5_for_file</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the MD5 of the given file.</span>
<span class="sd">    See source &lt;http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python&gt;.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        filename: The file to read in</span>
<span class="sd">        block_size: How much of the file to read in at once (bytes).</span>
<span class="sd">                    Defaults to 2 MB</span>
<span class="sd">        callback: The callback function that help us show loading spinner on terminal.</span>
<span class="sd">                    Defaults to None</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MD5 Checksum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loop_iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="n">usedforsecurity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># nosec</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">loop_iteration</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">block_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">data</span>
            <span class="c1"># Garbage collect every 100 iterations</span>
            <span class="k">if</span> <span class="n">loop_iteration</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">md5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.md5_for_file_hex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">md5_for_file_hex</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.md5_for_file_hex" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Calculates the MD5 of the given file.
See source <a href="http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python">http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python</a>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file to read in</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>block_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How much of the file to read in at once (bytes).
        Defaults to 2 MB</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>2 * <span title="synapseclient.core.utils.MB">MB</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>callback</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The callback function that help us show loading spinner on terminal.
        Defaults to None</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Callable">Callable</span></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The MD5 Checksum</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">md5_for_file_hex</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the MD5 of the given file.</span>
<span class="sd">    See source &lt;http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python&gt;.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        filename: The file to read in</span>
<span class="sd">        block_size: How much of the file to read in at once (bytes).</span>
<span class="sd">                    Defaults to 2 MB</span>
<span class="sd">        callback: The callback function that help us show loading spinner on terminal.</span>
<span class="sd">                    Defaults to None</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MD5 Checksum</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">md5_for_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.md5_for_file_multiprocessing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">md5_for_file_multiprocessing</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">process_pool_executor</span><span class="p">,</span> <span class="n">md5_semaphore</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.utils.md5_for_file_multiprocessing" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Calculates the MD5 of the given file.
See source <a href="http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python">http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python</a>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The file to read in</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>process_pool_executor</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The process pool executor to use for the calculation.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>md5_semaphore</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The semaphore to use for waiting to calculate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="asyncio.Semaphore">Semaphore</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>block_size</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How much of the file to read in at once (bytes).
        Defaults to 2 MB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>2 * <span title="synapseclient.core.utils.MB">MB</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The MD5 Checksum</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">md5_for_file_multiprocessing</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">process_pool_executor</span><span class="p">,</span>
    <span class="n">md5_semaphore</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">,</span>
    <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">MB</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the MD5 of the given file.</span>
<span class="sd">    See source &lt;http://stackoverflow.com/questions/1131220/get-md5-hash-of-a-files-without-open-it-in-python&gt;.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        filename: The file to read in</span>
<span class="sd">        process_pool_executor: The process pool executor to use for the calculation.</span>
<span class="sd">        md5_semaphore: The semaphore to use for waiting to calculate.</span>
<span class="sd">        block_size: How much of the file to read in at once (bytes).</span>
<span class="sd">                    Defaults to 2 MB.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MD5 Checksum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">md5_semaphore</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;Utils::md5_for_file_multiprocessing&quot;</span><span class="p">):</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">process_pool_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="n">md5_for_file_hex</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">block_size</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.md5_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">md5_fn</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.md5_fn" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Calculate the MD5 of a file-like object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>part</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A file-like object to read from.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The MD5 Checksum</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">&quot;Utils::md5_fn&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">md5_fn</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the MD5 of a file-like object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        part: A file-like object to read from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MD5 Checksum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="n">usedforsecurity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># nosec</span>
    <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.download_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">localFilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.download_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Downloads a remote file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>localFilePath</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>May be None, in which case a temporary file is created</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>localFilePath</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The path to the downloaded file</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">localFilepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads a remote file.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        localFilePath: May be None, in which case a temporary file is created</span>

<span class="sd">    Returns:</span>
<span class="sd">        localFilePath: The path to the downloaded file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">localFilepath</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">localFilepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">localFilepath</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">toBeTransferred</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;content-length&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">nChunks</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">printTransferProgress</span><span class="p">(</span><span class="n">nChunks</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">toBeTransferred</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">printTransferProgress</span><span class="p">(</span><span class="n">toBeTransferred</span><span class="p">,</span> <span class="n">toBeTransferred</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">localFilepath</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.extract_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_filename</span><span class="p">(</span><span class="n">content_disposition_header</span><span class="p">,</span> <span class="n">default_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.extract_filename" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Extract a filename from an HTTP content-disposition header field.</p>
<p>See <a href="http://tools.ietf.org/html/rfc6266">this memo</a> and
<a href="http://pypi.python.org/pypi/rfc6266">this package</a>
for cryptic details.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_filename</span><span class="p">(</span><span class="n">content_disposition_header</span><span class="p">,</span> <span class="n">default_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract a filename from an HTTP content-disposition header field.</span>

<span class="sd">    See [this memo](http://tools.ietf.org/html/rfc6266) and</span>
<span class="sd">    [this package](http://pypi.python.org/pypi/rfc6266)</span>
<span class="sd">    for cryptic details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_disposition_header</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default_filename</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="n">content_disposition_header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.extract_user_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_user_name</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.extract_user_name" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Extract a displayable user name from a user's profile</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_user_name</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract a displayable user name from a user&#39;s profile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;userName&quot;</span> <span class="ow">in</span> <span class="n">profile</span> <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;userName&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;userName&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s2">&quot;displayName&quot;</span> <span class="ow">in</span> <span class="n">profile</span> <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;displayName&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;displayName&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;firstName&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
            <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;firstName&quot;</span><span class="p">]</span>
            <span class="ow">and</span> <span class="s2">&quot;lastName&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
            <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;lastName&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;firstName&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;lastName&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;lastName&quot;</span> <span class="ow">in</span> <span class="n">profile</span> <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;lastName&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;lastName&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;firstName&quot;</span> <span class="ow">in</span> <span class="n">profile</span> <span class="ow">and</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;firstName&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;firstName&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown-user&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.id_of" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">id_of</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.id_of" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Try to figure out the Synapse ID of the given object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obj</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>May be a string, Entity object, or dictionary</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[str, <span title="collections.abc.Mapping">Mapping</span>, <span title="numbers.Number">Number</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ValueError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>if the object doesn't have an ID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">id_of</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to figure out the Synapse ID of the given object.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        obj: May be a string, Entity object, or dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the object doesn&#39;t have an ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">id_attr_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ownerId&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tableId&quot;</span><span class="p">,</span>
    <span class="p">]</span>  <span class="c1"># possible attribute names for a synapse Id</span>
    <span class="k">for</span> <span class="n">attribute_name</span> <span class="ow">in</span> <span class="n">id_attr_names</span><span class="p">:</span>
        <span class="n">syn_id</span> <span class="o">=</span> <span class="n">_get_from_members_items_or_properties</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syn_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">syn_id</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid parameters: couldn&#39;t find id of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.concrete_type_of" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">concrete_type_of</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.concrete_type_of" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Return the concrete type of an object representing a Synapse entity.
This is meant to operate either against an actual Entity object, or the lighter
weight dictionary returned by Synapse#getChildren, both of which are Mappings.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">concrete_type_of</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the concrete type of an object representing a Synapse entity.</span>
<span class="sd">    This is meant to operate either against an actual Entity object, or the lighter</span>
<span class="sd">    weight dictionary returned by Synapse#getChildren, both of which are Mappings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">concrete_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;concreteType&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">):</span>
            <span class="n">concrete_type</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">concrete_type</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">concrete_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">concrete_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
        <span class="s2">&quot;org.sagebionetworks.repo.model&quot;</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to determine concreteType&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">concrete_type</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_in_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_in_path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_in_path" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Determines whether id is in the path as returned from /entity/{id}/path</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>synapse id string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>object as returned from '/entity/{id}/path'</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="collections.abc.Mapping">Mapping</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True or False</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_in_path</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines whether id is in the path as returned from /entity/{id}/path</span>

<span class="sd">    Arguments:</span>
<span class="sd">        id: synapse id string</span>
<span class="sd">        path: object as returned from &#39;/entity/{id}/path&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">id</span> <span class="ow">in</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.get_properties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_properties</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.get_properties" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns the dictionary of properties of the given Entity.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="n">entity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the dictionary of properties of the given Entity.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">entity</span><span class="o">.</span><span class="n">properties</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">entity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_url</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_url" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Return True if the string appears to be a valid URL.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_url</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the string appears to be a valid URL.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url_parts</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="c1"># looks like a Windows drive letter?</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.as_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">as_url</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.as_url" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Tries to convert the input into a proper URL.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_url</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tries to convert the input into a proper URL.&quot;&quot;&quot;</span>
    <span class="n">url_parts</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># Windows drive letter?</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;file:///</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;file://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.guess_file_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">guess_file_name</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.guess_file_name" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Tries to derive a filename from an arbitrary string.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">guess_file_name</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tries to derive a filename from an arbitrary string.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tokens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Try scrubbing the path of illegal characters</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_.+() -]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not derive a name from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.normalize_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.normalize_path" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Transforms a path into an absolute path with forward slashes only.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a path into an absolute path with forward slashes only.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.equal_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">equal_paths</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.equal_paths" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Compare file paths in a platform neutral way</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equal_paths</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare file paths in a platform neutral way</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span> <span class="o">==</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">path2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.file_url_to_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_url_to_path</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.file_url_to_path" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert a file URL to a path, handling some odd cases around Windows paths.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a file URL</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verify_exists</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If true, return an populated dict only if the resulting file
            path exists on the local file system.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[str, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a path or None if the URL is not a file URL.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">file_url_to_path</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify_exists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a file URL to a path, handling some odd cases around Windows paths.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        url: a file URL</span>
<span class="sd">        verify_exists: If true, return an populated dict only if the resulting file</span>
<span class="sd">                        path exists on the local file system.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a path or None if the URL is not a file URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parts</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">or</span> <span class="n">parts</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">path</span>
        <span class="c1"># A windows file URL, for example file:///c:/WINDOWS/asdf.txt</span>
        <span class="c1"># will get back a path of: /c:/WINDOWS/asdf.txt, which we need to fix by</span>
        <span class="c1"># lopping off the leading slash character. Apparently, the Python developers</span>
        <span class="c1"># think this is not a bug: http://bugs.python.org/issue7965</span>
        <span class="k">if</span> <span class="n">SLASH_PREFIX_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">verify_exists</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_same_base_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_same_base_url</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">url2</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_same_base_url" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Compares two urls to see if they are the same excluding up to the base path</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url1</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a URL</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>url2</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a second URL</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A Boolean</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_same_base_url</span><span class="p">(</span><span class="n">url1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares two urls to see if they are the same excluding up to the base path</span>

<span class="sd">    Arguments:</span>
<span class="sd">        url1: a URL</span>
<span class="sd">        url2: a second URL</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url1</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url1</span><span class="p">)</span>
    <span class="n">url2</span> <span class="o">=</span> <span class="n">urllib_parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">url1</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="n">url2</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">and</span> <span class="n">url1</span><span class="o">.</span><span class="n">hostname</span> <span class="o">==</span> <span class="n">url2</span><span class="o">.</span><span class="n">hostname</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_synapse_id_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_synapse_id_str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_synapse_id_str" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>If the input is a Synapse ID return it, otherwise return None</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_synapse_id_str</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the input is a Synapse ID return it, otherwise return None&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(syn\d+(\.\d+)?$)&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.get_synid_and_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_synid_and_version</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.get_synid_and_version" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Extract the Synapse ID and version number from input entity</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obj</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>May be a string, Entity object, or dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[str, <span title="collections.abc.Mapping">Mapping</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[str, <span title="typing.Union">Union</span>[int, None]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A tuple containing the synapse ID and version number,
where the version number may be an integer or None if
the input object does not contain a versonNumber or
.version notation (if string).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Get synID and version from string object</summary>
  <p>Extract the synID and version number of the entity string ID</p>
<pre><code>from synapseclient.core import utils
utils.get_synid_and_version("syn123.4")
</code></pre>
<p>The call above will return the following tuple:</p>
<pre><code>('syn123', 4)
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_synid_and_version</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the Synapse ID and version number from input entity</span>

<span class="sd">    Arguments:</span>
<span class="sd">            obj: May be a string, Entity object, or dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing the synapse ID and version number,</span>
<span class="sd">            where the version number may be an integer or None if</span>
<span class="sd">            the input object does not contain a versonNumber or</span>
<span class="sd">            .version notation (if string).</span>

<span class="sd">    Example: Get synID and version from string object</span>
<span class="sd">        Extract the synID and version number of the entity string ID</span>

<span class="sd">            from synapseclient.core import utils</span>
<span class="sd">            utils.get_synid_and_version(&quot;syn123.4&quot;)</span>

<span class="sd">        The call above will return the following tuple:</span>

<span class="sd">            (&#39;syn123&#39;, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">synapse_id_and_version</span> <span class="o">=</span> <span class="n">is_synapse_id_str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">synapse_id_and_version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input string was not determined to be a syn ID.&quot;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(syn\d+)(?:\.(\d+))?&quot;</span><span class="p">,</span> <span class="n">synapse_id_and_version</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">id</span><span class="p">,</span> <span class="n">version</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">id_of</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;versionNumber&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;versionNumber&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">id</span><span class="p">,</span> <span class="n">version</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.bool_or_none" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bool_or_none</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.bool_or_none" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Attempts to convert a string to a bool. Returns None if it fails.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_value</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The string to convert to a bool</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[bool, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The bool or None if the conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bool_or_none</span><span class="p">(</span><span class="n">input_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts to convert a string to a bool. Returns None if it fails.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        input_value: The string to convert to a bool</span>

<span class="sd">    Returns:</span>
<span class="sd">        The bool or None if the conversion fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">input_value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">input_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">input_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">return_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.datetime_or_none" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">datetime_or_none</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.datetime_or_none" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Attempts to convert a string to a datetime object. Returns None if it fails.</p>
<p>Some of the expected formats of datetime_str are:</p>
<ul>
<li>2023-12-04T07:00:00Z</li>
<li>2001-01-01 15:00:00+07:00</li>
<li>2001-01-01 15:00:00-07:00</li>
<li>2023-12-04 07:00:00+00:00</li>
<li>2019-01-01</li>
</ul>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>datetime_str</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The string to convert to a datetime object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[<span title="datetime.datetime">datetime</span>, None]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The datetime object or None if the conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">datetime_or_none</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attempts to convert a string to a datetime object. Returns None if it fails.</span>

<span class="sd">    Some of the expected formats of datetime_str are:</span>

<span class="sd">    - 2023-12-04T07:00:00Z</span>
<span class="sd">    - 2001-01-01 15:00:00+07:00</span>
<span class="sd">    - 2001-01-01 15:00:00-07:00</span>
<span class="sd">    - 2023-12-04 07:00:00+00:00</span>
<span class="sd">    - 2019-01-01</span>

<span class="sd">    Arguments:</span>
<span class="sd">        datetime_str: The string to convert to a datetime object</span>

<span class="sd">    Returns:</span>
<span class="sd">        The datetime object or None if the conversion fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">datetime_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_date</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_date" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Objects of class datetime.date and datetime.datetime will be recognized as dates</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_date</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Objects of class datetime.date and datetime.datetime will be recognized as dates&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.to_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.to_list" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert the value (an iterable or a scalar value) to a list.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the value (an iterable or a scalar value) to a list.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">possible_datetime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">possible_datetime</span> <span class="o">=</span> <span class="n">datetime_or_none</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span> <span class="k">if</span> <span class="n">possible_datetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">possible_datetime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">possible_datetime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">possible_datetime</span> <span class="o">=</span> <span class="n">datetime_or_none</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="k">if</span> <span class="n">possible_datetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">possible_datetime</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.make_bogus_uuid_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_bogus_uuid_file</span><span class="p">()</span></code>

<a href="#synapseclient.core.utils.make_bogus_uuid_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Makes a bogus test file with a uuid4 string for testing. It is the caller's
responsibility to clean up the file when finished.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The name of the file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_bogus_uuid_file</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a bogus test file with a uuid4 string for testing. It is the caller&#39;s</span>
<span class="sd">    responsibility to clean up the file when finished.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.make_bogus_data_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_bogus_data_file</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.make_bogus_data_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Makes a bogus data file for testing. It is the caller's responsibility
to clean up the file when finished.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How many random floating point numbers to be written into the file,
separated by commas</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>100</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random seed for the random numbers</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The name of the file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_bogus_data_file</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a bogus data file for testing. It is the caller&#39;s responsibility</span>
<span class="sd">    to clean up the file when finished.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n: How many random floating point numbers to be written into the file,</span>
<span class="sd">            separated by commas</span>
<span class="sd">        seed: Random seed for the random numbers</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.make_bogus_binary_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_bogus_binary_file</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">KB</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printprogress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.make_bogus_binary_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Makes a bogus binary data file for testing. It is the caller's responsibility
to clean up the file when finished.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>How many bytes to write</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1 * <span title="synapseclient.core.utils.KB">KB</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filepath</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Where to write the data</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>printprogress</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Toggle printing of progress</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The name of the file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_bogus_binary_file</span><span class="p">(</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">KB</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">printprogress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a bogus binary data file for testing. It is the caller&#39;s responsibility</span>
<span class="sd">    to clean up the file when finished.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n: How many bytes to write</span>
<span class="sd">        filepath: Where to write the data</span>
<span class="sd">        printprogress: Toggle printing of progress</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filepath</span>
        <span class="k">else</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">while</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">buff_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">KB</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">buff_size</span><span class="p">))</span>
            <span class="n">remaining</span> <span class="o">-=</span> <span class="n">buff_size</span>
            <span class="k">if</span> <span class="n">printprogress</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="n">buff_size</span>
                <span class="n">printTransferProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;Generated &quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.to_unix_epoch_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_unix_epoch_time</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.to_unix_epoch_time" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert either <a href="http://docs.python.org/2/library/datetime.html">datetime.date or datetime.datetime objects</a> to UNIX time.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_unix_epoch_time</span><span class="p">(</span><span class="n">dt</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert either [datetime.date or datetime.datetime objects](http://docs.python.org/2/library/datetime.html) to UNIX time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
        <span class="n">current_timezone</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">tzinfo</span>
        <span class="n">datetime_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">current_timezone</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the datetime is not timezone aware, assume it is in the local timezone.</span>
        <span class="c1"># This is required in order for windows to work with the `astimezone` method.</span>
        <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_timezone</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">tzinfo</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">current_timezone</span><span class="p">)</span>
        <span class="n">datetime_utc</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">datetime_utc</span> <span class="o">-</span> <span class="n">UNIX_EPOCH</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.to_unix_epoch_time_secs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_unix_epoch_time_secs</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.to_unix_epoch_time_secs" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert either <a href="http://docs.python.org/2/library/datetime.html">datetime.date or datetime.datetime objects</a> to UNIX time.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_unix_epoch_time_secs</span><span class="p">(</span>
    <span class="n">dt</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert either [datetime.date or datetime.datetime objects](http://docs.python.org/2/library/datetime.html) to UNIX time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
        <span class="n">current_timezone</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">tzinfo</span>
        <span class="n">datetime_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">current_timezone</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the datetime is not timezone aware, assume it is in the local timezone.</span>
        <span class="c1"># This is required in order for windows to work with the `astimezone` method.</span>
        <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_timezone</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">tzinfo</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">current_timezone</span><span class="p">)</span>
        <span class="n">datetime_utc</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">datetime_utc</span> <span class="o">-</span> <span class="n">UNIX_EPOCH</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.from_unix_epoch_time_secs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_unix_epoch_time_secs</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.from_unix_epoch_time_secs" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns a Datetime object given milliseconds since midnight Jan 1, 1970.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_unix_epoch_time_secs</span><span class="p">(</span><span class="n">secs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Datetime object given milliseconds since midnight Jan 1, 1970.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">secs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span>

    <span class="c1"># utcfromtimestamp() fails for negative values (dates before 1970-1-1) on Windows</span>
    <span class="c1"># so, here&#39;s a hack that enables ancient events, such as Chris&#39;s birthday to be</span>
    <span class="c1"># converted from milliseconds since the UNIX epoch to higher level Datetime objects. Ha!</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span> <span class="ow">and</span> <span class="n">secs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mirror_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">secs</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">UNIX_EPOCH</span> <span class="o">-</span> <span class="p">(</span><span class="n">mirror_date</span> <span class="o">-</span> <span class="n">UNIX_EPOCH</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="n">datetime_instance</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">datetime_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.from_unix_epoch_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_unix_epoch_time</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.from_unix_epoch_time" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns a Datetime object given milliseconds since midnight Jan 1, 1970.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_unix_epoch_time</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Datetime object given milliseconds since midnight Jan 1, 1970.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">from_unix_epoch_time_secs</span><span class="p">(</span><span class="n">ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.datetime_to_iso" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">datetime_to_iso</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">include_milliseconds_if_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.datetime_to_iso" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Round microseconds to milliseconds (as expected by older clients) and add back
the "Z" at the end.
See: http://stackoverflow.com/questions/30266188/how-to-convert-date-string-to-iso8601-standard</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The datetime to convert</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="datetime.datetime">datetime</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sep</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Seperator character to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;T&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>include_milliseconds_if_zero</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether or not to include millseconds in this result
                            if the number of millseconds is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The formatted string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">datetime_to_iso</span><span class="p">(</span>
    <span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">include_milliseconds_if_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round microseconds to milliseconds (as expected by older clients) and add back</span>
<span class="sd">    the &quot;Z&quot; at the end.</span>
<span class="sd">    See: http://stackoverflow.com/questions/30266188/how-to-convert-date-string-to-iso8601-standard</span>

<span class="sd">    Arguments:</span>
<span class="sd">        dt: The datetime to convert</span>
<span class="sd">        sep: Seperator character to use.</span>
<span class="sd">        include_milliseconds_if_zero: Whether or not to include millseconds in this result</span>
<span class="sd">                                        if the number of millseconds is 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{time.year:04}</span><span class="s2">-</span><span class="si">{time.month:02}</span><span class="s2">-</span><span class="si">{time.day:02}</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="si">{sep}{time.hour:02}</span><span class="s2">:</span><span class="si">{time.minute:02}</span><span class="s2">:</span><span class="si">{time.second:02}</span><span class="s2">.</span><span class="si">{millisecond:03}{tz}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">fmt_no_mills</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{time.year:04}</span><span class="s2">-</span><span class="si">{time.month:02}</span><span class="s2">-</span><span class="si">{time.day:02}</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="si">{sep}{time.hour:02}</span><span class="s2">:</span><span class="si">{time.minute:02}</span><span class="s2">:</span><span class="si">{time.second:02}{tz}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">&gt;=</span> <span class="mi">999500</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">-=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">+=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rounded_microseconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">include_milliseconds_if_zero</span> <span class="ow">or</span> <span class="n">rounded_microseconds</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">millisecond</span><span class="o">=</span><span class="n">rounded_microseconds</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fmt_no_mills</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">time</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">millisecond</span><span class="o">=</span><span class="n">rounded_microseconds</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.format_time_interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_time_interval</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.format_time_interval" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Format a time interval given in seconds to a readable value,
e.g. "5 minutes, 37 seconds".</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_time_interval</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format a time interval given in seconds to a readable value,</span>
<span class="sd">    e.g. \&quot;5 minutes, 37 seconds\&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">periods</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;minute&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">period_name</span><span class="p">,</span> <span class="n">period_seconds</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="o">&gt;</span> <span class="n">period_seconds</span> <span class="ow">or</span> <span class="n">period_name</span> <span class="o">==</span> <span class="s2">&quot;second&quot;</span><span class="p">:</span>
            <span class="n">period_value</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">period_seconds</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">period_value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">period_name</span> <span class="o">==</span> <span class="s2">&quot;second&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">period_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">period_value</span><span class="p">,</span> <span class="n">period_name</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">period_value</span><span class="p">,</span> <span class="n">period_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.itersubclasses" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">itersubclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_seen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.itersubclasses" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p><a href="http://code.activestate.com/recipes/576949/">http://code.activestate.com/recipes/576949/</a> (r3)</p>
<p>itersubclasses(cls)</p>
<p>Generator over all subclasses of a given class, in depth first order.</p>
<pre><code>&gt;&gt;&gt; list(itersubclasses(int)) == [bool]
True
&gt;&gt;&gt; class A(object): pass
&gt;&gt;&gt; class B(A): pass
&gt;&gt;&gt; class C(A): pass
&gt;&gt;&gt; class D(B,C): pass
&gt;&gt;&gt; class E(D): pass
&gt;&gt;&gt;
&gt;&gt;&gt; for cls in itersubclasses(A):
...     print(cls.__name__)
B
D
E
C
&gt;&gt;&gt; # get ALL (new-style) classes currently defined
&gt;&gt;&gt; [cls.__name__ for cls in itersubclasses(object)] #doctest: +ELLIPSIS
['type', ...'tuple', ...]
</code></pre>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">itersubclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_seen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &lt;http://code.activestate.com/recipes/576949/&gt; (r3)</span>

<span class="sd">    itersubclasses(cls)</span>

<span class="sd">    Generator over all subclasses of a given class, in depth first order.</span>

<span class="sd">        &gt;&gt;&gt; list(itersubclasses(int)) == [bool]</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; class A(object): pass</span>
<span class="sd">        &gt;&gt;&gt; class B(A): pass</span>
<span class="sd">        &gt;&gt;&gt; class C(A): pass</span>
<span class="sd">        &gt;&gt;&gt; class D(B,C): pass</span>
<span class="sd">        &gt;&gt;&gt; class E(D): pass</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; for cls in itersubclasses(A):</span>
<span class="sd">        ...     print(cls.__name__)</span>
<span class="sd">        B</span>
<span class="sd">        D</span>
<span class="sd">        E</span>
<span class="sd">        C</span>
<span class="sd">        &gt;&gt;&gt; # get ALL (new-style) classes currently defined</span>
<span class="sd">        &gt;&gt;&gt; [cls.__name__ for cls in itersubclasses(object)] #doctest: +ELLIPSIS</span>
<span class="sd">        [&#39;type&#39;, ...&#39;tuple&#39;, ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;itersubclasses must be called with &quot;</span> <span class="s2">&quot;new-style classes, not </span><span class="si">%.100r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">cls</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">_seen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># fails only when cls is type</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sub</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_seen</span><span class="p">:</span>
            <span class="n">_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">sub</span>
            <span class="k">for</span> <span class="n">inner_sub</span> <span class="ow">in</span> <span class="n">itersubclasses</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">_seen</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">inner_sub</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.normalize_whitespace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_whitespace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.normalize_whitespace" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Strips the string and replace all whitespace sequences and other
non-printable characters with a single space.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_whitespace</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Strips the string and replace all whitespace sequences and other</span>
<span class="sd">    non-printable characters with a single space.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\x00-\x20\s]+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.query_limit_and_offset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_limit_and_offset</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">hard_limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.query_limit_and_offset" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Extract limit and offset from the end of a query string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A tuple containing the query with limit and offset removed,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>int</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the limit at most equal to the hard_limit,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>int</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>and the offset which defaults to 1</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">query_limit_and_offset</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hard_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract limit and offset from the end of a query string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing the query with limit and offset removed,</span>
<span class="sd">        the limit at most equal to the hard_limit,</span>
<span class="sd">        and the offset which defaults to 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Regex a lower-case string to simplify matching</span>
    <span class="n">tempQueryStr</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\A(.*\s)(offset|limit)\s*(\d*\s*)\Z&quot;</span>

    <span class="c1"># Continue to strip off and save the last limit/offset</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">tempQueryStr</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">while</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">tempQueryStr</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">tempQueryStr</span><span class="p">)</span>

    <span class="c1"># Get a truncated version of the original query string (not in lower-case)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempQueryStr</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Continue querying until the entire query has been fetched (or crash out)</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="n">hard_limit</span><span class="p">),</span> <span class="n">hard_limit</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.extract_synapse_id_from_query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_synapse_id_from_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.extract_synapse_id_from_query" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>An unfortunate hack to pull the synapse ID out of a table query of the form
"select column1, column2 from syn12345 where...."
needed to build URLs for table services.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_synapse_id_from_query</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An unfortunate hack to pull the synapse ID out of a table query of the form</span>
<span class="sd">    &quot;select column1, column2 from syn12345 where....&quot;</span>
<span class="sd">    needed to build URLs for table services.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;from\s+(syn\d+)&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Couldn</span><span class="se">\&#39;</span><span class="s1">t extract synapse ID from query: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.printTransferProgress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printTransferProgress</span><span class="p">(</span><span class="n">transferred</span><span class="p">,</span> <span class="n">toBeTransferred</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">isBytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previouslyTransferred</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.printTransferProgress" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Prints a progress bar</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>transferred</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a number of items/bytes completed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>toBeTransferred</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>total number of items/bytes when completed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>prefix</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String printed before progress bar</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>postfix</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String printed after progress bar</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>isBytes</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A boolean indicating whether to convert bytes to kB, MB, GB etc.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dt</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The time in seconds that has passed since transfer started is used to calculate rate</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>previouslyTransferred</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the number of bytes that were already transferred before this
                    transfer began (e.g. someone ctrl+c'd out of an upload and
                    restarted it later)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">printTransferProgress</span><span class="p">(</span>
    <span class="n">transferred</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">toBeTransferred</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">postfix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">isBytes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">previouslyTransferred</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prints a progress bar</span>

<span class="sd">    Arguments:</span>
<span class="sd">        transferred: a number of items/bytes completed</span>
<span class="sd">        toBeTransferred: total number of items/bytes when completed</span>
<span class="sd">        prefix: String printed before progress bar</span>
<span class="sd">        postfix: String printed after progress bar</span>
<span class="sd">        isBytes: A boolean indicating whether to convert bytes to kB, MB, GB etc.</span>
<span class="sd">        dt: The time in seconds that has passed since transfer started is used to calculate rate</span>
<span class="sd">        previouslyTransferred: the number of bytes that were already transferred before this</span>
<span class="sd">                                transfer began (e.g. someone ctrl+c&#39;d out of an upload and</span>
<span class="sd">                                restarted it later)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="n">barLength</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Modify this to change the length of the progress bar</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">transferred</span> <span class="o">-</span> <span class="n">previouslyTransferred</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">/s)&quot;</span> <span class="o">%</span> <span class="n">humanizeBytes</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="k">if</span> <span class="n">isBytes</span> <span class="k">else</span> <span class="n">rate</span>
    <span class="k">if</span> <span class="n">toBeTransferred</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">defaultToBeTransferred</span> <span class="o">=</span> <span class="n">barLength</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">MB</span>
        <span class="k">if</span> <span class="n">transferred</span> <span class="o">&gt;</span> <span class="n">defaultToBeTransferred</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">transferred</span> <span class="o">%</span> <span class="n">defaultToBeTransferred</span><span class="p">)</span> <span class="o">/</span> <span class="n">defaultToBeTransferred</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transferred</span><span class="p">)</span> <span class="o">/</span> <span class="n">defaultToBeTransferred</span>
    <span class="k">elif</span> <span class="n">toBeTransferred</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># There is nothing to be transferred</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Done...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transferred</span><span class="p">)</span> <span class="o">/</span> <span class="n">toBeTransferred</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Done...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">block</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">barLength</span> <span class="o">*</span> <span class="n">progress</span><span class="p">))</span>
    <span class="n">nbytes</span> <span class="o">=</span> <span class="n">humanizeBytes</span><span class="p">(</span><span class="n">transferred</span><span class="p">)</span> <span class="k">if</span> <span class="n">isBytes</span> <span class="k">else</span> <span class="n">transferred</span>
    <span class="k">if</span> <span class="n">toBeTransferred</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">outOf</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">humanizeBytes</span><span class="p">(</span><span class="n">toBeTransferred</span><span class="p">)</span> <span class="k">if</span> <span class="n">isBytes</span> <span class="k">else</span> <span class="n">toBeTransferred</span><span class="p">)</span>
        <span class="n">percentage</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%4.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outOf</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">percentage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]</span><span class="si">%s</span><span class="s2">   </span><span class="si">%s%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">    </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">prefix</span><span class="p">,</span>
        <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="n">block</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">barLength</span> <span class="o">-</span> <span class="n">block</span><span class="p">),</span>
        <span class="n">percentage</span><span class="p">,</span>
        <span class="n">nbytes</span><span class="p">,</span>
        <span class="n">outOf</span><span class="p">,</span>
        <span class="n">rate</span><span class="p">,</span>
        <span class="n">postfix</span><span class="p">,</span>
        <span class="n">status</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.touch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">touch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.touch" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Make sure a file exists. Update its access and modified times.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make sure a file exists. Update its access and modified times.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basedir</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">basedir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># alternate processes might be creating these at the same time</span>
            <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_json</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_json" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>detect if a content-type is JSON</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_json</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;detect if a content-type is JSON&quot;&quot;&quot;</span>
    <span class="c1"># The value of Content-Type defined here:</span>
    <span class="c1"># http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.7</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">content_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content_type</span>
        <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.find_data_file_handle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_data_file_handle</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.find_data_file_handle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Return the fileHandle whose ID matches the dataFileHandleId in an entity bundle</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_data_file_handle</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the fileHandle whose ID matches the dataFileHandleId in an entity bundle&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fileHandle</span> <span class="ow">in</span> <span class="n">bundle</span><span class="p">[</span><span class="s2">&quot;fileHandles&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">fileHandle</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bundle</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">][</span><span class="s2">&quot;dataFileHandleId&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">fileHandle</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.unique_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unique_filename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.unique_filename" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns a unique path by appending (n) for some number n to the end of the filename.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unique_filename</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a unique path by appending (n) for some number n to the end of the filename.&quot;&quot;&quot;</span>

    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;(</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.threadsafe_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">threadsafe_generator</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.threadsafe_generator" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>A decorator that takes a generator function and makes it thread-safe.
See: <a href="http://anandology.com/blog/using-iterators-and-generators/">http://anandology.com/blog/using-iterators-and-generators/</a></p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">threadsafe_generator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that takes a generator function and makes it thread-safe.</span>
<span class="sd">    See: &lt;http://anandology.com/blog/using-iterators-and-generators/&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">threadsafe_iter</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">g</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.extract_prefix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_prefix</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.extract_prefix" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Takes a list of strings and extracts a common prefix delimited by a dot,
for example::</p>
<pre><code>extract_prefix(["entity.bang", "entity.bar", "entity.bat"])
# returns "entity"
</code></pre>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_prefix</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list of strings and extracts a common prefix delimited by a dot,</span>
<span class="sd">    for example::</span>

<span class="sd">        extract_prefix([&quot;entity.bang&quot;, &quot;entity.bar&quot;, &quot;entity.bat&quot;])</span>
<span class="sd">        # returns &quot;entity&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefixes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prefixes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prefixes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.extract_zip_file_to_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_zip_file_to_directory</span><span class="p">(</span><span class="n">zip_file</span><span class="p">,</span> <span class="n">zip_entry_name</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.extract_zip_file_to_directory" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Extracts a specified file in a zip to the specified directory</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>zip_file</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an opened zip file. e.g. "with zipfile.ZipFile(zipfilepath) as zip_file:"</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="zipfile.ZipFile">ZipFile</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zip_entry_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the file to be extracted from the zip
            e.g. folderInsideZipIfAny/fileName.txt</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_dir</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the directory to which the file will be extracted</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>full path to the extracted file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_zip_file_to_directory</span><span class="p">(</span>
    <span class="n">zip_file</span><span class="p">:</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">,</span> <span class="n">zip_entry_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts a specified file in a zip to the specified directory</span>

<span class="sd">    Arguments:</span>
<span class="sd">        zip_file: an opened zip file. e.g. &quot;with zipfile.ZipFile(zipfilepath) as zip_file:&quot;</span>
<span class="sd">        zip_entry_name: the name of the file to be extracted from the zip</span>
<span class="sd">                        e.g. folderInsideZipIfAny/fileName.txt</span>
<span class="sd">        target_dir: the directory to which the file will be extracted</span>

<span class="sd">    Returns:</span>
<span class="sd">        full path to the extracted file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">zip_entry_name</span><span class="p">)</span>  <span class="c1"># base name of the file</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">target_dir</span><span class="p">,</span> <span class="n">file_base_name</span>
    <span class="p">)</span>  <span class="c1"># file path to the cached file to write</span>

    <span class="c1"># Create the cache directory if it does not exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>

    <span class="c1"># write the file from the zip into the cache</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cache_file</span><span class="p">:</span>
        <span class="n">cache_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zip_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zip_entry_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">filepath</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.topolgical_sort" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">topolgical_sort</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.topolgical_sort" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Given a graph in the form of a dictionary returns a sorted list
Adapted from:
<a href="http://blog.jupo.org/2012/04/06/topological-sorting-acyclic-directed-graphs/">http://blog.jupo.org/2012/04/06/topological-sorting-acyclic-directed-graphs/</a></p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>graph</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a dictionary with values containing lists of keys</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[str]]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" href="../../tutorials/command_line_client/#list">list</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A sorted list of items</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">topolgical_sort</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a graph in the form of a dictionary returns a sorted list</span>
<span class="sd">    Adapted from:</span>
<span class="sd">    &lt;http://blog.jupo.org/2012/04/06/topological-sorting-acyclic-directed-graphs/&gt;</span>

<span class="sd">    Arguments:</span>
<span class="sd">        graph: a dictionary with values containing lists of keys</span>
<span class="sd">        referencing back into the dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        A sorted list of items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph_unsorted</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">graph_sorted</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Convert the unsorted graph into a hash table. This gives us</span>
    <span class="c1"># constant-time lookup for checking if edges are unresolved</span>

    <span class="c1"># Run until the unsorted graph is empty.</span>
    <span class="k">while</span> <span class="n">graph_unsorted</span><span class="p">:</span>
        <span class="c1"># Go through each of the node/edges pairs in the unsorted</span>
        <span class="c1"># graph. If a set of edges doesn&#39;t contain any nodes that</span>
        <span class="c1"># haven&#39;t been resolved, that is, that are still in the</span>
        <span class="c1"># unsorted graph, remove the pair from the unsorted graph,</span>
        <span class="c1"># and append it to the sorted graph. Note here that by using</span>
        <span class="c1"># using the items() method for iterating, a copy of the</span>
        <span class="c1"># unsorted graph is used, allowing us to modify the unsorted</span>
        <span class="c1"># graph as we move through it. We also keep a flag for</span>
        <span class="c1"># checking that that graph is acyclic, which is true if any</span>
        <span class="c1"># nodes are resolved during each pass through the graph. If</span>
        <span class="c1"># not, we need to bail out as the graph therefore can&#39;t be</span>
        <span class="c1"># sorted.</span>
        <span class="n">acyclic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">edges</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph_unsorted</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph_unsorted</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acyclic</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">del</span> <span class="n">graph_unsorted</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="n">graph_sorted</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">acyclic</span><span class="p">:</span>
            <span class="c1"># We&#39;ve passed through all the unsorted nodes and</span>
            <span class="c1"># weren&#39;t able to resolve any of them, which means there</span>
            <span class="c1"># are nodes with cyclic edges that will never be resolved,</span>
            <span class="c1"># so we bail out with an error.</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;A cyclic dependency occurred.&quot;</span>
                <span class="s2">&quot; Some files in provenance reference each other circularly.&quot;</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">graph_sorted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.caller_module_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">caller_module_name</span><span class="p">(</span><span class="n">current_frame</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.caller_module_name" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns the name of the module in which the calling function resides.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>current_frame</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>use inspect.currentframe().</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the name of the module calling the function, foo(),</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>in which this calling_module() is invoked.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Ignores callers that belong in the same module as foo()</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">caller_module_name</span><span class="p">(</span><span class="n">current_frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the name of the module in which the calling function resides.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        current_frame: use inspect.currentframe().</span>

<span class="sd">    Returns:</span>
<span class="sd">        the name of the module calling the function, foo(),</span>
<span class="sd">        in which this calling_module() is invoked.</span>
<span class="sd">        Ignores callers that belong in the same module as foo()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current_frame_filename</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">current_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>
    <span class="p">)</span>  <span class="c1"># filename in which foo() resides</span>

    <span class="c1"># go back a frame takes us to the frame calling foo()</span>
    <span class="n">caller_frame</span> <span class="o">=</span> <span class="n">current_frame</span><span class="o">.</span><span class="n">f_back</span>
    <span class="n">caller_filename</span> <span class="o">=</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>

    <span class="c1"># find the first frame that does not have the same filename.</span>
    <span class="c1"># this ensures that we don&#39;t consider functions within</span>
    <span class="c1"># the same module as foo() that use foo() as a helper function</span>
    <span class="k">while</span> <span class="n">caller_filename</span> <span class="o">==</span> <span class="n">current_frame_filename</span><span class="p">:</span>
        <span class="n">caller_frame</span> <span class="o">=</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">caller_filename</span> <span class="o">=</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>

    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodulename</span><span class="p">(</span><span class="n">caller_filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.attempt_import" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attempt_import</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">fail_message</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.attempt_import" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Attempt to import a module by name and return the imported module if successful.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>module_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The name of the module to import.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fail_message</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The error message to display if the import fails.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The imported module.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code>ImportError</code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If the module cannot be imported.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">attempt_import</span><span class="p">(</span><span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fail_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to import a module by name and return the imported module if successful.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        module_name: The name of the module to import.</span>
<span class="sd">        fail_message: The error message to display if the import fails.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The imported module.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If the module cannot be imported.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">fail_message</span>
                <span class="o">+</span> <span class="s2">&quot;To install this library on Mac or Linux distributions:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    (sudo) pip install </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;On Windows, right click the Command Prompt(cmd.exe) and select &#39;Run as administrator&#39; then:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    pip install </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.snake_case" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">snake_case</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.snake_case" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert the given string from CamelCase to snake_case</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">snake_case</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the given string from CamelCase to snake_case&quot;&quot;&quot;</span>
    <span class="c1"># https://stackoverflow.com/a/1176023</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;!^)(?=[A-Z])&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.is_base64_encoded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_base64_encoded</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.is_base64_encoded" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Return whether the given input string appears to be base64 encoded</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_base64_encoded</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether the given input string appears to be base64 encoded&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_string</span><span class="p">:</span>
        <span class="c1"># None, empty string are not considered encoded</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># see if we can decode it and then reencode it back to the input</span>
        <span class="n">byte_string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">input_string</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">byte_string</span><span class="p">))</span> <span class="o">==</span> <span class="n">byte_string</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.run_and_attach_otel_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_and_attach_otel_context</span><span class="p">(</span><span class="n">callable_function</span><span class="p">,</span> <span class="n">current_context</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.run_and_attach_otel_context" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>This is a generic function that will run a callable function and attach the passed in
OpenTelemetry context to the thread or context that the function is running on.</p>
<p>This is a hack to get around AsyncIO <code>run_in_executor</code> not propagating the context
to the code it's executing. When we are directly calling async functions after
SYNPY-1411 we will be able to remove this function.</p>


<details class="example" open>
  <summary>Adding this to a <code>run_in_executor</code> call</summary>
  <p>Note the 2 lambdas that are required:</p>
<pre><code>import asyncio
from opentelemetry import context
from synapseclient import Synapse

loop = asyncio.get_event_loop()
current_context = context.get_current()
await loop.run_in_executor(
    None,
    lambda: run_and_attach_otel_context(
        lambda: Synapse.get_client(synapse_client=synapse_client).delete(
            obj="syn123",
        ),
        current_context,
    ),
)
</code></pre>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_and_attach_otel_context</span><span class="p">(</span>
    <span class="n">callable_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span> <span class="n">current_context</span><span class="p">:</span> <span class="n">Context</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a generic function that will run a callable function and attach the passed in</span>
<span class="sd">    OpenTelemetry context to the thread or context that the function is running on.</span>

<span class="sd">    This is a hack to get around AsyncIO `run_in_executor` not propagating the context</span>
<span class="sd">    to the code it&#39;s executing. When we are directly calling async functions after</span>
<span class="sd">    SYNPY-1411 we will be able to remove this function.</span>

<span class="sd">    Example: Adding this to a `run_in_executor` call</span>
<span class="sd">        Note the 2 lambdas that are required:</span>

<span class="sd">            import asyncio</span>
<span class="sd">            from opentelemetry import context</span>
<span class="sd">            from synapseclient import Synapse</span>

<span class="sd">            loop = asyncio.get_event_loop()</span>
<span class="sd">            current_context = context.get_current()</span>
<span class="sd">            await loop.run_in_executor(</span>
<span class="sd">                None,</span>
<span class="sd">                lambda: run_and_attach_otel_context(</span>
<span class="sd">                    lambda: Synapse.get_client(synapse_client=synapse_client).delete(</span>
<span class="sd">                        obj=&quot;syn123&quot;,</span>
<span class="sd">                    ),</span>
<span class="sd">                    current_context,</span>
<span class="sd">                ),</span>
<span class="sd">            )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">current_context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">callable_function</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.delete_none_keys" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_none_keys</span><span class="p">(</span><span class="n">incoming_object</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.delete_none_keys" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Clean up the incoming object by removing any keys with None values.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_none_keys</span><span class="p">(</span><span class="n">incoming_object</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up the incoming object by removing any keys with None values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">incoming_object</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">incoming_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">incoming_object</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">incoming_object</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.utils.merge_dataclass_entities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_dataclass_entities</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">fields_to_ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.utils.merge_dataclass_entities" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Utility function to merge two dataclass entities together. This is used when we are
upserting an entity from the Synapse service with the requested changes.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The source entity to merge from.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="synapseclient.models.Project" href="../oop/models_async/#synapseclient.models.Project">Project</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.Folder" href="../oop/models_async/#synapseclient.models.Folder">Folder</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.File" href="../oop/models_async/#synapseclient.models.File">File</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The destination entity to merge into.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="synapseclient.models.Project" href="../oop/models_async/#synapseclient.models.Project">Project</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.Folder" href="../oop/models_async/#synapseclient.models.Folder">Folder</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.File" href="../oop/models_async/#synapseclient.models.File">File</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fields_to_ignore</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list of fields to ignore when merging.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="synapseclient.models.Project" href="../oop/models_async/#synapseclient.models.Project">Project</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.Folder" href="../oop/models_async/#synapseclient.models.Folder">Folder</a>, <a class="autorefs autorefs-internal" title="synapseclient.models.File" href="../oop/models_async/#synapseclient.models.File">File</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The destination entity with the merged values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge_dataclass_entities</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Folder&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">],</span>
    <span class="n">destination</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Folder&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">],</span>
    <span class="n">fields_to_ignore</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Folder&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to merge two dataclass entities together. This is used when we are</span>
<span class="sd">    upserting an entity from the Synapse service with the requested changes.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        source: The source entity to merge from.</span>
<span class="sd">        destination: The destination entity to merge into.</span>
<span class="sd">        fields_to_ignore: A list of fields to ignore when merging.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The destination entity with the merged values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert dataclasses to dictionaries</span>
    <span class="n">destination_dict</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
    <span class="n">source_dict</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">modified_items</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Update destination_dict with source_dict, keeping destination&#39;s values in case of conflicts</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fields_to_ignore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fields_to_ignore</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">key</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">modified_items</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_dataclass_entities</span><span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">destination</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">destination_dict</span> <span class="ow">or</span> <span class="n">destination_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modified_items</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;annotations&quot;</span><span class="p">:</span>
            <span class="n">modified_items</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="o">**</span><span class="p">(</span><span class="n">value</span> <span class="ow">or</span> <span class="p">{}),</span>
                <span class="o">**</span><span class="n">destination_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
            <span class="p">}</span>

    <span class="c1"># Update destination&#39;s fields with the merged dictionary</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">modified_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="async-utils">Async Utils<a class="headerlink" href="#async-utils" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.async_utils" class="doc doc-heading">
            <code>synapseclient.core.async_utils</code>


<a href="#synapseclient.core.async_utils" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This utility class is to hold any utilities that are needed for async operations.</p>



  <div class="doc doc-children">






<h3 id="synapseclient.core.async_utils-classes">Classes<a href="#synapseclient.core.async_utils-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.async_utils.ClassOrInstance" class="doc doc-heading">
            <code>ClassOrInstance</code>


<a href="#synapseclient.core.async_utils.ClassOrInstance" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Helper class to allow a method to be called as a class method or instance method.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/async_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ClassOrInstance</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class to allow a method to be called as a class method or instance method.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.async_utils-functions">Functions<a href="#synapseclient.core.async_utils-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.async_utils.otel_trace_method" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">otel_trace_method</span><span class="p">(</span><span class="n">method_to_trace_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.async_utils.otel_trace_method" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Decorator to trace a method with OpenTelemetry in an async environment. This function
is specifically written to be used on a method within a class.</p>
<p>This will pass the class instance as the first argument to the method. This allows
you to modify the name of the trace to include information about the class instance.</p>


<details class="example" open>
  <summary>Decorating a method within a class that will be traced with OpenTelemetry.</summary>
  <p>Setting the trace name:</p>
<pre><code>@otel_trace_method(method_to_trace_name=lambda self, **kwargs: f"Project_Store: {self.name}")
async def store(self):
</code></pre>
</details>

<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>method_to_trace_name</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A callable that takes the class instance as the first argument
and returns a string to be used as the trace name. If this is not provided,
the trace name will be set to the method name.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>[..., str], None]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A callable decorator that will trace the method with OpenTelemetry.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/async_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">otel_trace_method</span><span class="p">(</span><span class="n">method_to_trace_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to trace a method with OpenTelemetry in an async environment. This function</span>
<span class="sd">    is specifically written to be used on a method within a class.</span>

<span class="sd">    This will pass the class instance as the first argument to the method. This allows</span>
<span class="sd">    you to modify the name of the trace to include information about the class instance.</span>

<span class="sd">    Example: Decorating a method within a class that will be traced with OpenTelemetry.</span>
<span class="sd">        Setting the trace name:</span>

<span class="sd">            @otel_trace_method(method_to_trace_name=lambda self, **kwargs: f&quot;Project_Store: {self.name}&quot;)</span>
<span class="sd">            async def store(self):</span>

<span class="sd">    Arguments:</span>
<span class="sd">        method_to_trace_name: A callable that takes the class instance as the first argument</span>
<span class="sd">            and returns a string to be used as the trace name. If this is not provided,</span>
<span class="sd">            the trace name will be set to the method name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A callable decorator that will trace the method with OpenTelemetry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function decorator.&quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">otel_trace_method_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Wrapper for the function to be traced.&quot;&quot;&quot;</span>
            <span class="n">trace_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">method_to_trace_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method_to_trace_name</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">current_span</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_current_span</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">current_span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span>
                    <span class="n">trace_name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Synaspse::</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">otel_trace_method_wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.async_utils.wrap_async_to_sync" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_async_to_sync</span><span class="p">(</span><span class="n">coroutine</span><span class="p">,</span> <span class="n">syn</span><span class="p">)</span></code>

<a href="#synapseclient.core.async_utils.wrap_async_to_sync" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Wrap an async function to be called in a sync context.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/async_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wrap_async_to_sync</span><span class="p">(</span><span class="n">coroutine</span><span class="p">:</span> <span class="n">Coroutine</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap an async function to be called in a sync context.&quot;&quot;&quot;</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">loop</span><span class="p">:</span>
            <span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">coroutine</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">syn</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error occurred while running </span><span class="si">{</span><span class="n">coroutine</span><span class="si">}</span><span class="s2"> in a sync context.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.async_utils.async_to_sync" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">async_to_sync</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span></code>

<a href="#synapseclient.core.async_utils.async_to_sync" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Convert all name_of_thing_async methods to name_of_thing methods</p>
<p>(see
http://stackoverflow.com/questions/18048341/add-methods-to-a-class-generated-from-other-methods
for help understanding)</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/async_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">async_to_sync</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert all name_of_thing_async methods to name_of_thing methods</span>

<span class="sd">    (see</span>
<span class="sd">    http://stackoverflow.com/questions/18048341/add-methods-to-a-class-generated-from-other-methods</span>
<span class="sd">    for help understanding)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">create_method</span><span class="p">(</span><span class="n">async_method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a replacement method for the async method.&quot;&quot;&quot;</span>

        <span class="nd">@ClassOrInstance</span>
        <span class="k">def</span> <span class="nf">newmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;The new method that will replace the non-async method.&quot;&quot;&quot;</span>

            <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Wrapper for the function to be called in an async context.&quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="k">await</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">async_method_name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">loop</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">if</span> <span class="n">loop</span><span class="p">:</span>
                    <span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">synapseclient</span> <span class="kn">import</span> <span class="n">Synapse</span>

                <span class="n">synapse_client</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;synapse_client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">synapse_client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error occurred while running </span><span class="si">{</span><span class="n">async_method_name</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ex</span>

        <span class="k">return</span> <span class="n">newmethod</span>

    <span class="n">methods</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="n">methods_to_update</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;async&quot;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="p">(</span><span class="n">new_method_name</span> <span class="o">:=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_async&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">new_method</span> <span class="o">=</span> <span class="n">create_method</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="n">new_method</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">new_method_name</span>
            <span class="n">new_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">new_method_name</span>

            <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">new_method</span><span class="p">,</span> <span class="n">new_method</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">methods_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;new_method_name&quot;</span><span class="p">:</span> <span class="n">new_method_name</span><span class="p">,</span>
                    <span class="s2">&quot;new_method&quot;</span><span class="p">:</span> <span class="n">new_method</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">method_to_update</span> <span class="ow">in</span> <span class="n">methods_to_update</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">method_to_update</span><span class="p">[</span><span class="s2">&quot;new_method_name&quot;</span><span class="p">],</span> <span class="n">method_to_update</span><span class="p">[</span><span class="s2">&quot;new_method&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="versions">Versions<a class="headerlink" href="#versions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.version_check" class="doc doc-heading">
            <code>synapseclient.core.version_check</code>


<a href="#synapseclient.core.version_check" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <h3 id="synapseclient.core.version_check--version-functions">Version Functions<a class="headerlink" href="#synapseclient.core.version_check--version-functions" title="Permanent link">&para;</a></h3>
<p>Check for latest version and recommend upgrade:</p>
<pre><code>synapseclient.check_for_updates()
</code></pre>
<p>Print release notes for installed version of client:</p>
<pre><code>synapseclient.release_notes()
</code></pre>



  <div class="doc doc-children">







<h3 id="synapseclient.core.version_check-functions">Functions<a href="#synapseclient.core.version_check-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.version_check.version_check" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">version_check</span><span class="p">(</span><span class="n">current_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version_url</span><span class="o">=</span><span class="n">_VERSION_URL</span><span class="p">,</span> <span class="n">check_for_point_releases</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#synapseclient.core.version_check.version_check" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Gets the latest version information from version_url and check against the current version.
Recommends upgrade, if a newer version exists.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>current_version</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current version of the entity</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>version_url</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The URL of the entity version</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><span title="synapseclient.core.version_check._VERSION_URL">_VERSION_URL</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>check_for_point_releases</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bool.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if current version is the latest release (or higher) version, otherwise False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/version_check.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">version_check</span><span class="p">(</span>
    <span class="n">current_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version_url</span><span class="o">=</span><span class="n">_VERSION_URL</span><span class="p">,</span> <span class="n">check_for_point_releases</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the latest version information from version_url and check against the current version.</span>
<span class="sd">    Recommends upgrade, if a newer version exists.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        current_version: The current version of the entity</span>
<span class="sd">        version_url: The URL of the entity version</span>
<span class="sd">        check_for_point_releases: Bool.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if current version is the latest release (or higher) version, otherwise False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_version</span><span class="p">:</span>
            <span class="n">current_version</span> <span class="o">=</span> <span class="n">synapseclient</span><span class="o">.</span><span class="n">__version__</span>

        <span class="n">version_info</span> <span class="o">=</span> <span class="n">_get_version_info</span><span class="p">(</span><span class="n">version_url</span><span class="p">)</span>

        <span class="n">current_base_version</span> <span class="o">=</span> <span class="n">_strip_dev_suffix</span><span class="p">(</span><span class="n">current_version</span><span class="p">)</span>

        <span class="c1"># Check blacklist</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">current_base_version</span> <span class="ow">in</span> <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;blacklist&quot;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">current_version</span> <span class="ow">in</span> <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;blacklist&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PLEASE UPGRADE YOUR CLIENT</span><span class="se">\n\n</span><span class="s2">Upgrading your SynapseClient is&quot;</span>
                <span class="s2">&quot; required. Please upgrade your client by typing:</span><span class="se">\n</span><span class="s2">    pip install&quot;</span>
                <span class="s2">&quot; --upgrade synapseclient</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;message&quot;</span> <span class="ow">in</span> <span class="n">version_info</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">check_for_point_releases</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="c1"># Compare with latest version</span>
        <span class="k">if</span> <span class="n">_version_tuple</span><span class="p">(</span><span class="n">current_version</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_version_tuple</span><span class="p">(</span>
            <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span>
        <span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UPGRADE AVAILABLE</span><span class="se">\n\n</span><span class="s2">A more recent version of the Synapse Client&quot;</span>
                <span class="s2">&quot; (</span><span class="si">%s</span><span class="s2">) is available. Your version (</span><span class="si">%s</span><span class="s2">) can be upgraded by typing:</span><span class="se">\n</span><span class="s2">   &quot;</span>
                <span class="s2">&quot; pip install --upgrade synapseclient</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">],</span>
                    <span class="n">current_version</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;releaseNotes&quot;</span> <span class="ow">in</span> <span class="n">version_info</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s2">&quot;Python Synapse Client version </span><span class="si">%s</span><span class="s2"> release notes</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;releaseNotes&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Don&#39;t prevent the client from running if something goes wrong</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Exception in version check: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.version_check.check_for_updates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_for_updates</span><span class="p">()</span></code>

<a href="#synapseclient.core.version_check.check_for_updates" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Check for the existence of newer versions of the client, reporting both current release version and development
version.</p>
<p>For help installing development versions of the client,
see the <a href="https://github.com/Sage-Bionetworks/synapsePythonClient#installation">README.md</a>.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/version_check.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_for_updates</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for the existence of newer versions of the client, reporting both current release version and development</span>
<span class="sd">    version.</span>

<span class="sd">    For help installing development versions of the client,</span>
<span class="sd">    see the [README.md](https://github.com/Sage-Bionetworks/synapsePythonClient#installation).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Python Synapse Client</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;currently running version:  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">synapseclient</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

    <span class="n">release_version_info</span> <span class="o">=</span> <span class="n">_get_version_info</span><span class="p">(</span><span class="n">_VERSION_URL</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s2">&quot;latest release version:     </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">release_version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">_version_tuple</span><span class="p">(</span><span class="n">synapseclient</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_version_tuple</span><span class="p">(</span>
        <span class="n">release_version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UPGRADE AVAILABLE</span><span class="se">\n\n</span><span class="s2">A more recent version of the Synapse Client (</span><span class="si">%s</span><span class="s2">) is&quot;</span>
            <span class="s2">&quot; available. Your version (</span><span class="si">%s</span><span class="s2">) can be upgraded by typing:</span><span class="se">\n</span><span class="s2">    pip install&quot;</span>
            <span class="s2">&quot; --upgrade synapseclient</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">release_version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">],</span>
                <span class="n">synapseclient</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Your Synapse client is up to date!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.version_check.release_notes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">release_notes</span><span class="p">(</span><span class="n">version_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.version_check.release_notes" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Print release notes for the installed version of the client or latest release or development version if version_url
is supplied.</p>


<details class="version_url" open>
  <summary>Defaults to None, meaning release notes for the installed version. Alternatives are:</summary>
  <ul>
<li>synapseclient.version_check._VERSION_URL</li>
<li>synapseclient.version_check._DEV_VERSION_URL</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>synapseclient/core/version_check.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">release_notes</span><span class="p">(</span><span class="n">version_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print release notes for the installed version of the client or latest release or development version if version_url</span>
<span class="sd">    is supplied.</span>

<span class="sd">    version_url: Defaults to None, meaning release notes for the installed version. Alternatives are:</span>
<span class="sd">                        - synapseclient.version_check._VERSION_URL</span>
<span class="sd">                        - synapseclient.version_check._DEV_VERSION_URL</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version_info</span> <span class="o">=</span> <span class="n">_get_version_info</span><span class="p">(</span><span class="n">version_url</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s2">&quot;Python Synapse Client version </span><span class="si">%s</span><span class="s2"> release notes</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;releaseNotes&quot;</span> <span class="ow">in</span> <span class="n">version_info</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">version_info</span><span class="p">[</span><span class="s2">&quot;releaseNotes&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="sts-transfer">STS Transfer<a class="headerlink" href="#sts-transfer" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="synapseclient.core.sts_transfer" class="doc doc-heading">
            <code>synapseclient.core.sts_transfer</code>


<a href="#synapseclient.core.sts_transfer" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">






<h3 id="synapseclient.core.sts_transfer-classes">Classes<a href="#synapseclient.core.sts_transfer-classes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="synapseclient.core.sts_transfer.StsTokenStore" class="doc doc-heading">
            <code>StsTokenStore</code>


<a href="#synapseclient.core.sts_transfer.StsTokenStore" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">


      <p>Cache STS tokens in memory for observed entity ids.
An optimization for long lived Synapse objects that will interact with the same
Synapse storage locations over and over again so they don't have to do a remote call
to fetch a new token for every entity, which for e.g. small files can amount to
non trivial overhead.</p>

              <details class="quote">
                <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StsTokenStore</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cache STS tokens in memory for observed entity ids.</span>
<span class="sd">    An optimization for long lived Synapse objects that will interact with the same</span>
<span class="sd">    Synapse storage locations over and over again so they don&#39;t have to do a remote call</span>
<span class="sd">    to fetch a new token for every entity, which for e.g. small files can amount to</span>
<span class="sd">    non trivial overhead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># each token is &lt; 1k but given we don&#39;t know how long Python process will be running</span>
    <span class="c1"># (could be very long in a programmatic environment) we impose a limit on the maximum</span>
    <span class="c1"># number of tokens we will store in memory to prevent this optimization from becoming</span>
    <span class="c1"># a memory leak.</span>
    <span class="n">DEFAULT_TOKEN_CACHE_SIZE</span> <span class="o">=</span> <span class="mi">5000</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_token_cache_size</span><span class="o">=</span><span class="n">DEFAULT_TOKEN_CACHE_SIZE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">_TokenCache</span><span class="p">(</span><span class="n">max_token_cache_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">STS_PERMISSIONS</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_token</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">min_remaining_life</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span>
    <span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">utcnow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            <span class="n">token_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">token_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid STS permission </span><span class="si">{</span><span class="n">permission</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">token</span> <span class="o">=</span> <span class="n">token_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">token</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">iso_to_datetime</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="s2">&quot;expiration&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">utcnow</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_remaining_life</span>
            <span class="p">):</span>
                <span class="c1"># either there is no cached token or the remaining life on the token isn&#39;t enough so fetch new</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">token_cache</span><span class="p">[</span><span class="n">entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_token</span><span class="p">(</span>
                    <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">token</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fetch_token</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">syn</span><span class="o">.</span><span class="n">restGET</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/entity/</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s2">/sts?permission=</span><span class="si">{</span><span class="n">permission</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>
<h3 id="synapseclient.core.sts_transfer-functions">Functions<a href="#synapseclient.core.sts_transfer-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.sts_transfer.get_sts_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sts_credentials</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">min_remaining_life</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#synapseclient.core.sts_transfer.get_sts_credentials" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>See Synapse.get_sts_storage_token</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sts_credentials</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">min_remaining_life</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;See Synapse.get_sts_storage_token&quot;&quot;&quot;</span>
    <span class="n">min_remaining_life</span> <span class="o">=</span> <span class="n">min_remaining_life</span> <span class="ow">or</span> <span class="n">DEFAULT_MIN_LIFE</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">_sts_token_store</span><span class="o">.</span><span class="n">get_token</span><span class="p">(</span>
        <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">min_remaining_life</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;boto&quot;</span><span class="p">:</span>
        <span class="c1"># the Synapse STS API returns camel cased keys that we need to convert to use with boto.</span>
        <span class="c1"># prefix with &quot;aws_&quot;, convert to snake case, and exclude any other key/value pairs in the value</span>
        <span class="c1"># e.g. expiration</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;aws_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snake_case</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span> <span class="n">value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;accessKeyId&quot;</span><span class="p">,</span> <span class="s2">&quot;secretAccessKey&quot;</span><span class="p">,</span> <span class="s2">&quot;sessionToken&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="c1"># pass through what server sent</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;shell&quot;</span><span class="p">:</span>
        <span class="c1"># for &quot;shell&quot; we try to detect what is best for the system</span>
        <span class="c1"># assume bourne compatible output outside of windows</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span> <span class="ow">and</span> <span class="s2">&quot;bash&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SHELL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PSModulePath&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># https://stackoverflow.com/a/55598796</span>
                <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;powershell&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;cmd&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;bash&quot;</span>

    <span class="n">template_string</span> <span class="o">=</span> <span class="n">EXPORT_TEMPLATE_STRINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_format</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_string</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized output_format </span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_format_export_template_string</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">template_string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.sts_transfer.with_boto_sts_credentials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">with_boto_sts_credentials</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">)</span></code>

<a href="#synapseclient.core.sts_transfer.with_boto_sts_credentials" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>A wrapper around a function that will get sts credentials and try to use them on the given
function which should take a dictionary with the <code>aws_access_key_id</code>, <code>aws_secret_access_key</code>, and <code>aws_session_token</code>
as keys. If the given function returns a boto error that looks like the token has expired
it will retry once after fetching fresh credentials.</p>
<p>The purpose is to be able to use potentially cached credentials in long running tasks while reducing
worry that they will expire in the middle of running and cause an unrecoverable error.
The alternative of fetching a fresh STS token for every request might be okay for a few large files
but would greatly slow down transferring many small files.</p>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_boto_sts_credentials</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper around a function that will get sts credentials and try to use them on the given</span>
<span class="sd">    function which should take a dictionary with the `aws_access_key_id`, `aws_secret_access_key`, and `aws_session_token`</span>
<span class="sd">    as keys. If the given function returns a boto error that looks like the token has expired</span>
<span class="sd">    it will retry once after fetching fresh credentials.</span>

<span class="sd">    The purpose is to be able to use potentially cached credentials in long running tasks while reducing</span>
<span class="sd">    worry that they will expire in the middle of running and cause an unrecoverable error.</span>
<span class="sd">    The alternative of fetching a fresh STS token for every request might be okay for a few large files</span>
<span class="sd">    but would greatly slow down transferring many small files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">get_sts_credentials</span><span class="p">(</span>
            <span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s2">&quot;boto&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">boto3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Boto3Error</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ExpiredToken&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attempt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.sts_transfer.is_boto_sts_transfer_enabled" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_boto_sts_transfer_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span></code>

<a href="#synapseclient.core.sts_transfer.is_boto_sts_transfer_enabled" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Check if the boto/STS transfers are enabled in the Synapse configuration.
If enabled then synapseclient will attempt to automatically use boto to upload
and download from supported storage locations that are sts enabled.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A <a class="autorefs autorefs-internal" href="../client/#synapseclient.Synapse">Synapse</a> object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if STS if enabled, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_boto_sts_transfer_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the boto/STS transfers are enabled in the Synapse configuration.</span>
<span class="sd">    If enabled then synapseclient will attempt to automatically use boto to upload</span>
<span class="sd">    and download from supported storage locations that are sts enabled.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn: A [Synapse][synapseclient.Synapse] object</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if STS if enabled, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">boto3</span> <span class="ow">and</span> <span class="n">syn</span><span class="o">.</span><span class="n">use_boto_sts_transfers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.sts_transfer.is_storage_location_sts_enabled" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_storage_location_sts_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span></code>

<a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns whether the given storage location is enabled for STS.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A <a class="autorefs autorefs-internal" href="../client/#synapseclient.Synapse">Synapse</a> object</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entity_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ID of synapse entity whose storage location we want to check for sts access</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A storage location ID or a dictionary representing the location UploadDestination</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if STS is enabled for the location, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_storage_location_sts_enabled</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether the given storage location is enabled for STS.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn:       A [Synapse][synapseclient.Synapse] object</span>
<span class="sd">        entity_id: The ID of synapse entity whose storage location we want to check for sts access</span>
<span class="sd">        location:  A storage location ID or a dictionary representing the location UploadDestination</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if STS is enabled for the location, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">location</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="c1"># looks like this is already an upload destination dict</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">location</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise treat it as a storage location id,</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">restGET</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/entity/</span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s2">/uploadDestination/</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">syn</span><span class="o">.</span><span class="n">fileHandleEndpoint</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stsEnabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="synapseclient.core.sts_transfer.is_storage_location_sts_enabled_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_storage_location_sts_enabled_async</span><span class="p">(</span><span class="n">syn</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#synapseclient.core.sts_transfer.is_storage_location_sts_enabled_async" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Returns whether the given storage location is enabled for STS.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>syn</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A <a class="autorefs autorefs-internal" href="../client/#synapseclient.Synapse">Synapse</a> object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="synapseclient.Synapse" href="../client/#synapseclient.Synapse">Synapse</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entity_id</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ID of synapse entity whose storage location we want to check for sts access</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>location</code></td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A storage location ID or a dictionary representing the location UploadDestination</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if STS is enabled for the location, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>synapseclient/core/sts_transfer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">is_storage_location_sts_enabled_async</span><span class="p">(</span>
    <span class="n">syn</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether the given storage location is enabled for STS.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        syn:       A [Synapse][synapseclient.Synapse] object</span>
<span class="sd">        entity_id: The ID of synapse entity whose storage location we want to check for sts access</span>
<span class="sd">        location:  A storage location ID or a dictionary representing the location UploadDestination</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if STS is enabled for the location, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">location</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="c1"># looks like this is already an upload destination dict</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">location</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Lazy import to avoid circular imports</span>
        <span class="kn">from</span> <span class="nn">synapseclient.api.entity_services</span> <span class="kn">import</span> <span class="n">get_upload_destination_location</span>

        <span class="c1"># otherwise treat it as a storage location id,</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_upload_destination_location</span><span class="p">(</span>
            <span class="n">entity_id</span><span class="o">=</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">synapse_client</span><span class="o">=</span><span class="n">syn</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">destination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stsEnabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../permissions/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Permissions">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Permissions
              </div>
            </div>
          </a>
        
        
          
          <a href="../rest_apis/" class="md-footer__link md-footer__link--next" aria-label="Next: REST Apis">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                REST Apis
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Sage-Bionetworks/synapsePythonClient" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Sage-Bionetworks/synapsePythonClient/pkgs/container/synapsepythonclient" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/synapseclient/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.sections", "search.highlight", "search.share", "search.suggest", "toc.follow", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../termynal.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>